/* Discount Ninja v2 */
if(window.location.search.indexOf("frame_token")>-1&&window!==window.top)throw new Error("Limoni Apps DiscountNinja V2 has detected it is running in the Shopify Admin theme editor. Aborting script.");typeof discountninja=="undefined"&&(discountninja={}),function(){var n={Shop:"",Version:"4.2.21",TriggerPromotion:function(t){try{var i=jQuery(t).attr("data-limoniapps-discountninja-token");i!==null&&i!==undefined&&i!==""&&(discountninja.Logging.LogVerbose("Triggering promotion with token "+i),discountninja.Token.SetTokenInLocalStorage(i),discountninja.Token.SetCartTokenInLocalStorage(i),discountninja.Token.SetNonAutomaticTokenInSession(i),n.Start())}catch(r){discountninja.Logging.LogError("Core.Exception in TriggerPromotion",r,!0)}},Start:function(t){function i(){try{discountninja.TestMode.HandleQueryParameter();discountninja.Logging.HandleQueryParameter()}catch(n){discountninja.Logging.LogError("Core.HandleDiscountNinjaQueryParameters",n,!0)}}function r(t){try{var i=0,r=null,u=function(){i++;typeof jQuery!="undefined"&&typeof jQuery.isReady=="boolean"&&(n.DOMHasLoaded=n.DOMHasLoaded||jQuery.isReady);n.DOMHasLoaded||i===50?(r!==null&&clearTimeout(r),i===50&&discountninja.Logging.LogError("Core.Waiting for DOM to load - Timed out",!0),discountninja.Logging.LogVerbose("Waiting for DOM to load - DONE"),typeof t=="function"&&t!==null&&t()):r=setTimeout(function(){u()},100)};u()}catch(f){discountninja.Logging.LogError("Core.WaitForDom",f,!0)}}function u(){try{discountninja.Logging.StartTimer();discountninja.Trigger.IntializeTimeOnPageCounter();discountninja.Trigger.TrackScrollPercentage();discountninja.Promotion.PrimaryPromotion=null;discountninja.Settings.Settings=null;discountninja.Logging.LogVerbose("Request updated cart");discountninja.Cart.Shopify.UpdateCart();n.RegisterDiscountButtonClickEvents();discountninja.ProductData.Save();discountninja.Logging.LogVerbose("Getting promotion info");discountninja.Logging.ShowTimeElapsed("Loading promotion info");discountninja.Promotion.LoadApplicablePromotions(function(){r(function(){discountninja.Cart.Shopify.UpdateCart(discountninja.DiscountedCart.BuildDiscountedCart(function(){discountninja.Checkout.Shopify.InjectLoadingCheckoutPopUp();discountninja.Checkout.Shopify.RegisterEventHandlerForCheckout();discountninja.PromotionFlow.StartFlow()}))})},discountninja.PromotionFlow.StopFlow)}catch(t){discountninja.Logging.LogError("Core.StartInternal",t,!0)}}try{if(n.Shop=discountninja.Environment.Shopify.MyShopifyDomain(),i(),discountninja.TestMode.TestModeOutputIssue=!1,t&&discountninja.Logging.LogToConsole("information","\n\n"+discountninja.Utilities.GetEmoji(128640)+" This forward-thinking shop uses Discount Ninja (an app by Limoni Apps) to drive more sales by showing discounted prices on the product page, the collection page and the cart page.\nLearn more at https://apps.shopify.com/discount-url?ref="+n.Shop+"\n\n\n","green",!0),discountninja.Logging.LogVerbose("Loaded at '"+Date.now().toString()+"' - Version: "+n.Version),!discountninja.Environment.Shopify.IsCartPage()&&!discountninja.Environment.Shopify.IsProductPage()&&!discountninja.Environment.Shopify.IsCollectionPage()&&!discountninja.Environment.Shopify.IsHomePage()&&!discountninja.Environment.Shopify.IsBlogPost()&&!discountninja.Environment.Shopify.IsCustomPage()){discountninja.Logging.LogVerbose("Not on home, product, collection or cart page. Aborting script.");return}XMLHttpRequest.prototype.send=discountninja.XmlHttpRequest.CreateSendInterceptor("readystatechange",discountninja.XmlHttpRequest.HandleSend,XMLHttpRequest.prototype.send);window.fetch=discountninja.XmlHttpRequest.CreateFetchInterceptor(discountninja.XmlHttpRequest.HandleFetch,window.fetch);LimoniAppsLoadJQuery(LimoniAppsLoadJQueryNotify(LimoniAppsLoadOuiBounce(LimoniAppsLoadFontAwesome(LimoniAppsLoadMoment(LimoniAppsLoadMomentFormat(LimoniAppsLoadMomentTimezone(discountninja.LiquidData.WaitForLiquidAsset(u))))))))}catch(f){discountninja.Logging.LogError("Core.Start",f,!0)}},RegisterDiscountButtonClickEvents:function(){function t(){try{jQuery("body").find(".limoniapps-discountninja-discountbutton").each(function(){jQuery(this).off("click")})}catch(n){discountninja.Logging.LogError("Core.UnRegisterDiscountButtonClickEvents",n,!0)}}try{discountninja.Logging.LogVerbose("Registering event handler for discount buttons");t();jQuery("body").find(".limoniapps-discountninja-discountbutton").each(function(){jQuery(this).on("click",function(t){discountninja.Logging.LogVerbose("Promotion triggered via discount button");n.TriggerPromotion(t.currentTarget)})})}catch(i){discountninja.Logging.LogError("Core.RegisterDiscountButtonClickEvents",i,!0)}},CheckoutCurrentVariant:function(){try{if(discountninja.Environment.Shopify.IsProductPage()){var f=discountninja.Environment.Shopify.VariantId(),t=discountninja.DiscountCode.GetDiscountCode(),i=jQuery('form input[name="quantity"]'),n=1;i!==null&&i.length===1&&(n=i.val());(n===undefined||n==="undefined"||n===null||isNaN(n))&&(n=1);var u=t===undefined||t===null||t===""?"":"?discount="+t,r=discountninja.QueryParameter.Get("locale"),e=r===undefined?"":u===""?"?locale="+r:"&locale="+r;window.location.assign("/cart/"+f+":"+n+u+e)}}catch(o){discountninja.Logging.LogError("Core.CheckoutCurrentVariant",o,!0)}}};discountninja=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja.Utilities=discountninja.Utilities||{},function(){var n={IsValidEmailAddress:function(n){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(n.toLowerCase())},GetMutationObserver:function(){try{var n=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;return typeof n=="undefined"?discountninja.Logging.LogWarning("MutationObserver not available, not supporting ListenForDynamicallyAddedElements",!0,!0):n}catch(t){return discountninja.Logging.LogError("Utilities.GetMutationObserver",t,!0),null}},FormatPercentage:function(n,t){try{return n.toFixed(t)}catch(i){return discountninja.Logging.LogError("Utilities.FormatPercentage",i,!0),n}},FormatMoney:function(n,t,i,r,u,f){var e;try{if(n===0&&f===!0)return discountninja.Settings.Settings.PriceUpdateSettings.FreeLabel;r=r||!1;u=u||!1;typeof n=="string"&&(n=n.replace(".",""));var o="",h=/\{\{\s*(\w+)\s*\}\}/,l=discountninja.Settings.Settings.CurrencySettings.BaseCurrency+" {{amount}}",c=t||l;function s(n,t,i,u){var f,e,o;return(i=i||",",u=u||".",isNaN(n)||n==null)?0:(n=(n/100).toFixed(t),f=n.split("."),e=f[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+i),t===0?e:(o="",o=r?"<sup>"+(f[1]?f[1]:"")+"<\/sup>":f[1]?u+f[1]:"",e+o))}switch(c.match(h)[1]){case"amount":o=s(n,2);break;case"amount_no_decimals":o=s(n,0);break;case"amount_with_comma_separator":o=s(n,2,".",",");break;case"amount_no_decimals_with_comma_separator":o=s(n,0,".",",");break;case"amount_no_decimals_with_space_separator":o=s(n,0," ")}return e=c.replace(h,o),u&&(e=e.indexOf("<span")===0?"<span style='text-decoration-line: line-through !important; -webkit-text-decoration-line: line-through !important; text-decoration: line-through !important;' "+e.substr(5):"<span style='text-decoration-line: line-through !important; -webkit-text-decoration-line: line-through !important; text-decoration: line-through !important;'>"+e+"<\/span>"),e}catch(a){return discountninja.Logging.LogError("Utilities.FormatMoney",a,!0),n}},GetNoDecimalsCurrencyFormat:function(n){try{return n=n.replace("{{amount}}","{{amount_no_decimals}}"),n.replace("{{amount_with_comma_separator}}","{{amount_no_decimals_with_comma_separator}}")}catch(t){return discountninja.Logging.LogError("Utilities.GetNoDecimalsCurrencyFormat",t,!0),""}},GetCurrencyFormatAmountComponent:function(n){try{var t=n.match(/({{){1}(.)*(}}){1}/);return t!==null&&t.length>0?t[0]:n}catch(i){return discountninja.Logging.LogError("Utilities.GetCurrencyFormatAmountComponent",i,!0),""}},StringIsIn:function(n,t,i){var o,s,f,e,r,u;try{if(typeof n=="undefined"||n===null||n===""||typeof t=="undefined"||t===null||t==="")return!1;for((i===undefined||i===null)&&(i=","),o=n.split(i),s=t.split(i),f=0;f<o.length;f++)for(e=0;e<s.length;e++)if(r=o[f],u=s[e],typeof r!="undefined"&&r!==null&&r.trim()!==""&&typeof u!="undefined"&&u!==null&&u.trim()!==""&&r.toLowerCase().trim()===u.toLowerCase().trim())return!0;return!1}catch(h){return discountninja.Logging.LogError("Utilities.StringIsIn",h,!0),!1}},AppendToStyle:function(n,t,i){try{jQuery(n).attr("style",function(n,r){return(typeof r!="string"||r===null||r===undefined)&&(r=""),r!==""&&r.substr(r.length-1)!==";"&&(r=r+";"),r+t+": "+i+";"})}catch(r){discountninja.Logging.LogError("Utilities.AppendToStyle",r,!0)}},IsMobilePhone:function(){try{var n=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(n=!0)}(navigator.userAgent||navigator.vendor||window.opera),n}catch(t){return discountninja.Logging.LogError("Utilities.IsMobilePhone",t,!0),!1}},GetReferrer:function(){try{return document.referrer.indexOf(document.location.hostname)===-1&&discountninja.Cache.SessionSet("original-referrer",document.referrer),discountninja.Cache.SessionGet("original-referrer")}catch(n){return discountninja.Logging.LogError("Utilities.GetReferrer",n,!0),null}},GetEmoji:function(n){return n>65535?(n-=65536,String.fromCharCode(55296+(n>>10),56320+(n&1023))):String.fromCharCode(n)}};discountninja.Utilities=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja.Logging=discountninja.Logging||{},function(){var n={StartTime:null,WriteToConsole:!1,LogTimeElapsed:!1,LogWarningToServer:!0,StartTimer:function(){try{n.StartTime=moment().utc()}catch(t){discountninja.Logging.LogError("Logging.StartTimer","Exception in StartTimer",t,!0)}},LogError:function(t,i,r){var u,f;try{u=n.BuildErrorContext("Error occurred in "+t+" "+i);u!==null&&(f="Error occurred on page "+u.Page+" with browser "+u.Browser,n.LogToConsole("error","Discount Ninja V2 - "+f+" - Error: "+decodeURIComponent(u.Message)),r&&discountninja.ErrorHandler.LogErrorToServer(u,"error"))}catch(e){}},LogWarning:function(t,i,r){try{(r===undefined||r===null)&&(r=!1);var u=n.BuildErrorContext(t);u!==null&&(n.LogWarningToServer&&r&&discountninja.ErrorHandler.LogErrorToServer(u,"warning"),i&&n.LogToConsole("warning","Discount Ninja V2 - "+decodeURIComponent(u.Message)))}catch(f){n.LogError("Logging.LogWarning",f,!1)}},LogInformation:function(t,i){try{n.WriteToConsole&&n.LogToConsole("information","Discount Ninja V2 - "+t,"blue")}catch(r){n.LogError("Logging.LogInformation",r,i)}},LogVerbose:function(t,i){try{n.WriteToConsole&&n.LogToConsole("debug","DEBUG - Discount Ninja V2 - "+t,"gray")}catch(r){n.LogError("Logging.LogInformation",r,i)}},LogTestMode:function(t,i,r,u,f){var o,e;try{if(discountninja.TestMode.TestMode===!0&&(f=!1),(u===!0||f===!0)&&n.LogInformation(i||t,f),r===!0){for(o="- "+t+"<br/>",e=0;e<discountninja.TestMode.TestModeOutput.length;e++)if(discountninja.TestMode.TestModeOutput[e]===o)return;discountninja.TestMode.TestModeOutput.push(o);discountninja.TestMode.TestModeOutputIssue=!0}}catch(s){n.LogError("Logging.LogTestMode",s,!0)}},LogToConsole:function(t,i,r,u){var e,f;try{e=t==="error"||t==="critical"?Function.prototype.bind.call(console.error,console):t==="warn"||t==="warning"?Function.prototype.bind.call(console.warn,console):t==="debug"||t==="verbose"?Function.prototype.bind.call(console.debug,console):Function.prototype.bind.call(console.log,console);r=r||"black";u=u||!1;f="";u===!0&&(f="font-weight: bold;");e.apply(console,["%c"+i,"color: "+r+";"+f])}catch(o){try{console&&console.log(i)}catch(o){n.LogError("Logging.LogToConsole",o,!0)}}},BuildErrorContext:function(t){try{t!==undefined&&t!==null?(t=t.replace("Promotion would normally not be displayed","Promotion will not be displayed"),t=t.replace(/( Learn more)(.)*(<\/a>.)/g,""),t=encodeURIComponent(t)):t="";return{Version:n.Version,Referrer:encodeURIComponent(discountninja.Utilities.GetReferrer()),Page:window.location.href,Browser:navigator.userAgent,Message:t===undefined||t===null?"":t}}catch(r){return null}},ShowTimeElapsed:function(t){if(n.LogTimeElapsed)try{n.LogInformation("Time elapsed: "+moment().utc().diff(n.StartTime,"milliseconds")+"ms - Currently at: "+t)}catch(i){n.LogError("Logging.ShowTimeElapsed",i,!0)}},HandleQueryParameter:function(){discountninja.QueryParameter.Get("discountninjalog")?(n.WriteToConsole=!0,discountninja.Cache.SessionSet("discountninjalog",!0),discountninja.QueryParameter.Remove("discountninjalog")):discountninja.Cache.SessionGet("discountninjalog")&&(n.WriteToConsole=!0)}};discountninja.Logging=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja.Cache=discountninja.Cache||{},function(){var n={Fallback:{},SupportsCacheLocal:function(){try{return localStorage.setItem("testSupportsCacheLocal","testSupportsCacheLocal"),localStorage.removeItem("testSupportsCacheLocal"),!0}catch(n){return!1}},SupportsCacheSession:function(){try{return sessionStorage.setItem("testSupportsCacheSession","testSupportsCacheSession"),sessionStorage.removeItem("testSupportsCacheSession"),!0}catch(n){return!1}},LocalRemove:function(t){try{n.SupportsCacheLocal()?localStorage.removeItem("limoniapps-discountninja-"+t):n.SessionRemove(t)}catch(i){discountninja.Logging.LogError("Cache.LocalRemove",'For key "'+t+'". Attempting CacheSessionRemove. '+i,!0);n.SessionRemove(t)}},LocalGet:function(t){try{return n.SupportsCacheLocal()?localStorage.getItem("limoniapps-discountninja-"+t):n.SessionGet(t)}catch(i){return discountninja.Logging.LogError("Cache.LocalGet",'For key "'+t+'". Attempting CacheSessionGet. '+i,!0),n.SessionGet(t)}},LocalSet:function(t,i){try{n.SupportsCacheLocal()?(n.LocalRemove(t),localStorage.setItem("limoniapps-discountninja-"+t,i)):n.SessionSet(t,i)}catch(r){discountninja.Logging.LogError("Cache.LocalSet",'For key "'+t+'". Attempting CacheSessionSet.',r,!0);n.SessionSet(t,i)}},SessionRemove:function(t){try{n.SupportsCacheSession()?sessionStorage.removeItem("limoniapps-discountninja-"+t):n.FallbackRemove(t)}catch(i){discountninja.Logging.LogError("Cache.SessionRemove",'For key "'+t+'". Attempting CacheFallbackRemove. '+i,!0);n.FallbackRemove(t)}},SessionGet:function(t){try{return n.SupportsCacheSession()?sessionStorage.getItem("limoniapps-discountninja-"+t):n.FallbackGet(t)}catch(i){return discountninja.Logging.LogError("Cache.SessionGet",'For key "'+t+'". Attempting CacheFallbackGet. '+i,!0),n.FallbackGet(t)}},SessionSet:function(t,i){try{n.SupportsCacheSession()?(n.SessionRemove(t),sessionStorage.setItem("limoniapps-discountninja-"+t,i)):n.FallbackSet(t,i)}catch(r){discountninja.Logging.LogError("Cache.SessionSet",'For key "'+t+'". Attempting CacheFallbackSet. '+r,!0);n.FallbackSet(t,i)}},FallbackRemove:function(t){try{delete n.Fallback[t]}catch(i){discountninja.Logging.LogError("Cache.FallbackRemove",i,!0)}},FallbackGet:function(t){try{return n.Fallback.hasOwnProperty(t)?n.Fallback[t]:null}catch(i){return discountninja.Logging.LogError("Cache.FallbackGet",i,!0),null}},FallbackSet:function(t,i){try{n.Fallback[t]=String(i)}catch(r){discountninja.Logging.LogError("Cache.FallbackSet",r,!0)}},FallbackClear:function(){try{n.Fallback={}}catch(t){discountninja.Logging.LogError("Cache.FallbackClear",t,!0)}},LocalClear:function(){try{n.SupportsCacheLocal()&&localStorage.clear()}catch(t){discountninja.Logging.LogError("Cache.LocalClear",t,!0)}},SessionClear:function(){try{n.SupportsCacheSession()&&sessionStorage.clear()}catch(t){discountninja.Logging.LogError("Cache.SessionClear",t,!0)}},Clear:function(){try{n.LocalClear();n.SessionClear();n.FallbackClear()}catch(t){discountninja.Logging.LogError("Cache.ClearCache",t,!0)}}};discountninja.Cache=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja.Checkout=discountninja.Checkout||{};discountninja.Checkout.Shopify=discountninja.Checkout.Shopify||{},function(){var n={ProcessingCheckout:!1,LoadingCheckoutPopUpId:"LimoniApps-DiscountNinja-Checkout",LoadingCheckoutPopUpMessageId:"LimoniApps-DiscountNinja-Checkout-Message",LoadingCheckoutPopUpDotsId:"LimoniApps-DiscountNinja-Checkout-Dots",ServerUrl:function(){return"https://discountninjav2-draftorderapi-prod.azurewebsites.net"},UnRegisterEventHandlerForCheckout:function(){try{jQuery("body").find("a, button").each(function(){jQuery(this).off("click.discountninja.checkout");jQuery(this).off("touch.discountninja.checkout")});jQuery("body").find("form").each(function(){jQuery(this).off("submit.discountninja.checkout")})}catch(n){discountninja.Logging.LogError("Checkout.Shopify.UnRegisterEventHandlerForCheckout",n,!0)}},InjectLoadingCheckoutPopUp:function(){function u(n){var i=document.createDocumentFragment(),t=document.createElement("div");for(t.innerHTML=n;t.firstChild;)i.appendChild(t.firstChild);return i}var i,t,r;jQuery("#"+n.LoadingCheckoutPopUpId).length===0&&(i=discountninja.Settings.Settings.CartSettings,t='<div id="'+n.LoadingCheckoutPopUpId+'" style="display:none;background-color:{{CHECKOUT_OVERLAY_BACKGROUND_COLOR}};" class="limoniapps-popup limoniapps-size-small limoniapps-overlay-5 limoniapps-shape-square limoniapps-align-center limoniapps-content-bottom"><div class="limoniapps-popup-vertical-alignment-helper"><div class="limoniapps-popup-vertical-align-center"><div class="limoniapps-content" style="background-color:{{CHECKOUT_BACKGROUND_COLOR}};display:table;min-height:150px;width:300px;border:none;border-radius: 5px;"><div id="'+n.LoadingCheckoutPopUpMessageId+'" class="limoniapps-body" style="padding-left:20%;padding-right:20%;display:table-cell;vertical-align: middle;"><\/div><\/div><\/div><\/div><\/div>',t=t.replace("{{CHECKOUT_BACKGROUND_COLOR}}",i.CheckoutLoadingBackground||"white"),t=t.replace("{{CHECKOUT_OVERLAY_BACKGROUND_COLOR}}",i.CheckoutLoadingOverlay||"rgba(0,0,0,0.7)"),r=u(t),document.body.insertBefore(r,document.body.childNodes[0]))},RegisterEventHandlerForCheckout:function(){function c(n){var t,i;return n===null||n===""?"":(t=n[0],t===","&&(n=n.substr(1,n.length)),i=n.split(","),i[0])}function f(){var n="/checkout";try{n="/checkout?discount="+c(discountninja.DiscountCode.GetActiveDiscountCodesForCheckoutAsString())}catch(t){discountninja.Logging.LogError("Checkout.Shopify.RegisterEventHandlerForCheckout.FallBack","Error occurred in setting classic checkout link "+t,!0)}return n}function t(t){var i,u;try{discountninja.Logging.LogVerbose("Redirecting to standard checkout, reason: "+t);n.ProcessingCheckout=!1;i=discountninja.Settings.Settings.CartSettings;r(i.LoadingCheckoutMessage3);u=f();s();window.location.href=u}catch(e){discountninja.Logging.LogError("Checkout.Shopify.RegisterEventHandlerForCheckout.FallBack","Failed "+e,!0);window.location.href="/checkout"}}function l(n){try{if(n&&n!==""){discountninja.Logging.LogVerbose("Redirecting to checkout url: "+n);var u=discountninja.Settings.Settings.CartSettings;r(u.LoadingCheckoutMessage3);window.location=n}else discountninja.Logging.LogVerbose("Checkout URL empty"),i=i+1,i<3?h():(discountninja.Logging.LogVerbose("Attempts to get checkout URL exhausted"),t("No valid checkout url received"))}catch(f){discountninja.Logging.LogError("Checkout.Shopify.RegisterEventHandlerForCheckout.onSuccess","Could not redirect to new checkout url, attempting to redirect to standard url: "+f,!0);t("Error in processing onSuccess")}}function a(n){discountninja.Logging.LogError("Checkout.Shopify.RegisterEventHandlerForCheckout.onFailure","Call to DraftOrder Api failed, attempting to redirect to standard url: "+n,!0);t("Call to DraftOrder Api failed")}function e(){if(n.ProcessingCheckout){var i=jQuery("#"+n.LoadingCheckoutPopUpMessageId),t=discountninja.Settings.Settings.CartSettings;jQuery(i).html()===""?r(t.LoadingCheckoutMessage1):jQuery(i).html()===t.LoadingCheckoutMessage1?r(t.LoadingCheckoutMessage2):jQuery(i).html()===t.LoadingCheckoutMessage2&&r(t.LoadingCheckoutMessage1);setTimeout(function(){e()},2500)}}function o(){if(n.ProcessingCheckout){var t=jQuery("#"+n.LoadingCheckoutPopUpDotsId);jQuery(t).text()===""?jQuery(t).text("."):jQuery(t).text()==="."?jQuery(t).text(".."):jQuery(t).text()===".."?jQuery(t).text("..."):jQuery(t).text()==="..."&&jQuery(t).text("");setTimeout(function(){o()},400)}}function v(i){try{var r=jQuery("#"+n.LoadingCheckoutPopUpId);i?r.css("display",""):r.css("display","none");i&&o();i&&e()}catch(u){discountninja.Logging.LogError("Checkout.Shopify.RegisterEventHandlerForCheckout.showLoadingCheckoutPopUp","Could not hide or show Loading Checkout pop-up: "+u,!0);t("Failure in showLoadingCheckoutPopUp")}}function r(t){var i=jQuery("#"+n.LoadingCheckoutPopUpMessageId),r='<div id="'+n.LoadingCheckoutPopUpDotsId+'" style="position:absolute;font-size:50px;color:rgba(0,0,0,0.3);bottom:20px;left:130px;"><\/div>';i.html(t+r)}function s(){event.preventDefault();event.stopPropagation()}function h(){i<3&&(discountninja.Logging.LogVerbose("Getting checkout URL, attempt "+i),discountninja.XmlHttpRequest.Send(n.ServerUrl()+"/api/GetCheckoutUrl",n.BuildParameters(),n.BuildPayLoad(),"post",!0,!0,l,a,1,3))}function y(){var r,u;try{if(discountninja.Logging.LogVerbose("Checkout triggered"),r=n.RequiresDraftOrderCheckout(),!r)return t("No draftorder required");s();u=f();discountninja.Logging.LogVerbose("Not redirecting to checkout; fallback would have been "+u+".");v(!0);setTimeout(function(){discountninja.Logging.LogError("Checkout.Shopify.RegisterEventHandlerForCheckout.onCheckoutInner","Timed out, redirecting to standard checkout",!0);t("Timeout")},3e4);i=1;h()}catch(e){discountninja.Logging.LogError("Checkout.Shopify.RegisterEventHandlerForCheckout.onCheckoutInner","Error occurred in onCheckoutInner "+e,!0);n.ProcessingCheckout=!1}}function u(t){try{if(n.ProcessingCheckout)return;n.ProcessingCheckout=!0;discountninja.Cart.Shopify.UpdateCart(discountninja.DiscountedCart.BuildDiscountedCart(y(t)))}catch(i){discountninja.Logging.LogError("Checkout.Shopify.RegisterEventHandlerForCheckout.onCheckout","Error occurred in OnCheckout "+i,!0);n.ProcessingCheckout=!1}}try{var i=1;discountninja.Logging.LogVerbose("Registering event handler for checkout");n.UnRegisterEventHandlerForCheckout();jQuery(':submit[name="checkout"]').not(".limoniapps-discountninja-ignore").each(function(){jQuery(this).on("click.discountninja.checkout touch.discountninja.checkout",function(n){u(n)})});jQuery('a[href^="/checkout"]').not(".limoniapps-discountninja-ignore").each(function(){jQuery(this).on("click.discountninja.checkout touch.discountninja.checkout",function(n){u(n)})});jQuery('button[onclick*="/checkout"]').not(".limoniapps-discountninja-ignore").each(function(){jQuery(this).on("click.discountninja.checkout touch.discountninja.checkout",function(n){u(n)})})}catch(p){discountninja.Logging.LogError("Checkout.Shopify.RegisterEventHandlerForAddToCart",p,!0)}},RequiresDraftOrderCheckout:function(){function u(){var r,t,i,u,n,f,e,o;try{if(r=discountninja.DiscountCode.GetActiveDiscountCodesForCheckoutAsArray(),!r||r.length==0)return!1;for(t=0;t<discountninja.Promotion.Promotions.length;t++)if(i=discountninja.Promotion.Promotions[t],i.ExcludeCollectionHandles){for(u=!1,n=0;n<discountninja.DiscountedCart.DiscountedCart.items.length;n++)if(discountninja.DiscountedCart.DiscountedCart.items[n].Token===i.Token){u=!0;break}if(u&&window.limoniapps_discountninja_liquid&&window.limoniapps_discountninja_liquid.Cart&&window.limoniapps_discountninja_liquid.Cart.items)for(n=0;n<window.limoniapps_discountninja_liquid.Cart.items.length;n++)if(f=window.limoniapps_discountninja_liquid.Cart.items[n],f&&(e=f.handle,o=discountninja.ProductData.GetByProductHandle(e),discountninja.Utilities.StringIsIn(o.Collections,i.ExcludeCollectionHandles)))return discountninja.Logging.LogVerbose("Detected excluded product "+e+", using Draft Order checkout"),!0}return!1}catch(s){return discountninja.Logging.LogVerbose("CartIncludesExcludedProduct failed "+s),!1}}var i,n,r,t;try{if(i=discountninja.Settings.Settings.CartSettings,n=i.CheckoutMode,n==="standard")return discountninja.Logging.LogVerbose("Configured to use standard checkout. Redirecting."),!1;if(n==="mixed"){if(r=u(),!r&&(t=discountninja.DiscountCode.GetActiveDiscountCodesForCheckoutAsArray(),!t||t.length<2))return discountninja.Logging.LogVerbose("Configured to use mixed checkout. Not using draftorder because zero or one discount code were detected."),!1}else n==="draftorder"&&discountninja.Logging.LogVerbose("Configured to use draft order checkout.");return!0}catch(f){discountninja.Logging.LogError("Checkout.Shopify.RequiresDraftOrderCheckout",f,!0)}},BuildParameters:function(){try{return{shop:discountninja.Shop}}catch(n){return discountninja.Logging.LogError("Checkout.Shopify.BuildParameters",n,!0),null}},BuildPayLoad:function(){function n(){return discountninja.DiscountCode.GetFromCache()}function t(){var i=[],n=window.limoniapps_discountninja_liquid&&window.limoniapps_discountninja_liquid.Cart&&window.limoniapps_discountninja_liquid.Cart.items?window.limoniapps_discountninja_liquid.Cart.items:null,t;if(n&&n.length>0)for(t=0;t<n.length;t++)i.push({Quantity:n[t].quantity,VariantId:n[t].variant_id,ProductHandle:n[t].handle,Token:discountninja.Promotion.GetTokenForProductFromCache(n[t].handle)});return i}function i(){var i=[],n=window.limoniapps_discountninja_liquid&&window.limoniapps_discountninja_liquid.Cart?window.limoniapps_discountninja_liquid.Cart.attributes:null,t;if(n==null)return null;for(t in n)i.push({Name:t,Value:n[t]})}function r(){try{return{LineItems:t(),DiscountCodes:n(),Attributes:i()}}catch(r){return discountninja.Logging.LogError("Checkout.Shopify.BuildPayLoad.BuildOrderDetailsJson",r,!0),null}}try{return{shop:discountninja.Shop,orderDetailsJson:JSON.stringify(r())}}catch(u){return discountninja.Logging.LogError("Checkout.Shopify.BuildPayLoad",u,!0),null}},PrepareDraftOrder:function(){function t(n){discountninja.Logging.LogVerbose("Prepared draft order: "+n)}function i(){discountninja.Logging.LogVerbose("Failed to prepare draft order.")}function r(){n.RequiresDraftOrderCheckout()?discountninja.XmlHttpRequest.Send(n.ServerUrl()+"/api/PrepareCheckoutUrl",n.BuildParameters(),n.BuildPayLoad(),"post",!0,!0,t,i,1,2):discountninja.Logging.LogVerbose("Draft order not required")}try{discountninja.Cart.Shopify.UpdateCart(discountninja.DiscountedCart.BuildDiscountedCart(r))}catch(u){discountninja.Logging.LogError("Checkout.Shopify.PrepareDraftOrder",u,!0)}}};discountninja.Checkout.Shopify=n}(),function(){var n={GetCookie:function(n){return(document.cookie.match("(^|; )"+n+"=([^;]*)")||0)[2]},GetDiscountCodeCookie:function(){return n.GetCookie("discount_code")},GetTestModeCookie:function(){return n.GetCookie("test_mode")=="1"},AppendTestModeToCookie:function(){n.RemoveDiscountCodesFromCookie();document.cookie="test_mode=1; path=/"},AppendDiscountCodeToCookie:function(t){n.RemoveDiscountCodesFromCookie();var i="discount_code="+encodeURI(t)+"; path=/";discountninja.Logging.LogVerbose("Adding/updating cookie: "+i,!1);document.cookie=i},RemoveDiscountCodesFromCookie:function(){document.cookie="discount_code=;expires=Thu, 01 Jan 1970 00:00:01 GMT;";document.cookie="discount_code=;expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/"}};discountninja.Cookie=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja.Environment=discountninja.Environment||{};discountninja.Environment.Shopify=discountninja.Environment.Shopify||{},function(){var n={MyShopifyDomain:function(){var n="",t;try{n=Shopify.shop}catch(i){discountninja.Logging.LogError("Environment.Shopify.MyShopifyDomain","GetMyShopifyDomain while reading Shopify.shop",i,!0)}try{return(n===undefined||n===null||n==="")&&(t="undefined",typeof Shopify!="undefined"&&Shopify!==undefined&&(t=JSON.stringify(Shopify)),n=window.top.location.hostname,discountninja.Logging.LogError("Environment.Shopify.MyShopifyDomain","GetMyShopifyDomain could not retrieve domain from Shopify.shop property. Shopify object is "+t+". Falling back to URL hostname ("+n+").",!0)),n}catch(i){discountninja.Logging.LogError("Environment.Shopify.MyShopifyDomain","GetMyShopifyDomain while reading Shopify.shop",i,!0)}},UrlPath:function(){try{var t=n.TrimmedPathName();return t.toLowerCase()}catch(i){return discountninja.Logging.LogError("Environment.Shopify.UrlPath",i,!0),""}},IsCartPage:function(){return n.UrlPath()==="/cart"},IsProductPage:function(){return n.UrlPath().indexOf("/products/")>-1},IsCollectionPage:function(){var t=n.UrlPath();return t==="/collections"||t.indexOf("/products/")===-1&&t.indexOf("/collections/")>-1},IsHomePage:function(){var t=n.UrlPath();return t===""||t==="/"},IsBlogPost:function(){return n.UrlPath().indexOf("/blogs/")>-1},IsCustomPage:function(){return n.UrlPath().indexOf("/pages/")>-1},BlogHandle:function(){var t,r,i,u;try{return(t=n.TrimmedPathName(),r=t.indexOf("/blogs/"),r===-1)?null:(i=t.indexOf("/",r+1),i===-1)?null:(u=t.indexOf("/",i+1),u===-1?decodeURIComponent(t).substr(i+1):decodeURIComponent(t).substr(i+1,u-i-1))}catch(f){return discountninja.Logging.LogError("Environment.Shopify.BlogHandle",f,!0),null}},BlogPostHandle:function(){var t,i,r,u;try{return(t=n.TrimmedPathName(),i=t.indexOf("/blogs/"),i===-1)?null:(r=t.indexOf("/",i+1),r===-1)?null:(u=t.indexOf("/",r+1),u===-1)?null:decodeURIComponent(t).substr(u+1)}catch(f){return discountninja.Logging.LogError("Environment.Shopify.BlogPostHandle",f,!0),null}},CollectionHandle:function(){var t,r,i;try{return(t=n.UrlPath(),r=t.indexOf("/collections/"),r<0)?"":(t=t.replace("/collections/",""),i=t.indexOf("/"),i<0?t:t.substr(0,i))}catch(u){return discountninja.Logging.LogError("Environment.Shopify.CollectionHandle",u,!0),""}},PageType:function(){if(n.IsProductPage())return"product";if(n.IsCollectionPage())return"collection";if(n.IsHomePage())return"home";if(n.IsCartPage())return"cart";if(n.IsBlogPost())return"blogpost";if(n.IsCustomPage())return"custom";"unknown"},VariantId:function(){function f(){return discountninja.QueryParameter.Get("variant")}var t,i,r,u;if(!n.IsProductPage())return null;try{if(t=document.querySelector("form [name^='id']"),t!==null&&typeof t.options=="object"&&typeof t.selectedIndex=="number"&&t.options[t.selectedIndex]!==undefined&&(i=t.options[t.selectedIndex].value,i!==undefined&&i!==null&&i!==""&&i!==0&&!isNaN(i)))return discountninja.Logging.LogVerbose("Returning variant from form: "+i),i}catch(t){discountninja.Logging.LogError("Environment.Shopify.VariantId",t,!1)}try{if(r=f(),r!==undefined&&r!==null&&r!=="")return discountninja.Logging.LogVerbose("Returning variant from query parameter: "+r),r}catch(t){discountninja.Logging.LogError("Environment.Shopify.VariantId",t,!1)}try{if(u=discountninja.LiquidData.ProductDefaultVariantId(),u!==undefined&&u!==null&&u!=="")return discountninja.Logging.LogVerbose("Returning variant from liquid: "+u),u}catch(t){discountninja.Logging.LogError("Environment.Shopify.VariantId",t,!1)}return discountninja.Logging.LogError("Environment.Shopify.VariantId","No variant information found",!1),null},TrimmedPathName:function(){var n,t;try{return(n=window.location.pathname,n===null||n==="")?n:(t=n.slice(-1),t==="/"&&(n=n.substr(0,n.length-1)),n)}catch(i){return discountninja.Logging.LogError("Environment.Shopify.GetLastPartOfPathName",i,!0),null}},ProductHandle:function(){try{var t=n.TrimmedPathName();return t.indexOf("/products/")===-1?null:decodeURIComponent(t).substr(t.lastIndexOf("/")+1)}catch(i){return discountninja.Logging.LogError("Environment.Shopify.ProductHandle",i,!0),null}},CustomPageHandle:function(){try{var t=n.TrimmedPathName();return t.indexOf("/pages/")===-1?null:decodeURIComponent(t).substr(t.lastIndexOf("/")+1)}catch(i){return discountninja.Logging.LogError("Environment.Shopify.CustomPageHandle",i,!0),null}},IsCustomer:function(){return typeof limoniapps_discountninja_liquid!="undefined"&&window.limoniapps_discountninja_liquid.Customer!==null},CustomerTags:function(){return window.limoniapps_discountninja_liquid.Customer!==null&&window.limoniapps_discountninja_liquid.Customer.Tags!==null?window.limoniapps_discountninja_liquid.Customer.Tags:null}};discountninja.Environment.Shopify=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja.QueryParameter=discountninja.QueryParameter||{},function(){var n={GetQueryParameters:function(n){var i;try{var u=n===null||n===undefined?window.location.href.replace(window.location.hash,""):n.indexOf("#")>-1?n.substring(0,n.indexOf("#")):n,r=[],t,f=u.slice(u.indexOf("?")+1).split("&");for(i=0;i<f.length;i++)t=f[i].split("="),r.push(t[0]),r[t[0]]=t[1];return r}catch(e){return discountninja.Logging.LogError("QueryParameter.GetQueryParameters",e,!0),[]}},Get:function(t){try{var r=n.GetQueryParameters(),i=r[t];return i==="undefined"||i==="null"||i==="UNDEFINED"||i==="NULL"||i===null?null:i}catch(u){return discountninja.Logging.LogError("QueryParameter.Get",u,!0),null}},Remove:function(t){var r,u,o,i,f,e;try{r=n.GetQueryParameters();u=[];for(o in Object.keys(r))i=r[o],f=r[i],typeof i!="undefined"&&i!==null&&typeof f!="undefined"&&f!==null&&i!==t&&u.push(i+"="+f);e=u.length<1?"":"?"+u.join("&");window.history&&window.history.replaceState?window.history.replaceState({},document.title,location.origin+location.pathname+e):document.location.search=e}catch(s){discountninja.Logging.LogError("QueryParameter.Remove",s,!0)}},RemoveFromUrl:function(n,t,i){try{return n.replace(t+"="+i,"")}catch(r){discountninja.Logging.LogError("QueryParameter.RemoveFromUrl",r,!0)}},AppendToUrl:function(t,i,r,u){var f,e;try{return(r=encodeURI(r),f=n.GetQueryParameters(t)[i],f!==undefined&&f===r)?t:(u&&f!==undefined&&(t=n.RemoveFromUrl(t,i,f)),e="",e=t.indexOf("?")>0?t+"&"+i+"="+r:t+"?"+i+"="+r,e.replace("?&","?"))}catch(o){discountninja.Logging.LogError("QueryParameter.AppendToUrl",o,!0)}}};discountninja.QueryParameter=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja.XmlHttpRequest=discountninja.XmlHttpRequest||{},function(){var n={HandleFetch:function(t,i){function u(n){try{return typeof n.get!="function"?null:{variant:n.get("id"),quantity:n.get("quantity")}}catch(t){return discountninja.Logging.LogError("XMLHttpRequest.HandleFetch.ParseCartAddParametersFromFormData",t,!0),null}}try{discountninja.Logging.LogVerbose("HandleFetch called "+t);var r=null;try{r=i.body}catch(f){r=null}r?n.HandleCartJsonRequest(t,u(r)):discountninja.Logging.LogWarning("Invalid form data in ParseCartAddParametersFromFormData ",!0,!1)}catch(f){discountninja.Logging.LogError("XMLHttpRequest.HandleFetch",f,!0)}},HandleSend:function(t){function r(n){var i,t,r;try{return(i=typeof n!="undefined"&&n!==undefined&&n!==null,i&&(t=discountninja.QueryParameter.GetQueryParameters(n),r=typeof t!="undefined"&&t!==undefined&&t!==null&&t.id&&t.quantity,r))?{variant:t.id,quantity:t.quantity}:(discountninja.Logging.LogVerbose("ParseCartAddParametersFromUrl could not find id / quantity parameters"),null)}catch(u){return discountninja.Logging.LogError("XMLHttpRequest.HandleSend.ParseCartAddParametersFromUrl",u,!0),null}}var i;try{if(this.readyState===4){if(this.responseType!=="text"&&this.responseType!==""){discountninja.Logging.LogVerbose("HandleSend cannot handle response of type "+this.responseType);return}i=this.responseURL||this._url;n.HandleCartJsonRequest(i,r(t))}}catch(u){discountninja.Logging.LogError("XMLHttpRequest.HandleSend",u,!0)}},HandleCartJsonRequest:function(t,i){var r,u;try{discountninja.Logging.LogVerbose("Handling cart json request for url "+t);r=typeof t!="undefined"&&t!==undefined&&t!==null;r?t.indexOf("/cart/add")>-1?(discountninja.Logging.LogVerbose("Handling cart add post"),u=typeof i!="undefined"&&i!==undefined&&i!==null&&i.variant&&i.quantity,u?n.HandleAddToCart(i.variant,i.quantity):discountninja.Logging.LogWarning("Invalid params in HandleCartJsonRequest",!0,!1)):t.indexOf("/cart/change")>-1?(discountninja.Logging.LogVerbose("Handling cart change post"),n.HandleUpdateCart("/cart/change")):t.indexOf("/cart/update")>-1?(discountninja.Logging.LogVerbose("Handling cart update post"),n.HandleUpdateCart("/cart/update")):discountninja.Logging.LogVerbose("Not handling url "+t+", forwarding to original caller"):discountninja.Logging.LogWarning("Invalid url in HandleCartJsonRequest",!0,!1)}catch(f){discountninja.Logging.LogError("XMLHttpRequest.HandleCartJsonRequest",f,!0)}},HandleAddToCart:function(n){try{discountninja.Logging.LogVerbose("Handling XMLHttpRequest from cart/add");discountninja.Cart.Shopify.UpdateCart(function(){discountninja.Cart.Shopify.OnAddToCart(null,n)})}catch(t){discountninja.Logging.LogError("XMLHttpRequest.ModifyResponseHandleCartUpdate",t,!0)}},HandleUpdateCart:function(n){try{discountninja.Logging.LogVerbose("Handling XMLHttpRequest from "+n);discountninja.Cart.Shopify.UpdateCart(function(){discountninja.Cart.Shopify.OnUpdateCart()})}catch(t){discountninja.Logging.LogError("XMLHttpRequest.HandleCartChange",t,!0)}},CreateSendInterceptor:function(n,t,i){return function(r){try{return this.addEventListener(n,t.bind(this,r)),i.apply(this,arguments)}catch(u){discountninja.Logging.LogError("XMLHttpRequest.CreateSendInterceptor",u,!0)}}},CreateFetchInterceptor:function(n,t){return function(){try{return n.apply(this,arguments),t.apply(this,arguments)}catch(i){discountninja.Logging.LogError("XMLHttpRequest.CreateFetchInterceptor",i,!0)}}},Send:function(t,i,r,u,f,e,o,s,h,c){function v(t,i,u,f,e,o,s,h,c){function v(n){var r,t,i,u,f;if(n===undefined||n===null)return"";for(r=Object.getOwnPropertyNames(n),t="",i=0;i<r.length;i++)u=r[i],f=n[u],t=t===""?"?":t+"&",t=t+encodeURIComponent(u)+"="+encodeURIComponent(f);return t}function y(n){var t=null;try{t=f?n===undefined||n===null?null:JSON.parse(n):n}catch(i){}typeof o=="function"&&o!==null&&o(t)}function p(l){var v="Could not "+u+" data from "+a+" on attempt "+h+". Request status: "+l+" - Parameters: "+JSON.stringify(i);discountninja.Logging.LogWarning(v,!0,e);setTimeout(function(){n.Send(t,i,r,u,f,e,o,s,h+1,c)},500*h)}var w=v(i),a=t+w,l;discountninja.Logging.LogVerbose("Sending request to "+a+" from SendXMLHttpRequest",!1);l=typeof XMLHttpRequest!="undefined"?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");l.open(u,a,!0);l.onreadystatechange=function(){var n;l.readyState==4&&(n=l.status,n==200?y(l.responseText):p(n))};r===null?l.send():(l.setRequestHeader("Content-Type","application/json"),l.send(JSON.stringify(r)))}try{if((c===undefined||c===null)&&(c=5),(h===undefined||h===null)&&(h=1),h>=c){var l="SendHttpRequest failed. Retry iterations ("+c+") exceeded for url "+t;discountninja.Logging.LogError("XMLHttpRequest.Send",l,e);typeof s=="function"&&s!==null&&s(l);return}v(t,i,u,f,e,o,s,h,c)}catch(a){try{discountninja.Logging.LogToConsole("error","Error occurred in Send for url "+t+". Error: "+a)}catch(y){}try{typeof s=="function"&&s!==null&&s(a)}catch(p){}}}};discountninja.XmlHttpRequest=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja.DiscountCode=discountninja.DiscountCode||{},function(){var n={InjectDiscountCodesInHtmlElements:function(n,t){function i(n,t){try{var i=discountninja.QueryParameter.RemoveFromUrl(n,"discount",t);return i.replace(/attributes\[limoniapps\-discounturl\]\=(.)*(\&)?/g,"")}catch(r){discountninja.Logging.LogError("DiscountCode.UndoInjectDiscountCodeInUrl",r,!0)}}function r(n,t){try{return discountninja.QueryParameter.AppendToUrl(n,"discount",t,!0)}catch(i){discountninja.Logging.LogError("DiscountCode.AppendDiscountCodeToUrl",i,!0)}}try{jQuery('a[href^="/checkout"]').each(function(){if(!jQuery(this).hasClass("discountninja-ignore")){var u=jQuery(this).attr("href"),f=t?i(u,n):r(u,n);jQuery(this).attr("href",f)}});jQuery('form[action^="/checkout"]').each(function(){if(!jQuery(this).hasClass("discountninja-ignore")){var u=jQuery(this).attr("action"),f=t?i(u,n):r(u,n);jQuery(this).attr("action",f)}});jQuery('button[onclick*="/checkout"]').each(function(){var o,u,f,s,e,h;try{if(jQuery(this).hasClass("discountninja-ignore"))return;o=jQuery(this).attr("onclick");u=o.match(/(['"]){1}(.)*(['"])/g);u!==null&&u.length===1&&(f=u[0],s=f.length,s>2&&(e=f.substr(1,f.length-2),h=t?i(e,n):r(e,n),jQuery(this).attr("onclick",o.replace(e,h))))}catch(c){}});jQuery('form[action="/cart"], form[action^="/cart?"]').each(function(){if(!jQuery(this).hasClass("discountninja-ignore")){var u=jQuery(this).attr("action"),f=t?i(u,n):r(u,n);jQuery(this).attr("action",f)}});jQuery('form[action^="/checkout"]').find(":submit").addClass("saso-ignore")}catch(u){discountninja.Logging.LogError("DiscountCode.InjectDiscountCodesInHtmlElements",u,!0)}},UndoInjectDiscountCodesInHtml:function(){var t,i;try{if(t=discountninja.Promotion.Promotions,!t)return;for(i=0;i<t.length;i++)n.InjectDiscountCodesInHtmlElements(n.GetDiscountCode(t[i].Token),!0)}catch(r){discountninja.Logging.LogError("DiscountCode.UndoInjectDiscountCodesInHtml",r,!0)}},InjectDiscountCodesInHtml:function(){function i(n){var t,i;try{t=jQuery('form[action^="/checkout"]');t!==null&&t.length>0&&(i=0,t.each(function(){if(!jQuery(this).hasClass("discountninja-ignore")){var n=jQuery(this).find('input[name="discount"]');(n===null||n.length===0)&&(jQuery("<input>").attr("type","hidden").attr("name","discount").addClass("limoniapps-discountninja-discount-attribute").attr("id","limoniapps-discountninja-discount-attribute-"+i).appendTo(this),i++)}}));jQuery('form[action^="/checkout"], form[action^="/cart"] input[name="discount"], .limoniapps-discountninja-discount-attribute').each(function(){jQuery(this).hasClass("discountninja-ignore")||jQuery(this).attr("value",n)})}catch(r){discountninja.Logging.LogError("UpdateFormInputDiscountCode",r,!0)}}try{var t=n.GetActiveDiscountCodesForCheckoutAsString();if(t==="")return;n.InjectDiscountCodesInHtmlElements(t,!1);i(t);discountninja.Cookie.AppendDiscountCodeToCookie(t);discountninja.Logging.ShowTimeElapsed("Inject discount code in HTML complete")}catch(r){discountninja.Logging.LogError("DiscountCode.InjectDiscountCodesInHtml",r,!0)}},GetFromCache:function(){try{var n=discountninja.Cache.SessionGet("discountcode-data");return n=n==="undefined"?[]:JSON.parse(n),n===null?[]:n}catch(t){return discountninja.Logging.LogError("DiscountCode.GetFromCache",t,!0),[]}},SaveToCache:function(n){try{discountninja.Cache.SessionSet("discountcode-data",JSON.stringify(n))}catch(t){discountninja.Logging.LogError("DiscountCode.SaveToCache",t,!0)}},Add:function(t,i,r,u){(i===null||r===null)&&discountninja.Logging.LogWarning("DiscountCode.Add - No discountcode or priceruleid available",!0,!1,!1);for(var f=n.GetFromCache(),e=f.length;e--;)f[e]&&f[e].Token===t&&f.splice(e,1);f.push({Token:t,DiscountCode:i,PriceRuleId:r,TargetType:u});n.InjectDiscountCodesInHtml();n.SaveToCache(f)},Remove:function(t){for(var r=n.GetFromCache(),u=[],i=0;i<r.length;i++)r[i].Token!==t&&u.push(r[i]);n.SaveToCache(u)},Clear:function(){discountninja.Cache.SessionRemove("discountcode-data")},GetActiveDiscountCodesForCheckoutAsArray:function(){for(var t,i,r,e=n.GetFromCache(),u=[],f=0;f<e.length;f++)if(t=e[f],t!==null&&t.DiscountCode!=="")if(t.TargetType==="line_item"){if(i=discountninja.DiscountedCart.DiscountedCart,i&&i.items.length>0)for(r=0;r<i.items.length;r++)if(i.items[r].Token==t.Token){u.push(t.DiscountCode);break}}else u.push(t.DiscountCode);return u},GetActiveDiscountCodesForCheckoutAsString:function(){var t=n.GetActiveDiscountCodesForCheckoutAsArray(),i=t.length===0?"":t.join(",");return encodeURIComponent(i)},GetActiveLineItemDiscountCodes:function(){for(var t,u=n.GetFromCache(),i=[],r=0;r<u.length;r++)t=u[r],t!==null&&t.DiscountCode!==""&&t.TargetType==="line_item"&&i.push(t.DiscountCode);return i.length===0?"":i.join(",")},GetDiscountCode:function(t){for(var r=n.GetFromCache(),i=0;i<r.length;i++)if(r[i].Token===t)return r[i].DiscountCode;return null}};discountninja.DiscountCode=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja.DiscountedCart=discountninja.DiscountedCart||{},function(){var n={DiscountedCart:null,BuildDiscountedCart:function(t){function o(n){try{discountninja.Cache.LocalSet("discounted-cart",JSON.stringify(n))}catch(t){discountninja.Logging.LogError("DiscountedCart.SaveDiscountedCartToCache",t,!0)}}function s(n){var t,i,r,u,f;try{if(!n)return;if(t=n.items,!t)return;for(i=0;i<t.length;i++)r=discountninja.Promotion.GetTokenForProductFromCache(t[i].ProductHandle),r||(u=discountninja.ProductData.GetByProductHandle(t[i].ProductHandle,!0),f=discountninja.Promotion.GetPromotionForProduct(t[i].ProductHandle,u.Collections,u.Inventory,u.Price),f&&discountninja.Promotion.SetTokenForProductInCache(t[i].ProductHandle,f.Token),r=discountninja.Promotion.GetTokenForProductFromCache(t[i].ProductHandle)),t[i].Token=r}catch(e){discountninja.Logging.LogError("DiscountedCart.EnsureTokensForCartProducts",e,!0)}}function h(n,t,i,r,u,f,e,o){var c,l,s,a,h;try{if(discountninja.Logging.LogVerbose("Evaluating if item with variantid "+t+" and handle "+i+" must be added to discounted cart"),c=null,l=discountninja.Promotion.GetPromotionForProduct(i,o,f,r),l&&(c=l.PriceRuleInfo),c&&c.TargetType!=="shipping_line"){for(discountninja.Logging.LogVerbose("Adding item with variantid "+t+" and handle "+i+" to discounted cart"),s=discountninja.DiscountedProduct.Get(t,i,r,u,f,l),a=-1,h=0;h<n.items.length;h++)if(n.items[h].VariantId==t){a=h;break}a===-1?(discountninja.Logging.LogVerbose("Adding line in discounted cart"),n.items.push(s)):(discountninja.Logging.LogVerbose("Updating line discounted cart"),n[a]=s);discountedPrice=s.DiscountedPrice;n.total_discounted_price+=discountedPrice;n.total_discount+=s.Amount*e}else n.total_discounted_price+=r;return n}catch(v){return discountninja.Logging.LogError("DiscountedCart.AddDiscountedCartItem",v,!0),n}}var e,r,u,i,f;try{if(discountninja.Logging.LogVerbose("Building discounted cart"),e=discountninja.Promotion.Promotions,e&&e.length!==0)if(discountninja.Logging.LogVerbose("Building discounted cart - Promotions available, continuing"),r=window.limoniapps_discountninja_liquid.Cart,r!==undefined&&r.items!==undefined){for(u={items:[],total_discounted_price:0,total_discount:0},u.total_discounted_price=0,u.total_discount=0,i=0;i<r.items.length;i++)discountninja.Logging.LogVerbose("Building discounted cart - Evaluating cart item "+i),f=discountninja.ProductData.GetByProductHandle(r.items[i].handle,!0),f?(discountninja.Logging.LogVerbose("Building discounted cart - Promotion data found for cart item "+i+" with variant id "+r.items[i].variant_id+" and handle "+r.items[i].handle),u=h(u,r.items[i].variant_id,r.items[i].handle,r.items[i].price/100,f.CompareAtPrice,f.Inventory,r.items[i].quantity,f.Collections)):discountninja.Logging.LogVerbose("Building discounted cart - No promotion data found for cart item "+i+" with variant id "+r.items[i].variant_id+" and handle "+r.items[i].handle);s(u);o(u);n.DiscountedCart=u}else return discountninja.Logging.LogVerbose("Building discounted cart - Cart empty, aborting"),null;else discountninja.Logging.LogVerbose("Building discounted cart - Promotions unavailable, aborting")}catch(c){discountninja.Logging.LogError("DiscountedCart.BuildDiscountedCart",c,!0)}t!==undefined&&t!==null&&typeof t=="function"&&t()},GetCartVariantIds:function(){function r(){try{var n=discountninja.Cache.LocalGet("discounted-cart");return n==="undefined"?null:JSON.parse(n)}catch(t){return discountninja.Logging.LogError("DiscountedCart.GetDiscountedCartFromCache",t,!0),null}}var t,i;try{if(n.DiscountedCart=r(),n.DiscountedCart&&n.DiscountedCart.items){for(t="",i=0;i<n.DiscountedCart.items.length;i++)t!==""&&(t=t+","),t=t+n.DiscountedCart.items[i].VariantId;return t}return""}catch(u){discountninja.Logging.LogError("DiscountedCart.GetCartVariantIds",u,!0)}}};discountninja.DiscountedCart=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja.DiscountedProduct=discountninja.DiscountedProduct||{},function(){var n={Get:function(n,t,i,r,u,f){var h,o,s;try{if(h=discountninja.DiscountLevel.GetCurrentDiscountLevel(f),h===null)return null;var c=f.PriceRuleInfo,l=c.ValueType,a=c.DiscountPriceType,v=h.Amount,y=h.Percentage,p=discountninja.Settings.Settings.CurrencySettings.RoundPrices,w=discountninja.Settings.Settings.CurrencySettings.RoundToCents,e={VariantId:n,ProductHandle:t,OriginalPrice:i,OriginalCompareAtPrice:r,Amount:v,Percentage:y};return(e.OriginalCompareAtPrice===undefined||e.OriginalCompareAtPrice===null||e.OriginalCompareAtPrice===0||isNaN(e.OriginalCompareAtPrice)||e.OriginalCompareAtPrice<e.OriginalPrice)&&(e.OriginalCompareAtPrice=e.OriginalPrice),e.EffectiveCompareAtPrice=e.OriginalCompareAtPrice,a==="price"&&(e.EffectiveCompareAtPrice=e.OriginalPrice),o=e.EffectiveCompareAtPrice,o>0?(l=="fixed_amount"?(e.DiscountedPrice=o-e.Amount,e.Percentage=o===0?0:Math.abs(e.Amount/o*100)):l=="percentage"&&(e.DiscountedPrice=parseFloat((o-Math.floor(o*e.Percentage)/100).toFixed(4)),e.Amount=o-e.DiscountedPrice),e.DiscountedPrice<0&&(e.DiscountedPrice=0),e.DiscountedPriceRaw=e.DiscountedPrice,p&&(s=e.DiscountedPrice*100,s>0&&(s=Math.floor(s/100)*100+w),e.DiscountedPrice=Math.round(s)/100)):(e.DiscountedPrice=0,e.DiscountedPriceRaw=e.DiscountedPrice),e.DiscountedPrice=Math.round(e.DiscountedPrice*100)/100,e.InventoryLeft=u,e.Token=discountninja.Promotion.GetTokenForProductFromCache(t),e.DiscountCode=discountninja.DiscountCode.GetDiscountCode(e.Token),e}catch(b){return discountninja.Logging.LogError("DiscountedProduct.Get",b,!0),null}},GetFromProductPage:function(){try{if(discountninja.Environment.Shopify.IsProductPage()){var r=discountninja.Environment.Shopify.ProductHandle(),t=discountninja.Environment.Shopify.VariantId(),u=discountninja.LiquidData.Price(t),e=discountninja.LiquidData.CompareAtPrice(t),f=discountninja.LiquidData.Inventory(t),i=discountninja.Promotion.GetPromotionForProduct(r,null,f,u);return!i||!i.PriceRuleInfo?null:n.Get(t,r,u,e,f,i)}return null}catch(o){discountninja.Logging.LogError("DiscountedProduct.GetFromProductPage",o,!0)}}};discountninja.DiscountedProduct=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja.DiscountLevel=discountninja.DiscountLevel||{},function(){var n={GetPromotionDiscountLevelAmount:function(n){return n?n.DiscountLevel1.Amount:0},GetPromotionDiscountLevelPercentage:function(n){return n?n.DiscountLevel1.Percentage:0},GetCurrentDiscountLevelNumber:function(n,t){function i(n,t){try{return n?n.CartValueMinimum&&n.CartValueMinimum*100>t?!1:!0:!1}catch(i){return discountninja.Logging.LogError("DiscountLevel.DiscountLevelIsApplicable",i,!0),!1}}try{if(!discountninja.Promotion.PromotionIsApplicable(n))return null;var r=n.PriceRuleInfo,u=i(r.DiscountLevel1,t),f=i(r.DiscountLevel2,t),e=i(r.DiscountLevel3,t);return e?3:f?2:u?1:t>0?0:-1}catch(o){return discountninja.Logging.LogError("DiscountLevel.GetCurrentDiscountLevelNumber",o,!0),-1}},GetMaxDiscountLevelNumber:function(n){try{return typeof n.DiscountLevel3=="object"?3:typeof n.DiscountLevel2=="object"?2:1}catch(t){return discountninja.Logging.LogError("DiscountLevel.GetMaxDiscountLevelNumber",t,!0),1}},GetCurrentDiscountLevel:function(t){var u,i,r;try{return(u=discountninja.LiquidData.CartValue(),i=n.GetCurrentDiscountLevelNumber(t,u),i===null)?null:(r=t.PriceRuleInfo,i===3)?r.DiscountLevel3:i===2?r.DiscountLevel2:i===1?r.DiscountLevel1:null}catch(f){return discountninja.Logging.LogError("DiscountLevel.GetCurrentDiscountLevel",f,!0),null}},GetGoalDiscountLevelNumber:function(t){var u,i,f,r;try{return(u=discountninja.LiquidData.CartValue(),i=n.GetCurrentDiscountLevelNumber(t,u),i===null)?null:(f=t.PriceRuleInfo,r=n.GetMaxDiscountLevelNumber(f),i===3)?-1:i===2?r<=2?-1:3:i===1?r<=1?-1:2:1}catch(e){return discountninja.Logging.LogError("DiscountLevel.GetGoalDiscountLevel",e,!0),null}},GetGoalDiscountLevel:function(t){var i,r;try{return(i=n.GetGoalDiscountLevelNumber(t),i===null||i===-1)?null:(r=t.PriceRuleInfo,i===3)?r.DiscountLevel3:i===2?r.DiscountLevel2:i===1?r.DiscountLevel1:null}catch(u){return discountninja.Logging.LogError("DiscountLevel.GetGoalDiscountLevel",u,!0),null}},GetPercentageAmountFromDiscountLevel:function(n){try{return n?{Percentage:n.Percentage,Amount:n.Amount}:null}catch(t){discountninja.Logging.LogError("DiscountedProduct.GetPercentageAmountFromDiscountLevel",t,!0)}},GoalAchieved:function(t){try{var r=discountninja.LiquidData.CartValue(),i=n.GetCurrentDiscountLevelNumber(t,r);return i===null?!1:i>0}catch(u){return discountninja.Logging.LogError("DiscountLevel.GoalAchieved",u,!0),!1}}};discountninja.DiscountLevel=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja.DynamicPricing=discountninja.DynamicPricing||{},function(){var n={ReplacingPricesInCart:!1,UpdatePrice:function(){function i(t){var i,r;try{return i=!1,n.IsDynamicPricingRequired(t,!1)?(discountninja.Logging.LogInformation("FLOW: Updating price"),jQuery(".rc_price__onetime").addClass("limoniapps-discountninja-productprice"),r=jQuery(".limoniapps-discount-url-productprice,.limoniapps-discountninja-productprice"),r.length>0&&(discountninja.Logging.LogVerbose("Replacing prices using Liquid approach"),r.each(function(n,t){var r=u(n,t);r&&(i=!0)}))):discountninja.Logging.LogInformation("FLOW: Not updating price",!0,!1),n.ReplacePricesInCart(),n.Show(i),!0}catch(f){discountninja.Logging.LogError("DynamicPricing.UpdatePriceInternal",f,!0)}}function t(n,t){try{var i=jQuery(n).attr("data-limoniapps-discountninja-"+t);return i||(i=jQuery(n).attr("data-limoniapps-discounturl-"+t)),i}catch(r){discountninja.Logging.LogError("DynamicPricing.GetDataFromCollectionAttribute",r,!0)}}function u(n,i){var c,s,l,o,k,v,d;try{var r=0,u=0,b=jQuery(i).closest(".limoniapps-discountninja-cart-root");if(b!==null&&b.length>0)return;var h=discountninja.Environment.Shopify.ProductHandle(),y=jQuery(i).closest("[data-limoniapps-discountninja-product-handle],[data-limoniapps-discounturl-product-handle]"),p=!1,e=null,w=null;if(y===null||y.length!==1)if(discountninja.Environment.Shopify.IsProductPage())if(p=!0,discountninja.Logging.LogVerbose("No product handle found, assuming the product is the product on the current product page"),c=discountninja.Environment.Shopify.VariantId(),c)r=discountninja.LiquidData.Price(c),u=discountninja.LiquidData.CompareAtPrice(c),e=discountninja.LiquidData.Inventory(c),discountninja.Logging.LogVerbose("Loading pricing for variant "+c+": price "+r+", compare at:"+u);else{discountninja.Logging.LogVerbose("No product variant found on product page");return}else{discountninja.Logging.LogVerbose("No product handle found on non-product page");return}else discountninja.Logging.LogVerbose("Product handle found, assuming the product is not on the product page, reading price from data tags"),s=y[0],h=t(s,"product-handle"),l=discountninja.ProductData.GetByProductHandle(h,!0),l!=null?(r=l.Price,u=l.CompareAtPrice,e=l.Inventory,w=l.Collections):(r=t(s,"product-price"),u=t(s,s,"product-compareatprice"),e=t(s,"product-inventory"),w=t(s,"product-collections")),(e===undefined||isNaN(e))&&(e=null),(r===null||r===undefined||isNaN(r)||r===0)&&(r=0),(u===null||u===undefined||isNaN(u)||u===0)&&(u=r),u<r&&(u=r),r=r/100,u=u/100,discountninja.Logging.LogVerbose("Derived price "+r+" and compare at price "+u+" and inventory level "+e+" from data tags");if(o=discountninja.Promotion.GetPromotionForProduct(h,w,e,r),!o)return discountninja.Logging.LogVerbose("The price will not be updated for the product with handle '"+h+"' since the product is not a target of the promotion(s)."),!1;var it=o.PriceRuleInfo,g=discountninja.DiscountLevel.GetCurrentDiscountLevel(o),a=discountninja.DiscountedProduct.Get(null,h,r,u,e,o,g),nt=p===!0?"current ":"";return discountninja.Logging.LogVerbose("Updating price for "+nt+"product ("+h+"), price is "+r+" and compare at is "+u+", discounting to "+a.DiscountedPrice),k=jQuery(i).find(".limoniapps-discountninja-shortcode").length===0,k?(discountninja.Logging.LogVerbose("Replacing prices first time"),f(o,i,p,a)):(discountninja.Logging.LogVerbose("Replacing prices after first time"),discountninja.ShortCode.RefreshResolvedPlaceholders(i,o,a)),v=jQuery(".afterpay-instalments"),v&&v.length>0&&(d=discountninja.ShortCode.ReplaceAllPlaceHolders(o,"{{DISCOUNTED_PRICE_AFTERPAY_INSTALLMENT}}",a),jQuery(v).html(d)),!0}catch(tt){return discountninja.Logging.LogError("DynamicPricing.UpdatePriceForProductWrapper",tt,!0),!1}}function f(n,t,i,r){try{discountninja.Logging.LogVerbose("Replacing prices for product first time");var e=jQuery(t).html(),u=jQuery(t).find(".limoniapps-discountninja-productprice-inner"),f=u===null||u.length===0,o=f?e:jQuery(u).prop("outerHTML");f?discountninja.Logging.LogVerbose("No limoniapps-discountninja-productprice-inner tag detected, using limoniapps-discountninja-productprice"):discountninja.Logging.LogVerbose("Using limoniapps-discountninja-productprice-inner tag");var s='<span class="limoniapps-discountninja-productprice-original" style="display:none;">'+o+"<\/span>",l=discountninja.Settings.GetPriceFormat("standard").Format,a=discountninja.ShortCode.ReplaceAllPlaceHolders(n,l,r),v=discountninja.Settings.GetPriceFormat("standard").Animation,y=i===!0?"limoniapps-discountninja-currentproduct ":"",p='<span style="display:inline-block;animation-iteration-count: '+discountninja.Settings.GetPriceFormat("standard").AnimationIterations+' !important;" class="limoniapps-discountninja-discountedprice '+y+v+'">'+a+"<\/span>",h='<span class="limoniapps-discountninja-productprice-replaced" style="display:none;">'+p+"<\/span>",c="";c=f?h+s:e.replace(o,h+s);jQuery(t).html(c)}catch(w){discountninja.Logging.LogError("DynamicPricing.UpdatePriceForProduct",w,!0)}}try{var r=discountninja.Settings.Settings;return i(r)}catch(e){discountninja.Logging.LogError("DynamicPricing.UpdatePriceInternal",e,!0)}},UnblockPrices:function(){discountninja.Logging.LogVerbose("Unblocking prices");jQuery(".limoniapps-discountninja-dots-wrapper").removeClass("limoniapps-discountninja-dots-wrapper");jQuery(".limoniapps-discountninja-block-prices").removeClass("limoniapps-discountninja-block-prices")},UnblockButtons:function(){discountninja.Logging.LogVerbose("Unblocking buttons");jQuery(".limoniapps-discountninja-spinner").removeClass("limoniapps-discountninja-spinner");jQuery(".limoniapps-discountninja-block").removeClass("limoniapps-discountninja-block");jQuery(".limoniapps-discountninja-block-buttons").removeClass("limoniapps-discountninja-block-buttons")},UnblockPricesAndButtons:function(){n.UnblockButtons();n.UnblockPrices()},Show:function(t){function u(n){try{return function(t,i){n?jQuery(i).show():jQuery(i).hide()}}catch(t){discountninja.Logging.LogError("DynamicPricing.SetDynamicPricingVisibility",t,!0)}}var r,i;try{r=t===undefined?n.HasActiveDiscountCode():t;discountninja.Logging.LogVerbose("Setting visibility of Dynamic Pricing to "+r);discountninja.MultiCurrency.UpdateCurrency();n.UnblockPrices();i=jQuery(".limoniapps-discountninja-productprice-original");i.each(u(!r));i=jQuery(".limoniapps-discountninja-productprice-replaced");i.each(u(r));i=discountninja.Environment.Shopify.IsProductPage()?jQuery(".limoniapps-discountninja-productprice-showafterreplace"):jQuery(".limoniapps-discountninja-productprice-replaced").closest(".limoniapps-discountninja-productprice-wrapper").find(".limoniapps-discountninja-productprice-showafterreplace");i.each(u(r));i=discountninja.Environment.Shopify.IsProductPage()?jQuery(".limoniapps-discountninja-productprice-replaced").closest(".limoniapps-discountninja-productprice-wrapper").find(".limoniapps-discountninja-productprice-hideafterreplace"):jQuery(".limoniapps-discountninja-productprice-hideafterreplace");i.each(u(!r))}catch(f){return discountninja.Logging.LogError("DynamicPricing.Show",f,!0),!1}},FindElementInCart:function(n,t,i){try{if(!n)return null;var r=jQuery(n).find(t);return r&&r.length!==0?r:(i&&discountninja.Logging.LogVerbose("Could not find "+t+" in cart element"),null)}catch(u){discountninja.Logging.LogError("DynamicPricing.FindElementInCart",u,!0)}},ReplacePricesInDrawerCart:function(t){try{if(t=t?t:discountninja.Settings.Settings,!t)return;var i=n.IsDynamicPricingRequired(t,!0);i&&(discountninja.Logging.LogVerbose("Replace prices in drawer cart"),n.ReplacePricesInCartInner(!0))}catch(r){discountninja.Logging.LogError("DynamicPricing.ReplacePricesInDrawerCart",r,!0)}},ReplacePricesInClassicCart:function(t){try{if(t=t?t:discountninja.Settings.Settings,!t)return;var i=discountninja.Environment.Shopify.IsCartPage()&&n.IsDynamicPricingRequired(t,!1);i&&(discountninja.Logging.LogVerbose("Replace prices in classic cart"),n.ReplacePricesInCartInner(!1))}catch(r){discountninja.Logging.LogError("DynamicPricing.ReplacePricesInClassicCart",r,!0)}},ReplacePricesInCartInner:function(t){function o(t){try{var i=n.FindElementInCart(t,".limoniapps-discountninja-cart-item-variant",!0);return i?i.html():null}catch(r){return discountninja.Logging.LogError("DynamicPricing.GetVariantHtmlFromCartItem",r,!0),null}}function s(n,t){var f;try{var i=t/100,r=n/100,u=Math.round((r-i)*100)/100;return u<0&&(u=0),f=i/r*100,{OriginalPrice:r,Amount:i,Percentage:f,DiscountedPrice:u}}catch(e){discountninja.Logging.LogError("DynamicPricing.BuildProductInfoFromAmount",e,!0)}}function h(n,t,i){var r;try{if(r=0,jQuery(n).find(".limoniapps-discountninja-cart-item").each(function(n,u){r=r+c(u,t,i)}),r>0){var f=s(discountninja.LiquidData.SubTotalPriceFromCart()*100,r),e=discountninja.Environment.Shopify.IsCartPage()?discountninja.Settings.Settings.PriceUpdateSettings.EnableOnCartPage:discountninja.Settings.Settings.PriceUpdateSettings.EnableOnDrawerCart,o=discountninja.Environment.Shopify.IsCartPage()?discountninja.Settings.Settings.CartSettings.SubtotalSavingsLabel:discountninja.Settings.Settings.DrawerCartSettings.SubtotalSavingsLabel;u(null,n,r>0,e,"subtotal",o,f,discountninja.Settings.GetPriceFormat("subtotal").Format)}else discountninja.Logging.LogVerbose("No discounted products in cart, not updating subtotal")}catch(h){discountninja.Logging.LogError("DynamicPricing.ReplacePricesInCartForRoot",h,!0)}}function c(n,t,i){var s,h,c,f,p,r;try{if(s=o(n),s!==null)for(h="Replacing prices in cart - Variant "+s,discountninja.Logging.LogVerbose(h),c=0;c<t.length;c++)if(f=t[c],s==f){var v=discountninja.Utilities.StringIsIn(f,i),l=discountninja.LiquidData.QuantityFromCart(f),e=discountninja.LiquidData.PriceFromCart(f)*100;discountninja.Logging.LogVerbose(h+" - Price "+e+" and quantity "+l);var d=e/100,y=discountninja.LiquidData.CompareAtPrice(f),a=discountninja.ProductData.GetByVariant(f,!0);if(a){if(p=discountninja.LiquidData.ProductHandleFromCart(f),r=discountninja.Promotion.GetPromotionForProduct(p,a.Collections,a.Inventory,d),r&&r.PriceRuleInfo.TargetType==="line_item"){var rt=r.PriceRuleInfo,w=discountninja.DiscountLevel.GetCurrentDiscountLevel(r),b=discountninja.DiscountedProduct.Get(f,null,e/100,y,discountninja.LiquidData.Inventory(f),r,w),g=discountninja.DiscountedProduct.Get(f,null,e/100*l,y,discountninja.LiquidData.Inventory(f),r,w),k=discountninja.Environment.Shopify.IsCartPage()?discountninja.Settings.Settings.PriceUpdateSettings.EnableOnCartPage:discountninja.Settings.Settings.PriceUpdateSettings.EnableOnDrawerCart,nt=discountninja.Environment.Shopify.IsCartPage()?r.CartSettings.ProductSavingsLabel:r.DrawerCartSettings.ProductSavingsLabel,tt=discountninja.Environment.Shopify.IsCartPage()?r.LineItemSavingsLabel:r.DrawerCartSettings.LineItemSavingsLabel;return u(r,n,v,k,"item-product",nt,b,discountninja.Settings.GetPriceFormat("item-product").Format),u(r,n,v,k,"item-line",tt,g,discountninja.Settings.GetPriceFormat("item-line").Format),(e-b.DiscountedPriceRaw*100)*l}return 0}}return discountninja.Logging.LogVerbose(h+" - No match found in discounted cart"),0}catch(it){discountninja.Logging.LogError("DynamicPricing.ReplacePricesForCartItem",it,!0)}}function l(t,i){var u,s,f,e;try{var h="GetOriginalPriceHtmlFromCartItem - Level "+i+" - ",o="limoniapps-discountninja-productprice-original",c=".limoniapps-discountninja-cart-"+i+"-price",r=n.FindElementInCart(t,c,!0);return r?(u=n.FindElementInCart(r,"."+o,!1),s='<span class="'+o+'" style="display:none;">'+r.html()+"<\/span>",u===null?s:(f=u[0],e=f?jQuery(f).prop("outerHTML"):"",e?e:"")):(discountninja.Logging.LogVerbose(h+"No match found for price element"),"")}catch(l){return discountninja.Logging.LogError("DynamicPricing.GetOriginalPriceHtmlFromCartItem",l,!0),null}}function u(t,i,r,u,f,e,o,s){function y(t,i,r,u){var f,e;try{f=n.FindElementInCart(t,".limoniapps-discountninja-cart-"+i+"-price",!0);f&&(e='<span class="limoniapps-discountninja-productprice-replaced" style="display:none;">'+u+"<\/span>",jQuery(f).html(e+r))}catch(o){return discountninja.Logging.LogError("ReplacePriceInCart",o,!0),null}}var h,c,v;try{h="Replacing prices in cart - Level "+f+" - ";r?(discountninja.Logging.LogVerbose(h+"Discounted"),u?(c=discountninja.ShortCode.ReplaceAllPlaceHolders(t,s||"{{DISCOUNTED_PRICE}} {{STRIKETHROUGH_ORIGINAL_PRICE}}",o,f),v=l(i,f),y(i,f,v,c)):discountninja.Logging.LogVerbose(h+"Dynamic Pricing on cart not enabled"),a(t,i,e,f,o)):discountninja.Logging.LogVerbose(h+"Not discounted")}catch(p){discountninja.Logging.LogError("DynamicPricing.ReplacePricesForCartItemLevel",p,!0)}}function a(t,i,r,u,f){var o,e,s;try{o=".limoniapps-discountninja-cart-"+u+"-comment";e=n.FindElementInCart(i,o,!0);r&e?(discountninja.Logging.LogVerbose("Adding comment for level: "+u),s='<span class="limoniapps-discountninja-productprice-replaced" style="display:none;">'+discountninja.ShortCode.ReplaceAllPlaceHolders(t,r,f)+"<\/span>",jQuery(e).html(s),e.show()):r||discountninja.Logging.LogVerbose("No comment for level: "+u)}catch(h){return discountninja.Logging.LogError("DynamicPricing.AddCartComment",h,!0),null}}function f(){n.ReplacingPricesInCart=!1}function v(){jQuery(".limoniapps-discountninja-drawercart-root .limoniapps-discountninja-cart-subtotal-comment").hide();jQuery(".limoniapps-discountninja-drawercart-root .limoniapps-discountninja-cart-subtotal-price .limoniapps-discountninja-shortcode-discounted_price").text("0");jQuery(".limoniapps-discountninja-drawercart-root .limoniapps-discountninja-cart-subtotal-price .limoniapps-discountninja-shortcode-original_price").hide()}var i,r,e;try{if(!n.HasActiveDiscountCode()){n.ReplacingPricesInCart=!1;return}if(n.ReplacingPricesInCart===!0)return;if(n.ReplacingPricesInCart=!0,discountninja.Logging.LogVerbose("Replace prices in cart"),window.limoniapps_discountninja_liquid.Cart.items.length===0){f();v();return}if(i=discountninja.DiscountedCart.GetCartVariantIds(),i===undefined||i===null||i===""){discountninja.Logging.LogVerbose("No discounted variants in cart");f();return}if(r=t?jQuery(".limoniapps-discountninja-drawercart-root"):jQuery(".limoniapps-discountninja-cart-root"),r===undefined||r.length===0){discountninja.Logging.LogVerbose(t?"Could not find limoniapps-discountninja-drawercart-root":"Could not find limoniapps-discountninja-cart-root");f();return}e=discountninja.LiquidData.VariantIdsFromCart();jQuery(r).each(function(){h(this,e,i)});n.Show(!0);n.ReplacingPricesInCart=!1}catch(y){n.ReplacingPricesInCart=!1;discountninja.Logging.LogError("ReplacePricesInCartInner",y,!0)}},ReplacePricesInCart:function(){var t=discountninja.Settings.Settings;discountninja.Cart.Shopify.UpdateCart(function(){n.ReplacePricesInDrawerCart(t);n.ReplacePricesInClassicCart(t);var i=discountninja.DiscountCode.GetActiveDiscountCodesForCheckoutAsString();i!==""&&discountninja.PromotionFlow.HideAdditionalCheckoutButtons();discountninja.DiscountCode.InjectDiscountCodesInHtml();discountninja.DynamicPricing.UnblockPricesAndButtons()})},IsDynamicPricingRequired:function(n,t){var i="";if(t)if(n.PriceUpdateSettings.EnableOnDrawerCart===!1)i="Dynamic Pricing is not required since the promotion configuration specifies not to dynamically replace prices on the drawer cart.";else return!0;return i===""&&discountninja.Environment.Shopify.IsHomePage()&&n.PriceUpdateSettings.EnableOnHomePage===!1&&(i="Dynamic Pricing is not required since the promotion configuration specifies not to dynamically replace prices on the home page."),i===""&&discountninja.Environment.Shopify.IsCollectionPage()&&n.PriceUpdateSettings.EnableOnCollectionPages===!1&&(i="Dynamic Pricing is not required since the promotion configuration specifies not to dynamically replace prices on collection pages."),i===""&&discountninja.Environment.Shopify.IsProductPage()&&n.PriceUpdateSettings.EnableOnProductPages===!1&&(i="Dynamic Pricing is not required since the promotion configuration specifies not to dynamically replace prices on product pages."),i===""&&discountninja.Environment.Shopify.IsBlogPost()&&n.PriceUpdateSettings.EnableOnBlogPages===!1&&(i="Dynamic Pricing is not required since the promotion configuration specifies not to dynamically replace prices on blog pages."),i===""&&discountninja.Environment.Shopify.IsCustomPage()&&n.PriceUpdateSettings.EnableOnCustomPages===!1&&(i="Dynamic Pricing is not required since the promotion configuration specifies not to dynamically replace prices on custom pages."),i===""&&discountninja.Environment.Shopify.IsCartPage()&&n.PriceUpdateSettings.EnableOnCartPage===!1&&(i="Dynamic Pricing is not required since the promotion configuration specifies not to dynamically replace prices on the cart page."),discountninja.PromotionFlow.HandleFlowErrorMessage(i)},HasActiveDiscountCode:function(){var n=discountninja.DiscountCode.GetActiveLineItemDiscountCodes();return n!==undefined&&n!==null&&n!==""}};discountninja.DynamicPricing=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja.LiquidData=discountninja.LiquidData||{},function(){var n={WaitForLiquidAsset:function(n){var t,i,r;try{t=typeof limoniapps_discountninja_liquid!="undefined";t?n&&n():(discountninja.Logging.LogVerbose("Waiting for liquid asset to be returned"),i=0,r=function(){if(i++,t=typeof limoniapps_discountninja_liquid!="undefined",t||i===50){if(i===50)return discountninja.Logging.LogTestMode("A Discount Ninja liquid asset (limoniapps-discountninja-header/limoniapps-discountninja-app-liquid) is missing in your theme. Contact support@limoniapps.com to have the issue resolved.",!0,!0,!0,!0),discountninja.Logging.LogError("Waiting for liquid asset (limoniapps-discountninja-header/limoniapps-discountninja-app-liquid) to be returned timed out. Either the asset does not exist or it is not included in the theme.liquid file. Exiting.",!1);discountninja.Logging.LogVerbose("LiquidData.WaitForLiquidAsset","Waiting for liquid asset to be available - DONE");n&&n()}else return setTimeout(r,100)},r())}catch(u){return discountninja.Logging.LogError("LiquidData.WaitForLiquidAsset",u,!0),""}},Cart:function(){try{return typeof limoniapps_discountninja_liquid!="undefined"&&typeof window.limoniapps_discountninja_liquid.Cart!="undefined"&&typeof window.limoniapps_discountninja_liquid.Cart.total_price!="undefined"?window.limoniapps_discountninja_liquid.Cart:null}catch(n){discountninja.Logging.LogError("LiquidData.CartValue",n,!0)}},CartValue:function(){try{var t=n.Cart();return t===null?null:t.total_price}catch(i){discountninja.Logging.LogError("LiquidData.CartValue",i,!0)}},VariantIdsFromCart:function(){var t,i,r;try{if(t="",i=n.Cart(),i&&typeof i.items=="object")for(r=0;r<i.items.length;r++)t!==""&&(t=t+","),t=t+i.items[r].variant_id;return t.split(",")}catch(u){return discountninja.Logging.LogError("LiquidData.VariantIdsFromCart",u,!0),null}},ProductCollections:function(){try{return window.limoniapps_discountninja_liquid.Product?window.limoniapps_discountninja_liquid.Product.Collections:null}catch(n){return discountninja.Logging.LogError("LiquidData.ProductCollections",n,!0),null}},ProductDefaultVariantId:function(){try{return window.limoniapps_discountninja_liquid.Product?window.limoniapps_discountninja_liquid.Product.VariantId:null}catch(n){return discountninja.Logging.LogError("LiquidData.ProductDefaultVariantId",n,!0),null}},VariantInfoFromLiquid:function(n){try{if(window.limoniapps_discountninja_liquid.ProductVariants)for(var t=0;t<window.limoniapps_discountninja_liquid.ProductVariants.length;t++)if(window.limoniapps_discountninja_liquid.ProductVariants[t].VariantId===parseInt(n))return window.limoniapps_discountninja_liquid.ProductVariants[t];return null}catch(i){return discountninja.Logging.LogError("LiquidData.VariantInfoFromLiquid",i,!0),null}},CompareAtPrice:function(t){try{var i=n.VariantInfoFromLiquid(t);return i===null?0:i.CompareAtPrice/100}catch(r){return discountninja.Logging.LogError("LiquidData.CompareAtPrice",r,!0),null}},Price:function(t){try{var i=n.VariantInfoFromLiquid(t);return i===null?0:i.Price/100}catch(r){return discountninja.Logging.LogError("LiquidData.Price",r,!0),0}},Inventory:function(t){try{var i=n.VariantInfoFromLiquid(t);return i===null?null:i.Inventory==="null"?null:i.Inventory}catch(r){return discountninja.Logging.LogError("LiquidData.Inventory",r,!0),0}},CartItemByVariant:function(n){try{for(var t=0;t<window.limoniapps_discountninja_liquid.Cart.items.length;t++)if(window.limoniapps_discountninja_liquid.Cart.items[t].variant_id==n)return window.limoniapps_discountninja_liquid.Cart.items[t];return null}catch(i){return discountninja.Logging.LogError("LiquidData.CartItemByVariant",i,!0),null}},CartItemByProductHandle:function(n){try{for(var t=0;t<window.limoniapps_discountninja_liquid.Cart.items.length;t++)if(window.limoniapps_discountninja_liquid.Cart.items[t].handle==n)return window.limoniapps_discountninja_liquid.Cart.items[t];return null}catch(i){return discountninja.Logging.LogError("LiquidData.CartItemByProductHandle",i,!0),null}},PriceFromCartByProductHandle:function(t){try{var i=n.CartItemByProductHandle(t);return i===null?null:i.price/100}catch(r){return discountninja.Logging.LogError("LiquidData.PriceFromCartByProductHandle",r,!0),null}},PriceFromCart:function(t){try{var i=n.CartItemByVariant(t);return i===null?null:i.price/100}catch(r){return discountninja.Logging.LogError("LiquidData.PriceFromCart",r,!0),null}},ProductHandleFromCart:function(t){try{var i=n.CartItemByVariant(t);return i===null?null:i.handle}catch(r){return discountninja.Logging.LogError("LiquidData.ProductHandleFromCart",r,!0),null}},QuantityFromCart:function(t){try{var i=n.CartItemByVariant(t);return i===null?null:i.quantity}catch(r){return discountninja.Logging.LogError("LiquidData.QuantityFromCart",r,!0),null}},SubTotalPriceFromCart:function(){try{return typeof limoniapps_discountninja_liquid!="undefined"&&typeof window.limoniapps_discountninja_liquid.Cart=="object"?window.limoniapps_discountninja_liquid.Cart.total_price/100:null}catch(n){return discountninja.Logging.LogError("LiquidData.SubTotalPriceFromCart",n,!0),null}}};discountninja.LiquidData=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja.MultiCurrency=discountninja.MultiCurrency||{},function(){var n={UpdateCurrency:function(){function n(){try{typeof convertCurrencies=="function"&&(discountninja.Logging.LogVerbose("Updating currency - Standard"),window.convertCurrencies())}catch(n){discountninja.Logging.LogError("UpdateCurrencyStandard",n,!0)}}function t(){try{var n=discountninja.Settings.Settings.CurrencySettings.BaseCurrency;typeof window.DoublyGlobalCurrency.currentCurrency!="undefined"&&window.DoublyGlobalCurrency.currentCurrency!==null&&window.DoublyGlobalCurrency.currentCurrency!==""&&(n=window.DoublyGlobalCurrency.currentCurrency);typeof window.DoublyGlobalCurrency.convertAll=="function"&&(n!==discountninja.Settings.Settings.CurrencySettings.BaseCurrency&&(discountninja.Logging.LogVerbose("Updating currency - Doubly - Back to base currency: "+discountninja.Settings.Settings.CurrencySettings.BaseCurrency),window.DoublyGlobalCurrency.convertAll(discountninja.Settings.Settings.CurrencySettings.BaseCurrency,".money")),discountninja.Logging.LogVerbose("Updating currency - Doubly - To current currency: "+n),window.DoublyGlobalCurrency.convertAll(n,".money"))}catch(t){discountninja.Logging.LogError("UpdateCurrencyDoubly",t,!0)}}function i(){try{var n=discountninja.Settings.Settings.CurrencySettings.BaseCurrency,t=discountninja.Settings.Settings.CurrencySettings.BaseCurrency;typeof window.Currency.shopCurrency!="undefined"&&window.Currency.shopCurrency!==null&&window.Currency.shopCurrency!==""&&(n=window.Currency.shopCurrency);typeof window.Currency.currentCurrency!="undefined"&&window.Currency.currentCurrency!==null&&window.Currency.currentCurrency!==""&&(t=window.Currency.currentCurrency);typeof window.Currency.convertAll=="function"&&(discountninja.Logging.LogVerbose("Updating currency - SECOMAPP - From base currency: "+n+" - To current currency: "+t),window.Currency.convertAll(n,t))}catch(i){discountninja.Logging.LogError("UpdateCurrencySecomapp",i,!0)}}try{typeof DoublyGlobalCurrency=="object"?t():typeof SECOMAPP=="object"&&typeof Currency=="object"?i():typeof convertCurrencies=="function"&&typeof Currency=="object"&&n()}catch(r){discountninja.Logging.LogError("UpdateCurrency",r,!0)}}};discountninja.MultiCurrency=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja.Notification=discountninja.Notification||{},function(){var n={AnimateOnReminderIntervalHandle:-1,DelayIntervalHandle:-1,GetClass:function(){return"limoniapps-notify-default"},GetStyle:function(n){try{return n?n.NotificationSettings.Style:""}catch(t){return discountninja.Logging.LogError("Notification.GetStyle",t,!0),""}},GetText:function(n,t,i){try{return discountninja.ShortCode.ReplaceAllPlaceHolders(t,discountninja.TextSettings.GetText(n,t),i)}catch(r){return discountninja.Logging.LogError("Notification.GetHeader",r,!0),""}},GetHtml:function(t,i){try{if(!i)return"";var u=discountninja.Settings.Settings.NotificationSettings,f=discountninja.Timer.IsTimerStarted()?n.GetText(u.TimerFooter,null,null):"",r=u.Html;return r=r.replace("{{HEADER}}",n.GetText(u.Header,null,null)),r=r.replace("{{BODY}}",t),r=r.replace("{{FOOTER}}",n.GetText(u.Footer,null,null)),r=r.replace("{{TIMER_FOOTER}}",f),r.replace("{{TOKEN}}",i.Token)}catch(e){return discountninja.Logging.LogError("Notification.GetHtml",e,!0),""}},Hide:function(){try{var t=jQuery(".limoniapps-notify-default");t&&(n.ApplyAnimation(t,discountninja.Settings.Settings.NotificationSettings.AnimationExit),setTimeout(function(){t.hide()},800))}catch(i){discountninja.Logging.LogError("Notification.Hide",i,!0)}},ToggleMinMaximze:function(){try{var t=jQuery(".limoniapps-notify-default").width(),i=t===0||t===200;i?n.Maximize():n.Minimize()}catch(r){discountninja.Logging.LogError("Notification.Minimize",r,!0)}},Minimize:function(){var n,t,i;try{n=jQuery(".limoniapps-notify-default");n&&(jQuery(n).attr("data-original-width",jQuery(n).css("width")),jQuery(n).attr("data-original-bottom",jQuery(n).css("bottom")),jQuery(n).attr("data-original-top",jQuery(n).css("top")),jQuery(n).css("white-space","nowrap"),discountninja.Utilities.IsMobilePhone()?jQuery(n).css("width","0px"):jQuery(n).css("width","200px"),t=jQuery(n).outerHeight(),i=discountninja.Utilities.IsMobilePhone()?(t-20)*-1+"px":(t-40)*-1+"px",discountninja.Settings.Settings.NotificationSettings.PlacementVertical==="top"?jQuery(n).css("top",i.toString()):jQuery(n).css("bottom",i.toString()),jQuery(n).find(".limoniapps-minimize-min").hide(),jQuery(n).find(".limoniapps-minimize-max").show())}catch(r){discountninja.Logging.LogError("Notification.Minimize",r,!0)}},Maximize:function(){try{var t=jQuery(".limoniapps-notify-default");t&&(setTimeout(function(){jQuery(t).css("white-space","unset")},200),jQuery(t).css("width",jQuery(t).attr("data-original-width")),discountninja.Settings.Settings.NotificationSettings.PlacementVertical==="top"?jQuery(t).css("top",jQuery(t).attr("data-original-top")):jQuery(t).css("bottom",jQuery(t).attr("data-original-bottom")),jQuery(t).find(".limoniapps-minimize-min").show(),jQuery(t).find(".limoniapps-minimize-max").hide(),n.ActAfterDelay())}catch(i){discountninja.Logging.LogError("Notification.Minimize",i,!0)}},Clear:function(){discountninja.Cache.SessionRemove("notificationinfo-data")},Remove:function(t){var r,u,i;try{for(r=n.GetFromCache(),u=[],i=0;i<r.length;i++)r[i].Token!==t&&u.push(r[i]);u.length===0&&n.Hide();n.SaveToCache(u)}catch(f){discountninja.Logging.LogError("Notification.Remove",f,!0)}},GetFromCache:function(){try{var n=discountninja.Cache.SessionGet("notificationinfo-data");return n=n==="undefined"?[]:JSON.parse(n),n===null?[]:n}catch(t){return discountninja.Logging.LogError("Notification.GetFromCache",t,!0),[]}},SaveToCache:function(n){try{discountninja.Cache.SessionSet("notificationinfo-data",JSON.stringify(n))}catch(t){discountninja.Logging.LogError("Notification.SaveToCache",t,!0)}},Add:function(t,i){var r,u;try{for(t||discountninja.Logging.LogError("Notification.Add","Expected token",!1),r=n.GetFromCache(),u=0;u<r.length;u++)if(r[u]&&r[u].Token===t)return;r.push({Token:t,ProductInfo:i,Animated:!1});n.SaveToCache(r)}catch(f){discountninja.Logging.LogError("Notification.Add",f,!0)}},ApplyAnimation:function(n,t,i){try{var r=discountninja.Settings.Settings.NotificationSettings;n.removeClass(r.AnimationEnter);n.removeClass(r.AnimationOnReminder);n.removeClass(r.AnimationExit);n.removeClass("animated shake flash bounce rotateIn");n.addClass(t);i&&n.css("animation-iteration-count",i)}catch(u){discountninja.Logging.LogError("Notification.ApplyAnimation",u,!0)}},ActAfterDelay:function(){try{var t=discountninja.Settings.Settings.NotificationSettings;t.Delay&&t.Delay>0&&(clearInterval(n.DelayIntervalHandle),n.DelayIntervalHandle=setTimeout(function(){t.HideMode==="hide"?n.Hide():t.HideMode==="minimize"&&n.Minimize()},t.Delay))}catch(i){discountninja.Logging.LogError("Notification.ActAfterDelay",i,!0)}},Show:function(){var t,f,l;try{function o(t,i){function r(){var i=jQuery(".limoniapps-notify-default");n.ApplyAnimation(i,t)}n.AnimateOnReminderIntervalHandle=setTimeout(function(){r();o(t,i)},i)}function a(t,i,r,u){var f,e;try{f=discountninja.Settings.Settings.NotificationSettings;jQuery.notify({icon:"",title:"",message:""},{allow_dismiss:f.CloseButton,type:"limoniapps-discountninja",placement:{from:f.PlacementVertical,align:f.PlacementHorizontal},delay:0,template:t,animate:{enter:f.AnimationEnter,exit:""},onClose:function(){n.Hide()},onClosed:function(){n.SetDismissedInSession(!0)}});f.MinimizeButton&&(e=jQuery(".limoniapps-notify-default"),jQuery(e).click(function(){n.ToggleMinMaximze()}));n.ActAfterDelay();discountninja.Settings.Settings.GeneralSettings.ShowPoweredBy?jQuery(".limoniapps-poweredby").removeClass("limoniapps-poweredby-hidden"):jQuery(".limoniapps-poweredby").addClass("limoniapps-poweredby-hidden");f.OfferCounterAnimate&&setTimeout(function(){setTimeout(function(){for(var i,t=0;t<u.length;t++)i=jQuery('.limoniapps-notify-default span[data-promotion-token="'+u[t]+'"]'),n.ApplyAnimation(i,"animated shake",1)},500);setTimeout(function(){for(var i,t=0;t<u.length;t++)i=jQuery('.limoniapps-notify-default span[data-promotion-token="'+u[t]+'"]'),n.ApplyAnimation(i,"animated flash",3)},1500);u.length>0&&(n.Maximize(),setTimeout(function(){n.ApplyAnimation(jQuery(".limoniapps-notify-default .limoniapps-offercount"),"animated bounce",2)},500))},1500);n.SetShownInSession(!0);n.SetShownOnDevice(!0);f.AnimationOnReminder&&(clearInterval(n.AnimateOnReminderIntervalHandle),o(f.AnimationOnReminder,f.ReminderDuration))}catch(s){return discountninja.Logging.LogError("Notification.ShowInternalAfterEnsuringDependencies",s,!0),!1}}function v(){var t,i;try{for(t=n.GetFromCache(),i=0;i<t.length;i++)t[i].Animated=!0;n.SaveToCache(t)}catch(r){discountninja.Logging.LogError("Notification.MarkNotificationsAsAnimated",r,!0)}}function y(t,i){try{if(t===null||t==="<ul><\/ul>")return;discountninja.Logging.LogVerbose("Showing notification");var u=jQuery("."+n.GetClass()).length>0;if(u){discountninja.Logging.LogVerbose("Notification already exists, updating message");jQuery("."+n.GetClass()).closest(".limoniapps-box").each(function(){discountninja.ShortCode.RefreshResolvedPlaceholders(this,null,null)});return}if(n.GetDismissedInSession()){discountninja.Logging.LogVerbose("Notification was dismissed during the session, canceling show");return}return LimoniAppsLoadJQueryNotify(function(){a(t,r,e,i)}),!0}catch(f){return discountninja.Logging.LogError("Notification.ShowInternal",f,!0),!1}}if(t=n.GetFromCache(),!t||t.length===0)return;var u=null,i=t.length>1?"<ul>":"",s=[];for(f=0;f<t.length;f++){u=t[f];var r=discountninja.Promotion.GetPromotionByToken(u.Token),p=discountninja.DiscountLevel.GetCurrentDiscountLevel(r),e=discountninja.DiscountLevel.GetPercentageAmountFromDiscountLevel(p),h='data-promotion-token="'+u.Token+'"',c=n.GetText(r.NotificationSettings.Body,r,e);i=t.length>1?i+"<li "+h+">"+c+"<\/li>":i+'<span style="display:block;" '+h+">"+c+"<\/span>";u.Animated===!1&&s.push(u.Token)}t.length>1&&(i=i+"<\/ul>");v();l=discountninja.ShortCode.ReplaceAllPlaceHolders(r,n.GetHtml(i,r,e));y(l,s)}catch(w){discountninja.Logging.LogError("Notification.Show",w,!0)}},GetShownInSession:function(){return discountninja.Cache.SessionGet("notification-displayed-insession")},SetShownInSession:function(n){discountninja.Cache.SessionSet("notification-displayed-insession",n)},GetShownOnDevice:function(){return discountninja.Cache.LocalGet("notification-displayed-ondevice")},SetShownOnDevice:function(n){discountninja.Cache.LocalSet("notification-displayed-ondevice",n)},GetDismissedInSession:function(){return discountninja.Cache.SessionGet("notification-dismissed-insession")},SetDismissedInSession:function(n){discountninja.Cache.SessionSet("notification-dismissed",n)}};discountninja.Notification=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja.PopUp=discountninja.PopUp||{},function(){var n={GetId:function(){return"LimoniApps-DiscountNinja-Popup"},Hide:function(){try{jQuery("#LimoniApps-DiscountNinja-Popup").css("display","none")}catch(n){discountninja.Logging.LogError("PopUp.Hide",n,!0)}},InjectHtml:function(t,i){function e(n){var i=document.createDocumentFragment(),t=document.createElement("div");for(t.innerHTML=n;t.firstChild;)i.appendChild(t.firstChild);return i}var u,r,f;try{if(jQuery("#"+n.GetId()).length>0){discountninja.ShortCode.RefreshResolvedPlaceholders(jQuery("#"+n.GetId()),t,i);return}u=discountninja.Utilities.IsMobilePhone()?t.PopUpSettings.MobileSize:t.PopUpSettings.Size;r=t.PopUpSettings.Html;r=r.replace("{{HEADER}}",discountninja.TextSettings.GetText(t.PopUpSettings.Header,t));r=r.replace("{{BODY}}",discountninja.TextSettings.GetText(t.PopUpSettings.Body,t));r=r.replace("{{FOOTER}}",discountninja.TextSettings.GetText(t.PopUpSettings.Footer,t));r=r.replace("{{SIZE}}",u);r=r.replace("{{BUTTONPLACEMENT}}",u==="fullscreen"?"inside":t.PopUpSettings.ButtonPlacement);r=discountninja.ShortCode.ReplaceAllPlaceHolders(t,r,i);f=e(r);document.body.insertBefore(f,document.body.childNodes[0])}catch(o){discountninja.Logging.LogError("PopUp.InjectPopUpHtml",o,!0)}},Show:function(t,i){var e,r;try{function u(t){try{discountninja.Promotion.SetPromotionAccepted(t.Token,t.Frequency,"false");n.Hide(t.Token);discountninja.Promotion.Stop()}catch(i){discountninja.Logging.LogError("PopUp.Cancel",i,!0)}}function o(t,i){try{n.Hide(t.Token);discountninja.PromotionFlow.AcceptPromotion(t,i);discountninja.PromotionFlow.ShowNotifications(t)}catch(r){discountninja.Logging.LogError("PopUp.Accept",r,!0)}}function f(n,t){discountninja.Cache.LocalSet("popup-displayed-"+n,t)}function s(n,t){discountninja.Cache.SessionSet("popup-displayed-"+n,t)}function h(n){n.PopUpSettings.Frequency==="onceperdevice"?f(n.Token,"shown"):(f(n.Token,""),s(n.Token,"shown"))}function c(n,t,i){jQuery(n).removeClass(i.Animation);jQuery(n).addClass(t)}e=t.Token;discountninja.Logging.ShowTimeElapsed("Show pop-up");discountninja.Logging.LogVerbose("Showing pop-up");discountninja.DiscountCode.Remove(e);discountninja.Promotion.RemoveFromCache(t);r=jQuery("#"+n.GetId());r.find('.limoniapps-close[data-notify="dismiss"]').click(function(){u(t)});r.find(".limoniapps-lnk-dismiss").click(function(){u(t)});r.find('.limoniapps-action-btn[data-action="apply"]').click(function(){o(t,i)});discountninja.Settings.Settings.GeneralSettings.ShowPoweredBy?jQuery(".limoniapps-poweredby").removeClass("limoniapps-poweredby-hidden"):jQuery(".limoniapps-poweredby").addClass("limoniapps-poweredby-hidden");c(r.find(".limoniapps-content"),t.PopUpSettings.Animation,t.PopUpSettings);r.css("display","");h(t);n.PopUpDisplayed=!0}catch(l){discountninja.Logging.LogError("PopUp.Show",l,!0)}}};discountninja.PopUp=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja.Promotion=discountninja.Promotion||{},function(){var n={Promotions:null,PrimaryPromotion:null,ServerUrl:function(){return"https://discountninjav2-promotionapi-prod.azurewebsites.net"},GetPromotionByToken:function(t){if(n.Promotions)for(var i=0;i<n.Promotions.length;i++)if(n.Promotions[i].Token===t)return n.Promotions[i];return null},PromotionCanTrigger:function(t){try{return n.PromotionIsApplicable(t)?t.ServePromotion!==!0?(discountninja.Logging.LogInformation("The promotion cannot trigger because it is either inactive or scheduled (pending).",!1),!1):discountninja.Trigger.PromotionTriggersOnPage(t)?!0:!1:!1}catch(i){discountninja.Logging.LogError("Promotion.PromotionCanTrigger",i,!0)}},SetPrimaryPromotion:function(){var l,f,t,i,r,e,o,u;try{if(n.PrimaryPromotion=null,discountninja.Environment.Shopify.IsProductPage()){var s=discountninja.Environment.Shopify.ProductHandle(),h=discountninja.Environment.Shopify.VariantId(),c=discountninja.LiquidData.Inventory(h);discountninja.Logging.LogVerbose("Selecting primary promotion based on product handle: "+s+" (inventory: "+c+")");l=discountninja.LiquidData.Price(h);n.PrimaryPromotion=n.GetPromotionForProduct(s,null,c,l)}if(n.PrimaryPromotion===null){for(discountninja.Logging.LogVerbose("Selecting primary promotion based on first applicable"),f=n.Promotions,t=[],i=0;i<f.length;i++)(n.PromotionCanTrigger(f[i])||n.IsPromotionAccepted(f[i].Token,f[i].Frequency))&&t.push(f[i]);if(t.length===0)discountninja.Logging.LogInformation("No primary promotion detected");else if(t.length===1)n.PrimaryPromotion=t[0];else{for(r=[],e=0;e<t.length;e++)u=t[e],u.PopUpSettings.Enabled&&r.push(u);if(r.length===0)n.PrimaryPromotion=t[0];else if(t.length===1)n.PrimaryPromotion=r[0];else{for(o=0;o<r.length;o++)if(u=r[o],!n.IsPromotionAccepted(u.Token,u.Frequency)){n.PrimaryPromotion=u;return}n.PrimaryPromotion=r[0]}}}}catch(a){discountninja.Logging.LogError("Promotion.SetPrimaryPromotion",a,!0)}},LoadApplicablePromotions:function(t,i){function y(n){try{var t=discountninja.Cache.SessionGet("promotioninfo-"+n);return t==="undefined"?null:JSON.parse(t)}catch(i){return discountninja.Logging.LogError("Promotion.GetPromotionInfoFromCache",i,!0),null}}function p(t){var i,r,u;try{if(!t)return null;for(discountninja.Logging.LogVerbose("Before filter "+t.length+" promotions available"),i=[],r=0;r<t.length;r++)u=t[r],n.PromotionIsApplicable(u)&&i.push(u);return discountninja.Logging.LogVerbose("After filter "+i.length+" promotions available"),i}catch(f){return discountninja.Logging.LogError("Promotion.FilterPromotions",f,!0),null}}function w(n,t){try{discountninja.Cache.SessionSet("promotioninfo-"+n,JSON.stringify(t))}catch(i){discountninja.Logging.LogError("Promotion.SavePromotionInfoToCache",i,!0)}}function b(t,i){try{if(n.Promotions=null,n.PrimaryPromotion=null,discountninja.Settings.Settings=t.Settings,!discountninja.Settings.SettingsAreValid(discountninja.Settings.Settings))return discountninja.Logging.LogWarning("Settings invalid",!0,!1),null;n.Promotions=p(t.Promotions);var r=n.Promotions;if(!r)return discountninja.Logging.LogInformation("No promotions available",!1),null;discountninja.Trigger.TrackExitIntent();w(i,t)}catch(u){return discountninja.Logging.LogError("Promotion.ProcessPromotionInfo",u,!0),null}}function f(n){try{if(n===null||n===undefined||n.Settings===undefined||n.Settings===null||n.Promotions===undefined||n.Promotions===null)return(discountninja.Logging.LogError("Promotion.PromotionInfoReady","Promotion Info null or no settings/promotions available",!0),i)?i():void 0;if(n===!1||n.Promotions.length===0)return(discountninja.Logging.LogInformation("No applicable promotion(s) detected",!1),i)?i():void 0;discountninja.Logging.LogVerbose("Valid Promotion Info received from server");b(n,r);var u=discountninja.Token.GetTokenFromQueryParameter();return(u!==null&&u!==""&&discountninja.Token.SetNonAutomaticTokenInSession(u),t)?t(n):void 0}catch(f){return(discountninja.Logging.LogError("Promotion.PromotionInfoReady",f,!0),i)?i():void 0}}function k(){try{var n={};return h&&(n.shop=h),e&&(n.token=e),l&&(n.pageType=l),a&&(n.collectionHandle=a),o&&(n.productHandle=o),v&&(n.variantId=v),discountninja.TestMode.TestMode!==null&&(n.testMode=discountninja.TestMode.TestMode),s!==null&&(n.firstRequest=s),c&&(n.referrer=c),n}catch(t){return discountninja.Logging.LogError("Promotion.LoadPromotionInfo.BuildParameters",t,!0),null}}var s,h,c;try{var e=discountninja.Token.GetNonAutomaticToken(),l=discountninja.Environment.Shopify.PageType(),a=discountninja.Environment.Shopify.CollectionHandle(),o=discountninja.Environment.Shopify.ProductHandle(),v=discountninja.Environment.Shopify.VariantId(),r="token_"+e,u=y(r);if(u!==null)return discountninja.Logging.LogVerbose("Promotion info available in cache"),f(u);if(u!==null)return f(u);discountninja.Logging.LogVerbose("Loading promotion info from server");s=discountninja.Cache.SessionGet("promotioninfo-requested-"+r)===null;h=discountninja.Shop;discountninja.Environment.Shopify.IsProductPage()||(o=null);c=discountninja.Utilities.GetReferrer();discountninja.XmlHttpRequest.Send(n.ServerUrl()+"/api/ApplicablePromotions",k(),null,"get",!0,!0,f);discountninja.Cache.SessionSet("promotioninfo-requested-"+r,!0)}catch(d){discountninja.Logging.LogError("Promotion.LoadPromotionInfo",d,!0);i()}},PromotionIsApplicable:function(t){function h(n,t){return t==="onceperdevice"?discountninja.Cache.LocalGet("promotion-accepted-"+n)==="false":discountninja.Cache.SessionGet("promotion-accepted-"+n)==="false"}var u,f;try{if(!t)return!1;var c=t.Token,i=t.PriceRuleInfo,r=t.FilterSettings;if(!i)return!1;if(i.StartsAt!==null&&i.StartsAt!==undefined&&i.StartsAt!==""&&moment().utc().diff(moment(i.StartsAt).utc(),"seconds")<0&&(discountninja.Logging.LogTestMode("Promotion would normally not be displayed because the start date ("+i.StartsAt+") of the promotion is in the future, it is only shown because you are in test mode. Check the start date of your promotion and the start date of your discount code (Discount module). Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/schedule/how-to-startend-a-promotion-automatically' target='_blank'>here<\/a>.",null,!0,!0,!1),discountninja.TestMode.TestMode===!1)||i.EndsAt!==null&&i.EndsAt!==undefined&&i.EndsAt!==""&&moment().utc().diff(moment(i.EndsAt).utc(),"seconds")>=0&&(discountninja.Logging.LogTestMode("Promotion would normally not be displayed because the expiration date ("+i.EndsAt+")  of the discount code "+i.DiscountLevel1.DiscountCode+" is in the past or the timer has expired. Check the end date of your promotion, the expiration date of your discount code and the end date of your discount code (Discount module). Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/schedule/how-to-startend-a-promotion-automatically' target='_blank'>here<\/a>.",null,!0,!0,!1),discountninja.TestMode.TestMode===!1))return n.Stop(t.Token),!1;if(h(t.Token,t.Frequency))return discountninja.Logging.LogVerbose("Promotion with token "+c+" is not applicable because it was previously canceled"),n.Stop(t.Token),!1;if(r.CustomerType&&r.CustomerType==="customers_only"&&!discountninja.Environment.Shopify.IsCustomer()){if(discountninja.Logging.LogTestMode("Promotion would normally not be displayed because it is restricted to customers only and you are not logged in as a customer, it is only shown because you are in test mode. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/restricting-promotions-to-customers-or-prospects' target='_blank'>here<\/a>.",null,!0,!0,!1),discountninja.TestMode.TestMode===!1)return n.Stop(t.Token),!1}else if(r.CustomerType==="prospects_only"&&discountninja.Environment.Shopify.IsCustomer()&&(discountninja.Logging.LogTestMode("Promotion would normally not be displayed it is restricted to prospects only and you are logged in as a customer, it is only shown because you are in test mode. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/restricting-promotions-to-customers-or-prospects' target='_blank'>here<\/a>.",null,!0,!0,!1),discountninja.TestMode.TestMode===!1))return n.Stop(t.Token),!1;if(r.CustomerType==="customers_only"&&discountninja.Environment.Shopify.CustomerTags()!==null){var o=discountninja.Environment.Shopify.CustomerTags(),s=r.CustomerTags.split(","),e=!1;for(u=0;u<o.length;u++)for(f=0;f<s.length;f++)o[u].toLowerCase().trim()===s[f].toLowerCase().trim()&&(e=!0);if(r.CustomerTagType==="include"&&e===!1&&(discountninja.Logging.LogTestMode("Promotion would normally not be displayed because the logged in customer is not tagged with one of the following tags: "+r.CustomerTags+", it is only shown because you are in test mode. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/restricting-promotions-to-customers-or-prospects' target='_blank'>here<\/a>.",null,!0,!0,!1),discountninja.TestMode.TestMode===!1)||r.CustomerTagType==="exclude"&&e===!0&&(discountninja.Logging.LogTestMode("Promotion would normally not be displayed because the logged in customer is tagged with one of the following tags: "+r.CustomerTags+", it is only shown because you are in test mode. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/restricting-promotions-to-customers-or-prospects' target='_blank'>here<\/a>.",null,!0,!0,!1),discountninja.TestMode.TestMode===!1))return n.Stop(t.Token),!1}return discountninja.Logging.LogVerbose("The promotion is applicable"),!0}catch(l){return discountninja.Logging.LogError("Promotion.PromotionIsApplicable",l,!0),null}},GetPromotionServedInSession:function(n,t){return discountninja.Cache.SessionGet("promotion-served-session-"+n+"-"+t)},SetPromotionServedInSession:function(n,t,i){discountninja.Cache.SessionSet("promotion-served-session-"+n+"-"+t,i)},GetPromotionServedOnDevice:function(n,t){return discountninja.Cache.LocalGet("promotion-served-device-"+n+"-"+t)},SetPromotionServedOnDevice:function(n,t,i){discountninja.Cache.LocalSet("promotion-served-device-"+n+"-"+t,i)},IsPromotionAccepted:function(n,t){var i;return t==="onceperdevice"?(i=discountninja.Cache.LocalGet("promotion-accepted-"+n)==="true",discountninja.Logging.LogVerbose("The promotion is accepted on device: "+i),i):(i=discountninja.Cache.SessionGet("promotion-accepted-"+n)==="true",discountninja.Logging.LogVerbose("The promotion is accepted in the session: "+i),i)},SetPromotionAccepted:function(n,t,i){t==="onceperdevice"?discountninja.Cache.LocalSet("promotion-accepted-"+n,i):(discountninja.Cache.LocalSet("promotion-accepted-"+n,""),discountninja.Cache.SessionSet("promotion-accepted-"+n,i))},SetPromotionExpired:function(n){discountninja.Cache.LocalSet("promotion-expired-"+n,"true")},ExpirePromotionsAccepted:function(){if(n.Promotions)for(var t=0;t<n.Promotions.length;t++)n.SetPromotionExpired(token)},GetPromotionPriceRule:function(t){t||(t=n.PrimaryPromotion);var i=t?discountninja.DiscountLevel.GetCurrentDiscountLevel(t):null;return i?i.PriceRuleId:null},GetPromotionDiscountCode:function(t){t||(t=n.PrimaryPromotion);var i=t?discountninja.DiscountLevel.GetCurrentDiscountLevel(t):null;return i?i.DiscountCode:null},GetPromotionForProduct:function(t,i,r,u){function v(n,t,i){try{if(n.PriceRuleInfo.TargetType!=="line_item")return discountninja.Logging.LogVerbose("Promotion with token "+n.Token+" not valid for product "+t+" - Shipping only"),!1;if(discountninja.Utilities.StringIsIn(i,n.ExcludeCollectionHandles))return discountninja.Logging.LogVerbose("The promotion is not valid for product "+t+" because that product is in an exclude collection."),!1;if(n.TargetType==="collection"){if(!discountninja.Utilities.StringIsIn(i,n.TargetCollectionHandles))return discountninja.Logging.LogVerbose("The promotion is not valid for product "+t+" because that product is not in the set of promoted collections."),discountninja.Logging.LogVerbose("The promotion applies to products in the collections '"+n.TargetCollectionHandles+"' the product '"+t+" is in collections '"+i+"'."),!1}else if(n.TargetType==="product"){if(!discountninja.Utilities.StringIsIn(n.PriceRuleInfo.TargetProductHandles,t))return discountninja.Logging.LogVerbose("The promotion is not valid for product "+t+" because that product is not in the set of promoted products."),discountninja.Logging.LogVerbose("The promotion applies to products '"+n.PriceRuleInfo.TargetProductHandles+"' the product '"+t+" is not in that list."),!1}else if(n.TargetType!=="site")return discountninja.Logging.LogError("Promotion.PromotionIsValidForProduct","TargetType unknown",!0),!1;return discountninja.Logging.LogVerbose("Promotion is valid for product"),!0}catch(r){return discountninja.Logging.LogError("Promotion.PromotionIsValidForProduct",r,!0),!1}}function y(n,t,i){var u;try{var l=n.DiscountPriceType,f=n.ValueType,e=t.Amount,o=t.Percentage,s=discountninja.Settings.Settings.CurrencySettings.RoundPrices,h=discountninja.Settings.Settings.CurrencySettings.RoundToCents,r=0;return f=="fixed_amount"?r=i-e:f=="percentage"&&(r=parseFloat((i-Math.floor(i*o)/100).toFixed(4))),r<0&&(r=0),s&&(u=r*100,u>0&&(u=Math.floor(u/100)*100+h),r=Math.round(u)/100),Math.round(r*100)/100}catch(c){discountninja.Logging.LogError("Promotion.TestDiscountedPrice",c,!0)}}var o,e,f,a,c,l;try{if(t===null||t===undefined)return discountninja.Logging.LogWarning("No product handle passed",!0,!1),null;if(o=n.Promotions,!o)return discountninja.Logging.LogInformation("No promotions available",!1),null;var s=null,h=null,i=i||discountninja.LiquidData.ProductCollections();for(e=0;e<o.length;e++)f=o[e],discountninja.Logging.LogVerbose("Checking promotion "+(e+1)+" with token "+f.Token),n.PromotionIsApplicable(f)&&v(f,t,i,r)&&n.IsPromotionAccepted(f.Token,f.Frequency)?(discountninja.Logging.LogVerbose("Promotion "+(e+1)+" with token "+f.Token+" - Valid"),a=f.PriceRuleInfo,c=discountninja.DiscountLevel.GetCurrentDiscountLevel(f),c&&(l=y(a,discountninja.DiscountLevel.GetPercentageAmountFromDiscountLevel(c),u),(h===null||l<h)&&(s=e,h=l))):discountninja.Logging.LogVerbose("Promotion "+(e+1)+" with token "+f.Token+" - Not valid");return s===null?(discountninja.Logging.LogInformation("No applicable promotion available for product "+t,!1),null):(discountninja.Logging.LogVerbose("Using promotion "+o[s].Token+" for product "+t),o[s])}catch(p){return discountninja.Logging.LogError("Promotion.GetPromotionForProduct",p,!0),!1}},GetTokenForProductFromCache:function(n){return discountninja.Cache.SessionGet("token-forproduct-"+n)},SetTokenForProductInCache:function(n,t){discountninja.Cache.SessionSet("token-forproduct-"+n,t)},GetFromCache:function(n){try{var t=discountninja.Cache.SessionGet("promotion-data-"+n);return t==="undefined"?[]:JSON.parse(t)}catch(i){return discountninja.Logging.LogError("Promotion.GetFromCache",i,!0),null}},SaveToCache:function(n){try{discountninja.Cache.SessionSet("promotion-data-"+n.Token,JSON.stringify(n))}catch(t){discountninja.Logging.LogError("Promotion.SaveToCache",t,!0)}},RemoveFromCache:function(n){try{discountninja.Cache.SessionRemove("promotion-data-"+n)}catch(t){return discountninja.Logging.LogError("Promotion.RemoveFromCache",t,!0),null}},Stop:function(t){try{discountninja.Logging.LogVerbose("Stopping promotion.");discountninja.DiscountCode.Remove(t);discountninja.Notification.Remove(t);discountninja.PopUp.Hide(t);discountninja.StickyBar.Remove(t);discountninja.DynamicPricing.Show(!1);n.SetPromotionExpired(t)}catch(i){discountninja.Logging.LogError("Promotion.Stop",i,!0)}},UnApply:function(n){try{discountninja.Logging.LogVerbose("Unapplying promotion.");discountninja.DiscountCode.Remove(n);discountninja.Notification.Remove(n)}catch(t){discountninja.Logging.LogError("Promotion.UnApply",t,!0)}},ExpireAll:function(){try{discountninja.Logging.LogVerbose("Expired. Stopping all promotions with timers. Undoing all side effects");discountninja.Checkout.Shopify.UnRegisterEventHandlerForCheckout();discountninja.DiscountCode.Clear();discountninja.ShortCode.HideShortcodePlaceholders();discountninja.Notification.Clear();discountninja.Notification.Hide();discountninja.StickyBar.Clear();discountninja.StickyBar.Hide();var t=n.PrimaryPromotion;t&&discountninja.PopUp.Hide(t.Token);discountninja.DynamicPricing.Show(!1);n.ExpirePromotionsAccepted();discountninja.PromotionFlow.StartFlow()}catch(i){discountninja.Logging.LogError("Promotion.ExpireAll",i,!0)}}};discountninja.Promotion=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja.ProductData=discountninja.ProductData||{},function(){var n={ServerUrl:function(){return"https://discountninjav2-promotionapi-prod.azurewebsites.net"},SaveProductDataToCache:function(t,i,r,u,f,e,o){try{discountninja.Logging.LogVerbose("Saving product data for handle: "+t);var s={CompareAtPrice:i,Price:r,Inventory:e,Collections:u,CollectionsComplete:f,Source:o},h=n.GetByProductHandle(t,!1);if(!h){discountninja.Cache.LocalSet("productdatav2-"+t,JSON.stringify(s));return}if(o==="product"){discountninja.Cache.LocalSet("productdatav2-"+t,JSON.stringify(s));return}if(h.Source==="product")discountninja.Logging.LogVerbose("Current cached product data is from product page and new data is not, skipping save for handle: "+t);else{if(o==="server"){discountninja.Cache.LocalSet("productdatav2-"+t,JSON.stringify(s));return}if(o==="collection"){h.CollectionsComplete&&!s.CollectionsComplete?s.Collections=h.Collections:h.CollectionsComplete===null&&(s.CollectionsComplete||s.Collections!==null||discountninja.Environment.Shopify.IsCollectionPage()&&(s.Collections=discountninja.Environment.Shopify.CollectionHandle(),s.CollectionsComplete=!1,discountninja.Logging.LogVerbose("No collections data, setting current collection for: "+t)));discountninja.Cache.LocalSet("productdatav2-"+t,JSON.stringify(s));return}if(h.Source==="product"||h.Source==="collection"||h.Source==="server"){discountninja.Logging.LogVerbose("Current cached product data is from ' + currentData.Source + ' and new data is from a less trustworthy source "+s.Source+" , skipping save for handle: "+t);return}discountninja.Cache.LocalSet("productdatav2-"+t,JSON.stringify(s));return}}catch(c){return discountninja.Logging.LogError("ProductData.SaveProductDataToCache",c,!0),null}},Save:function(){var r,t,i,c;try{for(discountninja.Logging.LogVerbose("Saving product data for products on page"),r=jQuery("[data-limoniapps-discountninja-product-handle]"),t=0;t<r.length;t++){var s=!0,i=jQuery(r[t]).attr("data-limoniapps-discountninja-product-handle"),e=jQuery(r[t]).attr("data-limoniapps-discountninja-product-price"),o=jQuery(r[t]).attr("data-limoniapps-discountninja-product-compareatprice"),f=jQuery(r[t]).attr("data-limoniapps-discountninja-product-collections");!f&&discountninja.Environment.Shopify.IsCollectionPage()&&(f=discountninja.Environment.Shopify.CollectionHandle(),s=!1);discountninja.Logging.LogVerbose("Saving product data for products on page - detected collection product with handle: "+i);n.SaveProductDataToCache(i,o,e,f,s,null,"collection")}if(discountninja.Environment.Shopify.IsProductPage()){var i=discountninja.Environment.Shopify.ProductHandle(),u=discountninja.LiquidData.ProductDefaultVariantId(i),h=discountninja.LiquidData.Inventory(u),e=discountninja.LiquidData.Price(u)*100,o=discountninja.LiquidData.CompareAtPrice(u)*100,f=discountninja.LiquidData.ProductCollections();discountninja.Logging.LogVerbose("Saving product data for products on page - detected product page product with handle: "+i);n.SaveProductDataToCache(i,o,e,f,!0,h,"product")}if(window.limoniapps_discountninja_liquid&&window.limoniapps_discountninja_liquid.Cart&&window.limoniapps_discountninja_liquid.Cart.items&&window.limoniapps_discountninja_liquid.Cart.length>0)for(t=0;t<window.limoniapps_discountninja_liquid.Cart.length;t++)if(i=window.limoniapps_discountninja_liquid.Cart.items[0].handle,c=n.GetByProductHandle(productHandle,!0),!c){var u=discountninja.LiquidData.ProductDefaultVariantId(i),h=discountninja.LiquidData.Inventory(u),e=discountninja.LiquidData.Price(u)*100,o=discountninja.LiquidData.CompareAtPrice(u)*100;discountninja.Logging.LogVerbose("Saving product data for products on page - detected cart product with handle: "+i);n.SaveProductDataToCache(i,o,e,null,!1,h,"cart");n.GetProductDataFromServer(i)}}catch(l){return discountninja.Logging.LogError("ProductData.Save",l,!0),null}},SaveOnAddToCart:function(t){try{var i=discountninja.LiquidData.PriceFromCartByProductHandle(t)*100;n.SaveProductDataToCache(t,null,i,null,!1,null,"addtocart")}catch(r){return discountninja.Logging.LogError("ProductData.Save",r,!0),null}},GetByVariant:function(t,i){try{var r=discountninja.LiquidData.ProductHandleFromCart(t);return n.GetByProductHandle(r,i)}catch(u){return discountninja.Logging.LogError("ProductData.Get",u,!0),null}},GetProductDataFromServer:function(t){function u(){try{var n={};return r&&(n.shop=r),i&&(n.handle=i),n}catch(t){return discountninja.Logging.LogError("ProductData.GetProductDataFromServer.GetProductDataFromServer",t,!0),null}}function f(t){try{if(!t)return;discountninja.Logging.LogVerbose("Retrieved product data from server for product with handle: "+t.Handle);n.SaveProductDataToCache(t.Handle,t.CompareAtPrice,t.Price,t.Collections,!0,0,"server")}catch(i){return discountninja.Logging.LogError("ProductData.GetProductDataFromServer.ProductDataReady",i,!0),null}}try{var r=discountninja.Shop,i=t;discountninja.Logging.LogVerbose("Getting product data from server for product with handle: "+i);discountninja.XmlHttpRequest.Send(n.ServerUrl()+"/api/ProductData",u(),null,"get",!0,!0,f)}catch(e){discountninja.Logging.LogError("ProductData.GetProductDataFromServer",e,!0)}},GetByProductHandle:function(t,i){try{i==null&&(i=!1);var r=discountninja.Cache.LocalGet("productdatav2-"+t),u=r==="undefined"?null:JSON.parse(r),f=u===null?!1:r.Source==="product"||r.Source==="collection"&&r.CollectionsComplete;return i&&!f&&n.GetProductDataFromServer(t),u}catch(e){return discountninja.Logging.LogError("ProductData.Get",e,!0),null}}};discountninja.ProductData=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja.ErrorHandler=discountninja.ErrorHandler||{},function(){var n={ServerUrl:function(){return"https://discountninjav2-loggingapi-prod.azurewebsites.net"},LogErrorToServer:function(t,i){function u(n){try{n?discountninja.Logging.LogVerbose("Log error completed successfully"):discountninja.Logging.LogVerbose("Could not log error")}catch(t){discountninja.Logging.LogError("ErrorHandler.LogErrorToServer.onLogErrorComplete",t,!0)}}function f(n){return n?/search|spider|crawl|Bot|Monitor|BrowserMob|BingPreview|PagePeeker|WebThumb|URL2PNG|ZooShot|GomezA|Google SketchUp|Read Later|KTXN|KHTE|Keynote|Pingdom|AlwaysOn|zao|borg|oegp|silk|Xenu|zeal|NING|htdig|lycos|slurp|teoma|voila|yahoo|Sogou|CiBra|Nutch|Java|JNLP|Daumoa|Genieo|ichiro|larbin|pompos|Scrapy|snappy|speedy|vortex|favicon|indexer|Riddler|scooter|scraper|scrubby|WhatWeb|WinHTTP|voyager|archiver|Icarus6j|mogimogi|Netvibes|altavista|charlotte|findlinks|Retreiver|TLSProber|WordPress|wsr-agent|http client|Python-urllib|AppEngine-Google|semanticdiscovery|facebookexternalhit|Google-HTTP-Java-Client/i.test(n):!1}function e(){try{var r={},u=discountninja.Promotion.PrimaryPromotion===null?null:discountninja.Promotion.PrimaryPromotion.PriceRuleInfo.DiscountLevel1.DiscountCode,e=discountninja.Token.GetToken(),o=discountninja.Shop,s=n.ProductHandle,h=discountninja.Environment.Shopify.CollectionHandle(),c=discountninja.Environment.Shopify.VariantId();return r.errorContext=JSON.stringify(t),r.isBot=f(r.errorContext),r.level=i,o&&(r.shop=o),e&&(r.token=e),u&&(r.discountCode=u),s&&(r.productHandle=s),h&&(r.collectionHandle=h),c&&(r.variantId=c),r}catch(l){return discountninja.Logging.LogError("ErrorHandler.LogPromotionEvent.BuildParameters",l,!0),null}}try{discountninja.Logging.LogVerbose("Logging error "+JSON.stringify(t));var s=discountninja.Promotion.GetPromotionDiscountCode()||"No promotion title available",r=e();r.isBot?discountninja.Logging.LogVerbose("Not sending error message to server, browser is a bot"):discountninja.XmlHttpRequest.Send(n.ServerUrl()+"/api/Exception",r,null,"get",!0,!1,u)}catch(o){discountninja.Logging.LogError("ErrorHandler.LogErrorToServer",o,!1)}}};discountninja.ErrorHandler=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja.PromotionEvent=discountninja.PromotionEvent||{},function(){var n={ServerUrl:function(){return"https://discountninjav2-loggingapi-prod.azurewebsites.net"},GetPromotionEventSentInSession:function(n,t,i){return discountninja.Cache.SessionGet("promotionevent-sent-"+n+"-"+t+"-"+i)},SetPromotionEventSentInSession:function(n,t,i,r){discountninja.Cache.SessionSet("promotionevent-sent-"+n+"-"+t+"-"+i,r)},LogPromotionEvent:function(t,i){function o(n){try{n?discountninja.Logging.LogVerbose("Log event of type "+i+" completed successfully"):discountninja.Logging.LogError("PromotionEvent.LogPromotionEvent.onLogComplete","Could not log event of type "+i,!0)}catch(t){discountninja.Logging.LogError("PromotionEvent.LogPromotionEvent.onLogComplete",t,!0)}}function s(){try{var n={},t=discountninja.Shop;return t&&(n.shop=t),r&&(n.token=r),u&&(n.discountCode=u),e&&(n.priceRuleId=e),n.eventType=i,n}catch(f){return discountninja.Logging.LogError("PromotionEvent.LogPromotionEvent.BuildParameters",f,!0),null}}try{if(discountninja.TestMode.TestMode)return;var r=t.Token,f=t.PriceRuleInfo.DiscountLevel1,u=f.DiscountCode,e=f.PriceRuleId,h=n.GetPromotionEventSentInSession(r,u,i)==="sent";if(h){discountninja.Logging.LogVerbose("Event of type "+i+" already sent for promotion with token "+r+" and discount code "+u);return}n.SetPromotionEventSentInSession(r,u,i,"sent");discountninja.Logging.LogVerbose("Logging event of type "+i);discountninja.XmlHttpRequest.Send(n.ServerUrl()+"/api/PromotionEvent",s(),null,"get",!0,!0,o)}catch(c){discountninja.Logging.LogError("PromotionEvent.LogPromotionEvent",c,!0)}}};discountninja.PromotionEvent=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja.PromotionFlow=discountninja.PromotionFlow||{},function(){var n={ShowStickyBar:function(){function u(){var t="",i=discountninja.Settings.Settings.StickyBarSettings;return i.Enabled||(t="Sticky bar is not required because that building block is disabled"),n.HandleFlowErrorMessage(t,!1)}var i,r,t;if(u()){if(discountninja.StickyBar.Clear(),i=discountninja.Promotion.Promotions,i){for(r=0;r<i.length;r++)t=i[r],n.IsBuildingBlockEnabledForPage(discountninja.Settings.Settings.StickyBarSettings,"","Sticky bar")===""?t.StickyBarSettings.Body||t.StickyBarSettings.TimerFooter?(discountninja.Logging.LogVerbose("Adding sticky bar message for promotion with token "+t.Token),discountninja.StickyBar.Add(t.Token)):discountninja.Logging.LogVerbose("No sticky bar message for promotion with token "+t.Token):discountninja.Logging.LogVerbose("Sticky bar message for promotion with token "+t.Token+" not added");discountninja.StickyBar.Show()}}else discountninja.Logging.LogVerbose("Sticky bar not added")},HideAdditionalCheckoutButtons:function(){function i(t){discountninja.Logging.LogVerbose("Adding css :"+t);var i=document.createElement("style");i.type="text/css";i.id=n;i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t));document.getElementsByTagName("head")[0].appendChild(i)}function r(n,t){return n+" "+t}function u(n){return n+" { display: none !important; }"}function f(){return jQuery("#"+n).length==0}function e(n,t){for(var e="",o=0;o<n.length;o++)e=r(e,u(n[o]));t&&f()&&i(e)}var n="limoniapps-additionalcheckoutbuttons-style",t;discountninja.Settings.Settings.PriceUpdateSettings.HideAdditionalCheckoutButtons&&(t=[".additional-checkout-buttons",".additional-checkout-button",".shopify-payment-button"],e(t,!0,!1));jQuery('form[action^="/checkout"]').find(":submit").addClass("saso-ignore")},StartFlow:function(){function h(){try{var t=discountninja.Utilities.GetMutationObserver(),i=new t(function(t){var f,e,i;try{for(f=0;f<t.length;f++)for(e=0;e<t[f].addedNodes.length;e++)if(i=t[f].addedNodes[e],i!==undefined&&i!==null&&i.nodeName!==null&&i.nodeName!==undefined&&i.nodeName.indexOf("text")===-1){var u=i.nodeName.toLowerCase(),r=jQuery(i).html(),o=jQuery("body").css("margin-top");if(u==="form"&&(discountninja.Logging.LogVerbose("Form added"),discountninja.Checkout.Shopify.RegisterEventHandlerForCheckout()),r!==undefined&&r!==null&&typeof r.indexOf=="function"&&(r.indexOf("<a")>-1||r.indexOf("<button")>-1)&&(r.indexOf("/checkout")>-1||r.indexOf("/cart")>-1)&&(discountninja.Logging.LogVerbose("Anchor or button with link to checkout added"),discountninja.Checkout.Shopify.RegisterEventHandlerForCheckout()),u==="div"&&typeof i.getAttribute=="function"&&i.getAttribute("id")==="spurit-occ-popup"&&(discountninja.Logging.LogVerbose("Div spurit-occ-popup added"),discountninja.Checkout.Shopify.RegisterEventHandlerForCheckout()),u==="div"&&typeof i.getAttribute=="function"&&i.getAttribute("id")==="qab_bar"&&(discountninja.Logging.LogVerbose("Div qab_bar added"),jQuery("#qab_bar").css("top",o)),u==="div"&&typeof i.getAttribute=="function"&&i.getAttribute("id")==="fsb_background"&&(discountninja.Logging.LogVerbose("Div fsb_background added"),discountninja.Utilities.IsMobilePhone()||jQuery("#fsb_background").css("top",o)),u==="div"&&typeof i.getAttribute=="function"&&i.getAttribute("id")==="spb-information-bar"&&(discountninja.Logging.LogVerbose("Div spb-information-bar added"),jQuery("#spb-information-bar").css("top",o)),u==="div"&&typeof i.getAttribute=="function"&&i.getAttribute("class")==="wheelio_holder"){discountninja.Logging.LogVerbose("Wheelio popup added, registering hook");jQuery(".wheelio_holder .wlo_btn.wlo_copy_code").on("click",function(){discountninja.Logging.LogVerbose("Promotion triggered via wheelio apply button");var t=jQuery(".wheelio_holder .wlo_input_code").val();n.TriggerPromotion(t)})}typeof i.getAttribute=="function"&&i.getAttribute("class")&&i.getAttribute("class").indexOf("limoniapps-discountninja-drawercart-root")>0&&(discountninja.Logging.LogVerbose("Drawer cart added"),i.getAttribute("display")==="none"?(discountninja.Logging.LogVerbose("Drawer cart hidden, showing sticky bar if available"),discountninja.StickyBar.Show()):(discountninja.Logging.LogVerbose("Drawer cart visible, hiding sticky bar and replacing prices"),discountninja.StickyBar.Hide(),discountninja.DiscountCode.InjectDiscountCodesInHtml(),discountninja.DynamicPricing.ReplacePricesInDrawerCart()));typeof i.getAttribute=="function"&&i.getAttribute("class")&&i.getAttribute("class").indexOf("limoniapps-discountninja-cart-root")>0&&(discountninja.Logging.LogVerbose("Cart added"),setTimeout(discountninja.DynamicPricing.ReplacePricesInCart(),1e3));typeof i.getAttribute=="function"&&i.getAttribute("class")&&i.getAttribute("class").indexOf("limoniapps-discountninja-cart-root")>0&&(discountninja.Logging.LogVerbose("Cart added"),setTimeout(discountninja.DynamicPricing.ReplacePricesInCart(),1e3))}}catch(s){discountninja.Logging.LogError("PromotionFlow.ListenForDynamicallyAddedElements.mutationObserver",s,!0)}});i.observe(document.body,{attributes:!1,childList:!0,subtree:!0,characterData:!1})}catch(r){discountninja.Logging.LogError("PromotionFlow.ListenForDynamicallyAddedElements",r,!0)}}function c(t){var i="";return i=n.IsBuildingBlockEnabledForPage(t.PopUpSettings,i,"Pop-up"),n.HandleFlowErrorMessage(i,!1)}function e(t){var i="";return t.PopUpSettings.Enabled||(i="Pop-up is not displayed for promotion with token "+t.Token+" because that building block is disabled for this promotion"),n.HandleFlowErrorMessage(i,!1)}function l(t,i){try{var r=!1;if(discountninja.Timer.ShouldStartOnDisplay(t)&&discountninja.Timer.Start(),e(t))if(c(t))if(n.HasPopUpBeenShownForLevel(t))discountninja.Promotion.IsPromotionAccepted(t.Token,t.Frequency)?(discountninja.Logging.LogInformation("FLOW: Skipping pop-up, pop-up already shown and accepted"),r=!0):discountninja.Logging.LogInformation("FLOW: Stopping execution because pop-up was shown before and not accepted",!0,!1);else return discountninja.Logging.LogInformation("FLOW: Showing pop-up"),discountninja.PopUp.Show(t,i);else discountninja.Logging.LogInformation("FLOW: Skipping pop-up, display not required"),r=!0;else discountninja.Logging.LogInformation("FLOW: Skipping pop-up, not enabled"),r=!0;return r&&(discountninja.PromotionEvent.LogPromotionEvent(t,0),discountninja.Promotion.SetPromotionAccepted(t.Token,t.Frequency,"true"),n.AcceptPromotion(t,i)),n.ShowNotifications(),n.StopFlow()}catch(u){discountninja.Logging.LogError("PromotionFlow.StartFlow",u,!0)}}function a(){var t=discountninja.Promotion.Promotions,n,i,r,u;if(t)for(n=0;n<t.length;n++)i=t[n],discountninja.Promotion.PromotionIsApplicable(i)?(r=discountninja.DiscountLevel.GetCurrentDiscountLevelNumber(i,discountninja.LiquidData.CartValue()),u=discountninja.DiscountLevel.GetMaxDiscountLevelNumber(i.PriceRuleInfo),r!==u&&discountninja.Promotion.UnApply(t[n].Token)):discountninja.Promotion.Stop(t[n].Token)}var v,t,o,i,r,u,f;try{if(v=!1,!discountninja.Settings.Settings){discountninja.Logging.LogInformation("FLOW: Canceling since no settings are available");return}if(discountninja.Logging.LogInformation("FLOW: Starting flow"),discountninja.Environment.Shopify.IsCartPage()||discountninja.VariantChange.RegisterEventHandlerForVariantChange(),discountninja.DiscountCode.UndoInjectDiscountCodesInHtml(),discountninja.Cart.Shopify.RegisterEventHandlerForAddToCart(),a(),discountninja.DynamicPricing.UpdatePrice(!1),h(),discountninja.Trigger.MarkPageAsVisited(),n.ShowStickyBar(),discountninja.Promotion.SetPrimaryPromotion(),t=discountninja.Promotion.PrimaryPromotion,t===null)return discountninja.Logging.LogInformation("No valid applicable promotion",!1),discountninja.Timer.IsTimerStarted()&&discountninja.Timer.Start(),o=discountninja.DiscountCode.GetActiveDiscountCodesForCheckoutAsString(),o!==""&&n.HideAdditionalCheckoutButtons(),n.ShowNotifications(),n.StopFlow();for(n.ViewPromotion(t),n.HideAdditionalCheckoutButtons(),discountninja.Timer.ShouldNotStart(t)&&discountninja.Timer.Stop(),t!==null&&e(t)&&discountninja.PopUp.InjectHtml(t,i),i=discountninja.DiscountedProduct.GetFromProductPage(),r=0;r<discountninja.Promotion.Promotions.length;r++)u=discountninja.Promotion.Promotions[r],u.Token!==discountninja.Promotion.PrimaryPromotion.Token&&(n.ViewPromotion(u),n.AcceptPromotion(u,i));discountninja.DiscountCode.InjectDiscountCodesInHtml();f=null;function s(){discountninja.Logging.LogInformation("FLOW: Waiting for trigger conditions to be met");discountninja.Trigger.PromotionTriggerConditionsMet(t)?(discountninja.Logging.LogInformation("FLOW: Trigger conditions met, displaying promotion"),f!==null&&clearTimeout(f),l(t,i)):(discountninja.DynamicPricing.UnblockPricesAndButtons(),f=setTimeout(function(){s()},500))}s()}catch(y){discountninja.Logging.LogError("PromotionFlow.StartFlow",y,!0)}},IsNotificationRequired:function(){var t="",i=discountninja.Settings.Settings.NotificationSettings;return i.Enabled||(t="Notification is not required because that building block is disabled"),t==""&&(t=n.IsBuildingBlockEnabledForPage(i,t,"Notification")),n.HandleFlowErrorMessage(t,!1)},ViewPromotion:function(n){discountninja.Logging.LogInformation("FLOW: Viewing promotion");discountninja.PromotionEvent.LogPromotionEvent(n,0)},AcceptPromotion:function(t,i){var u,f,r;try{discountninja.Logging.LogInformation("FLOW: Accepting promotion");u=discountninja.Promotion.GetPromotionDiscountCode(t);f=discountninja.Promotion.GetPromotionPriceRule(t);discountninja.Promotion.SetPromotionAccepted(t.Token,t.Frequency,"true");discountninja.Promotion.SaveToCache(t);r=discountninja.DiscountLevel.GetCurrentDiscountLevelNumber(t,discountninja.LiquidData.CartValue());r!==null&&r>0&&n.ApplyPromotion(t,i,u,f)}catch(e){discountninja.Logging.LogError("PromotionFlow.AcceptPromotion",e,!0)}},ApplyPromotion:function(t,i,r,u){try{if(discountninja.Logging.LogInformation("FLOW: Applying promotion"),discountninja.DiscountCode.Add(t.Token,r,u,t.PriceRuleInfo.TargetType),discountninja.Timer.ShouldStartOnAccept(t))discountninja.Timer.Start();else if(discountninja.Timer.ShouldStartOnGoalAchieved(t)){var f=discountninja.DiscountLevel.GoalAchieved(t);f&&discountninja.Timer.Start()}t.NotificationSettings.Body?(discountninja.Logging.LogVerbose("Adding notification message for promotion with token "+t.Token),discountninja.Notification.Add(t.Token,i)):discountninja.Logging.LogVerbose("No notification message for promotion with token "+t.Token);discountninja.DynamicPricing.UpdatePrice(!0);jQuery("body .mega-menu-price").length>0&&(discountninja.Logging.LogVerbose("Mega menu prices detected"),setTimeout(function(){discountninja.Logging.LogVerbose("Updating price for mega menu");discountninja.DynamicPricing.UpdatePrice(!0)},2e3));discountninja.ShortCode.ShowShortcodePlaceholders();n.ShowStickyBar();discountninja.PromotionEvent.LogPromotionEvent(t,1)}catch(e){discountninja.Logging.LogError("PromotionFlow.ApplyPromotion",e,!0)}},ShowNotifications:function(){try{if(discountninja.Promotion.Promotions.length<1)return;n.IsNotificationRequired()&&discountninja.Notification.Show();discountninja.TestMode.ShowTestModeOutput()}catch(t){discountninja.Logging.LogError("PromotionFlow.ShowNotifications",t,!0)}},StopFlow:function(){discountninja.Logging.LogInformation("FLOW: Stopped",!0,!1);discountninja.DiscountCode.InjectDiscountCodesInHtml();discountninja.DynamicPricing.UnblockPricesAndButtons();discountninja.Checkout.Shopify.PrepareDraftOrder()},IsBuildingBlockEnabledForPage:function(n,t,i){return t!==""||n.Enabled||(t=i+" is disabled"),t===""&&discountninja.Environment.Shopify.IsProductPage()&&!n.ShowOn.ShowOnProductPages&&(t=i+" is not displayed because it is disabled for product pages"),t===""&&discountninja.Environment.Shopify.IsHomePage()&&!n.ShowOn.ShowOnHomePage&&(t=i+" is not displayed because it is disabled for the home page"),t===""&&discountninja.Environment.Shopify.IsBlogPost()&&!n.ShowOn.ShowOnBlogPosts&&(t=i+" is not displayed because it is disabled for blog posts"),t===""&&discountninja.Environment.Shopify.IsCollectionPage()&&!n.ShowOn.ShowOnCollectionPages&&(t=i+" is not displayed because it is disabled for collection pages"),t===""&&discountninja.Environment.Shopify.IsCustomPage()&&!n.ShowOn.ShowOnCustomPages&&(t=i+" is not displayed because it is disabled for custom pages"),t===""&&discountninja.Environment.Shopify.IsCartPage()&&!n.ShowOn.ShowOnCartPage&&(t=i+" is not displayed because it is disabled for cart page"),t},HandleFlowErrorMessage:function(n,t){return n&&n!==""?(t?discountninja.Logging.LogTestMode(n,null,!0,!1,!1):discountninja.Logging.LogVerbose(n),!1):!0},HasPopUpBeenShownForLevel:function(n){function i(n){return discountninja.Cache.LocalGet("popup-displayed-"+n)}function r(n){return discountninja.Cache.SessionGet("popup-displayed-"+n)}var t=n.Token;return i(t)==="shown"&&n.PopUpSettings.Frequency==="onceperdevice"?(discountninja.Logging.LogInformation("FLOW: Pop-up will not be displayed for promotion with token "+t+", because it has already been shown on this device. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/when-to-display-the-pop-up' target='_blank'>here<\/a>."),!0):r(t)==="shown"&&n.PopUpSettings.Frequency==="oncepersession"?(discountninja.Logging.LogInformation("FLOW: Pop-up will not be displayed for promotion with token "+t+", because it has already been shown during this session. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/when-to-display-the-pop-up' target='_blank'>here<\/a>."),!0):!1}};discountninja.PromotionFlow=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja.Settings=discountninja.Settings||{},function(){var n={Settings:null,GetCurrencyFormat:function(){try{return n.Settings.CurrencySettings.MoneyFormat===null?'<span class="money">{{amount}}<\/span>':n.Settings.CurrencySettings.MoneyFormat}catch(t){return discountninja.Logging.LogError("DiscountedCart.GetCurrencyFormat",t,!0),""}},GetPriceFormat:function(t){return t==="item-product"?discountninja.Environment.Shopify.IsCartPage()?n.Settings.PriceUpdateSettings.CartProductPriceFormat||n.Settings.PriceUpdateSettings.ProductPagePriceFormat:n.Settings.PriceUpdateSettings.DrawerCartProductPriceFormat||n.Settings.PriceUpdateSettings.ProductPagePriceFormat:t==="item-line"?discountninja.Environment.Shopify.IsCartPage()?n.Settings.PriceUpdateSettings.CartLinePriceFormat||n.Settings.PriceUpdateSettings.ProductPagePriceFormat:n.Settings.PriceUpdateSettings.DrawerCartLinePriceFormat||n.Settings.PriceUpdateSettings.ProductPagePriceFormat:t==="subtotal"?discountninja.Environment.Shopify.IsCartPage()?n.Settings.PriceUpdateSettings.CartSubtotalPriceFormat||n.Settings.PriceUpdateSettings.ProductPagePriceFormat:n.Settings.PriceUpdateSettings.DrawerCartSubtotalPriceFormat||n.Settings.PriceUpdateSettings.ProductPagePriceFormat:t==="standard"?discountninja.Environment.Shopify.IsProductPage()?n.Settings.PriceUpdateSettings.ProductPagePriceFormat:n.Settings.PriceUpdateSettings.NonProductPagePriceFormat||n.Settings.PriceUpdateSettings.ProductPagePriceFormat:n.Settings.PriceUpdateSettings.ProductPagePriceFormat},SettingsAreValid:function(n){try{return n===null||typeof n=="undefined"?(discountninja.Logging.LogWarning("No settings available",!0,!0),!1):(discountninja.Logging.LogVerbose("Settings valid"),!0)}catch(t){discountninja.Logging.LogError("Settings.SettingsAreValid",t,!0)}}};discountninja.Settings=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja=discountninja||{};discountninja.ShortCode=discountninja.ShortCode||{},function(){var n={HideShortcodePlaceholders:function(){try{jQuery(".limoniapps-discountninja-shortcodeplaceholder").css("display","none")}catch(n){discountninja.Logging.LogError("ShortCode.HideShortcodePlaceholders",n,!0)}},ShowShortcodePlaceholders:function(){try{jQuery(".limoniapps-discountninja-shortcodeplaceholder").each(function(){jQuery(this).html(n.ReplaceAllPlaceHolders(jQuery(this).html()))});jQuery(".limoniapps-discountninja-shortcodeplaceholder").css("display","block")}catch(t){discountninja.Logging.LogError("ShortCode.ShowShortcodePlaceholders",t,!0)}},RefreshResolvedPlaceholders:function(t,i,r){try{discountninja.Logging.LogVerbose("Refreshing all resolved placeholders");jQuery(t).find("[data-limoniapps-discountninja-shortcode-product]").each(function(){var t="{{"+jQuery(this).attr("data-limoniapps-discountninja-shortcode-product")+"}}";discountninja.Logging.LogVerbose("Refreshing shortcode "+t);jQuery(this).html(n.ReplaceProductLevelPlaceHolders(t,r,!1))});jQuery(t).find("[data-limoniapps-discountninja-shortcode-promotion]").each(function(){var t="{{"+jQuery(this).attr("data-limoniapps-discountninja-shortcode-promotion")+"}}";discountninja.Logging.LogVerbose("Refreshing shortcode "+t);jQuery(this).html(n.ReplacePromotionLevelPlaceHolders(i,t,!1))});discountninja.MultiCurrency.UpdateCurrency()}catch(u){discountninja.Logging.LogError("ShortCode.RefreshResolvedPlaceholders",u,!0)}},BuildResolvedPlaceHolderAmount:function(t,i,r,u,f,e,o,s,h,c,l,a,v,y){try{function w(n,t){return t?"{{"+n.replace("{{","").replace("}}","")+","+t+"}}":n}function p(t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,b){return t=n.BuildResolvedPlaceHolder(t,i,w(r,u),e,o,discountninja.Utilities.FormatMoney(s,h,v,y,f,b),p,!0),f||(t=n.BuildResolvedPlaceHolder(t,i,"<del>"+w(r,u)+"<\/del>",e,o,discountninja.Utilities.FormatMoney(s,c,v,y,!0,b),p,!0)),f||(t=n.BuildResolvedPlaceHolder(t,i,"<strike>"+w(r,u)+"<\/strike>",o,e,discountninja.Utilities.FormatMoney(s,c,v,y,!0,b),p,!0)),f||(t=n.BuildResolvedPlaceHolder(t,i,"<s>"+w(r,u)+"<\/s>",o,e,discountninja.Utilities.FormatMoney(s,c,v,y,!0,b),p,!0)),t}return t=p(t,i,r,"",!1,u,f,e,o,s,h,c,l,a,v,y),t=p(t,i,r,"NO_DECIMALS",!1,u,f,e,o,s,h,c,l,a,v,y),t=p(t,i,r,"NO_CURRENCY",!1,u,f,e,o,s,h,c,l,a,v,y),t=p(t,i,r,"NO_DECIMALS,NO_CURRENCY",!1,u,f,e,o,s,h,c,l,a,v,y),t=p(t,i,r,"STRIKETHROUGH",!0,u,f,e,o,s,h,c,l,a,v,y),t=p(t,i,r,"STRIKETHROUGH,NO_DECIMALS",!0,u,f,e,o,s,h,c,l,a,v,y),t=p(t,i,r,"STRIKETHROUGH,NO_CURRENCY",!0,u,f,e,o,s,h,c,l,a,v,y),t=p(t,i,r,"STRIKETHROUGH,NO_DECIMALS,NO_CURRENCY",!0,u,f,e,o,s,h,c,l,a,v,y)}catch(b){return discountninja.Logging.LogError("ShortCode.BuildResolvedPlaceHolderAmount",b,!0),t}},BuildResolvedPlaceHolder:function(n,t,i,r,u,f,e){var o=u===undefined||u===null?"":'class="limoniapps-discountninja-shortcode limoniapps-discountninja-shortcode-'+u+'" ',s=e===undefined||e===null?"":e+" ",h=t?"<span "+o+s+"data-limoniapps-discountninja-shortcode-"+r+'="'+i.replace("{{","").replace("}}","")+'">'+f+"<\/span>":f;return n.replace(new RegExp(i,"g"),h)},ReplacePromotionLevelPlaceHolders:function(t,i,r){var w,b,l,k,v,e,u,a,y;try{if(typeof i=="undefined"||i===""||i===null)return i;discountninja.Logging.LogVerbose("Replacing promotion level placeholders");var p=discountninja.Settings.Settings.TimerSettings,et=discountninja.Settings.Settings.HereLabel||"here",f=discountninja.Settings.GetCurrencyFormat(),o=discountninja.Utilities.GetNoDecimalsCurrencyFormat(f),s=discountninja.Utilities.GetCurrencyFormatAmountComponent(f),h=discountninja.Utilities.GetCurrencyFormatAmountComponent(o),c=t.PriceRuleInfo.Precision,d=p.FormattingTemplateOnDate,g=p.FormattingTemplateOnTime,nt="",tt="",it=t.ScheduleSettings.EndsOnDate;it&&(w=moment(it).utc(),nt=discountninja.Timer.FormatDate(w,d),tt=discountninja.Timer.FormatDate(w,g));var rt="",ut="",ft=t.PriceRuleInfo.EndsAt;return ft&&(b=moment(ft).utc(),rt=discountninja.Timer.FormatDate(b,d),ut=discountninja.Timer.FormatDate(b,g)),l=0,discountninja.DiscountedCart&&discountninja.DiscountedCart.DiscountedCart&&discountninja.DiscountedCart.DiscountedCart.total_discount&&(l=discountninja.DiscountedCart.DiscountedCart.total_discount*100),k=0,v=0,window.limoniapps_discountninja_liquid&&window.limoniapps_discountninja_liquid.Cart&&window.limoniapps_discountninja_liquid.total_price&&(v=window.limoniapps_discountninja_liquid.total_price),l>0&&v>0&&(k=l/v),e=discountninja.DiscountLevel.GetCurrentDiscountLevel(t),e===null&&(e=t.PriceRuleInfo.DiscountLevel1),u=discountninja.DiscountLevel.GetGoalDiscountLevel(t),u===null&&(e=t.PriceRuleInfo.DiscountLevel1),a=0,y=0,u&&u.CartValueMinimum>0&&(y=u.CartValueMinimum,a=(y*100-discountninja.LiquidData.CartValue())/100,a<0&&(a=0)),i=n.BuildResolvedPlaceHolderAmount(i,r,"{{MINIMUM_CART_VALUE}}","promotion","minimum_cart_value",y*100,f,o,s,h,c,!1,null,!1),i=n.BuildResolvedPlaceHolderAmount(i,r,"{{AMOUNT_LEFT_BEFORE_DISCOUNT}}","promotion","amountleft_before_discount",a*100,f,o,s,h,c,!1,!1),i=n.BuildResolvedPlaceHolder(i,r,"{{DISCOUNT_CODE}}","promotion","code",discountninja.Promotion.GetPromotionDiscountCode(t)),i=n.BuildResolvedPlaceHolder(i,r,"{{ENDS_AT_DATE}}","promotion","ends_at_date",nt),i=n.BuildResolvedPlaceHolder(i,r,"{{ENDS_AT_TIME}}","promotion","ends_at_time",tt),i=n.BuildResolvedPlaceHolder(i,r,"{{EXPIRES_AT_DATE}}","promotion","expires_at_date",rt),i=n.BuildResolvedPlaceHolder(i,r,"{{EXPIRES_AT_TIME}}","promotion","expires_at_time",ut),i=n.BuildResolvedPlaceHolder(i,r,"{{TARGET_LINK}}","promotion","target_link","<a class='limoniapps-targetlink' href='"+t.TargetLink+"'>"+et+"<\/a>"),i=n.BuildResolvedPlaceHolderAmount(i,r,"{{TOTAL_DISCOUNT_AMOUNT}}","promotion","total_discount_amount",l,f,o,s,h,c,!1,null,!0),i=n.BuildResolvedPlaceHolder(i,r,"{{TOTAL_DISCOUNT_PERCENTAGE}}","promotion","total_discount_percentage",discountninja.Utilities.FormatPercentage(k,0)+"%"),e&&(i=n.BuildResolvedPlaceHolder(i,r,"{{DISCOUNT_PERCENTAGE}}","promotion","discount_percentage",discountninja.Utilities.FormatPercentage(e.Percentage,0)+"%"),i=n.BuildResolvedPlaceHolderAmount(i,r,"{{DISCOUNT_AMOUNT}}","promotion","discount_amount",e.Amount*100,f,o,s,h,c,!1,null,!0),t&&t.PriceRuleInfo.ValueType==="percentage"&&(i=n.BuildResolvedPlaceHolder(i,r,"{{DISCOUNT}}","promotion","discount",discountninja.Utilities.FormatPercentage(e.Percentage,0)+"%")),t&&t.PriceRuleInfo.ValueType==="fixed_amount"&&(i=n.BuildResolvedPlaceHolderAmount(i,r,"{{DISCOUNT}}","promotion","discount",e.Amount*100,f,o,s,h,c,!1,null,!0))),u&&(i=n.BuildResolvedPlaceHolder(i,r,"{{NEXT_GOAL_DISCOUNT_PERCENTAGE}}","promotion","next_goal_discount_percentage",discountninja.Utilities.FormatPercentage(u.Percentage,0)+"%"),i=n.BuildResolvedPlaceHolderAmount(i,r,"{{NEXT_GOAL_DISCOUNT_AMOUNT}}","promotion","next_goal_discount_amount",u.Amount*100,f,o,s,h,c,!1,null,!0),t&&t.PriceRuleInfo.ValueType==="percentage"&&(i=n.BuildResolvedPlaceHolder(i,r,"{{NEXT_GOAL_DISCOUNT}}","promotion","next_goal_discount",discountninja.Utilities.FormatPercentage(u.Percentage,0)+"%")),t&&t.PriceRuleInfo.ValueType==="fixed_amount"&&(i=n.BuildResolvedPlaceHolderAmount(i,r,"{{NEXT_GOAL_DISCOUNT}}","promotion","next_goal_discount",u.Amount*100,f,o,s,h,c,!1,null,!0))),p.Enabled===!0&&(i=i.replace(/{{TIMER}}/g,'<span class="limoniapps-discountninja-timer"><\/span>')),i}catch(ot){return discountninja.Logging.LogError("ShortCode.ReplacePromotionLevelPlaceHolders",ot,!0),i}},ReplaceProductLevelPlaceHolders:function(t,i,r,u){try{function c(n,t,i,r){var u=n?"color: "+n+" !important;":"",f=t?"font-size: "+t+"px !important;":"",e=i?"font-weight: "+i+" !important;":"",o=r?r+";":"";return' style="'+u+f+e+o+'" '}function v(n){return c(discountninja.Settings.GetPriceFormat(n).DiscountedPriceColor,discountninja.Settings.GetPriceFormat(n).DiscountedPriceFontSize,discountninja.Settings.GetPriceFormat(n).DiscountedPriceFontWeight,discountninja.Settings.GetPriceFormat(n).DiscountedPriceCustomCss)}function y(n){return c(discountninja.Settings.GetPriceFormat(n).OriginalPriceColor,discountninja.Settings.GetPriceFormat(n).OriginalPriceFontSize,discountninja.Settings.GetPriceFormat(n).OriginalPriceFontWeight,discountninja.Settings.GetPriceFormat(n).OriginalPriceCustomCss)}if(u||(u="standard"),typeof t=="undefined"||t===""||t===null)return t;discountninja.Logging.LogVerbose("Replacing product level placeholders");var f=discountninja.Settings.GetCurrencyFormat(),e=discountninja.Utilities.GetNoDecimalsCurrencyFormat(f),o=discountninja.Utilities.GetCurrencyFormatAmountComponent(f),s=discountninja.Utilities.GetCurrencyFormatAmountComponent(e),h=2,l=v(u),a=y(u);return i&&typeof i.CompareAtAmount!="undefined"&&(t=n.BuildResolvedPlaceHolderAmount(t,r,"{{AMOUNT_COMPAREAT}}","product","amount_compareat",i.CompareAtAmount*100,f,e,o,s,h,!1,null,!0)),i&&typeof i.DiscountedPrice!="undefined"&&(t=n.BuildResolvedPlaceHolderAmount(t,r,"{{DISCOUNTED_PRICE}}","product","discounted_price",i.DiscountedPrice*100,f,e,o,s,h,!1,l,!0)),i&&typeof i.OriginalPrice!="undefined"&&(t=n.BuildResolvedPlaceHolderAmount(t,r,"{{ORIGINAL_PRICE}}","product","original_price",i.OriginalPrice*100,f,e,o,s,h,!1,a,!0)),i&&typeof i.OriginalCompareAtPrice!="undefined"&&(t=n.BuildResolvedPlaceHolderAmount(t,r,"{{ORIGINAL_COMPAREAT_PRICE}}","original_compareat_price","amount",i.OriginalCompareAtPrice*100,f,e,o,s,h,!1,a,!0)),i&&typeof i.DiscountedPrice!="undefined"&&(t=n.BuildResolvedPlaceHolderAmount(t,r,"{{DISCOUNTED_PRICE_AFTERPAY_INSTALLMENT}}","product","discounted_price_afterpay_installment",i.DiscountedPrice*25,f,e,o,s,h,!1,l,!0)),i&&typeof i.Amount!="undefined"&&(t=n.BuildResolvedPlaceHolderAmount(t,r,"{{DISCOUNT_AMOUNT}}","product","discount_amount",i.Amount*100,f,e,o,s,h,!1,null,!0)),i&&typeof i.Percentage!="undefined"&&(t=n.BuildResolvedPlaceHolder(t,r,"{{DISCOUNT_PERCENTAGE}}","product","discount_percentage",discountninja.Utilities.FormatPercentage(i.Percentage,0)+"%")),i&&typeof i.Percentage!="undefined"&&i.Percentage>0&&(t=n.BuildResolvedPlaceHolder(t,r,"{{DISCOUNT}}","product","discount",discountninja.Utilities.FormatPercentage(i.Percentage,0)+"%")),i&&typeof i.Amount!="undefined"&&i.Amount>0&&(t=n.BuildResolvedPlaceHolderAmount(t,r,"{{DISCOUNT}}","product","discount",i.Amount*100,f,e,o,s,h,!1,null,!0)),t}catch(p){discountninja.Logging.LogError("ShortCode.ReplaceProductLevelPlaceHolders",p,!0)}},ReplaceAllPlaceHolders:function(t,i,r,u){function f(t,i){try{if(t===""||t===null||t===undefined)return t;discountninja.Logging.LogVerbose("Replacing settings level placeholders");t=n.BuildResolvedPlaceHolder(t,i,"{{CURRENCY}}","promotion","currency",discountninja.Settings.Settings.CurrencySettings.BaseCurrency);t=n.BuildResolvedPlaceHolder(t,i,"{{CURRENCY_SYMBOL}}","promotion","currency_symbol",discountninja.Settings.Settings.CurrencySettings.BaseCurrencySymbol);t=t.replace(/{{NEW_LINE}}/g,"<br>");var r=discountninja.Notification.GetFromCache()||[];return t=t.replace(/{{OFFER_COUNT}}/g,r.length)}catch(u){return discountninja.Logging.LogError("ShortCode.ReplaceSettingsLevelPlaceHolders",u,!0),t}}return i=f(i,!0),r&&(i=n.ReplaceProductLevelPlaceHolders(i,r,!0,u)),t&&(i=n.ReplacePromotionLevelPlaceHolders(t,i,!0)),i}};discountninja.ShortCode=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja.StickyBar=discountninja.StickyBar||{},function(){var n={AnimateOnReminderIntervalHandle:-1,CycleIntervalHandle:-1,CurrentLevelForPromotion:[],GetId:function(){return"limoniapps-discountninja-stickybar-wrapper"},AddTopMarginToElements:function(n){try{function t(n,t){try{if(jQuery(n).length===0||jQuery(n).attr("data-original-body-margin-top")!==undefined)return;try{discountninja.Logging.LogVerbose("Adding top margin "+t+" to element "+(n==="body"?"body":jQuery(n).attr("id")))}catch(r){}var i=parseInt(jQuery(n).css("margin-top")),u=i+t;discountninja.Utilities.AppendToStyle(n,"margin-top",u.toString()+"px !important");jQuery(n).attr("data-original-body-margin-top",i)}catch(r){discountninja.Logging.LogError("StickyBar.ShowTopMarginToElement",r,!0)}}t("body",n);t("#fsb_background",n);t("#qab_bar",n);t("#spb-information-bar",n);jQuery(".limoniapps-discountninja-header, .limoniapps-discounturl-header").each(function(){t(this,n)})}catch(i){discountninja.Logging.LogError("StickyBar.AddTopMarginToElements",i,!0)}},RemoveTopMarginFromElements:function(){try{function n(n){try{if(jQuery(n).length===0)return;try{discountninja.Logging.LogVerbose("Removing top margin from element "+(n==="body"?"body":jQuery(n).attr("id")))}catch(t){}var i=parseInt(jQuery(n).attr("data-original-body-margin-top"));jQuery(n).css("margin-top",i.toString()+"px")}catch(t){discountninja.Logging.LogError("StickyBar.HideTopMarginFromElement",t,!0)}}n("body");n("#fsb_background");jQuery(".limoniapps-discounturl-header, .limoniapps-discountninja-header").each(function(){n(this)})}catch(t){discountninja.Logging.LogError("StickyBar.RemoveTopMarginFromElements",t,!0)}},Hide:function(){try{function t(){var t,i,r;try{t=n.GetId();i=jQuery("#"+t);i.hide();r=jQuery(".limoniapps-discountninja-stickynotification-bottom").length>0;r||n.RemoveTopMarginFromElements()}catch(u){discountninja.Logging.LogError("StickyBar.HideInner",u,!0)}}var i=discountninja.Settings.Settings.StickyBarSettings;i.AnimationExit?(n.ApplyAnimation(jQuery("#limoniapps-discountninja-stickybar-wrapper"),i.AnimationExit),setTimeout(function(){t()},800)):t()}catch(r){discountninja.Logging.LogError("StickyBar.Hide",r,!0)}},Remove:function(t){var r,u,i;try{for(discountninja.Logging.LogInformation("StickyBar.Remove for token "+t),r=n.GetFromCache(),u=[],i=0;i<r.length;i++)r[i].Token!==t&&u.push(r[i]);n.MessageCount=u.length;n.SaveToCache(u);setTimeout(function(){n.Show()},500)}catch(f){discountninja.Logging.LogError("StickyBar.Remove",f,!0)}},Clear:function(){discountninja.Logging.LogInformation("StickyBar.Clear called ");n.MessageCount=0;discountninja.Cache.SessionRemove("stickybar-data")},GetFromCache:function(){try{var n=discountninja.Cache.SessionGet("stickybar-data");return n=n==="undefined"?[]:JSON.parse(n),n===null?[]:n}catch(t){return discountninja.Logging.LogError("StickyBar.GetFromCache",t,!0),[]}},SaveToCache:function(n){try{discountninja.Cache.SessionSet("stickybar-data",JSON.stringify(n))}catch(t){discountninja.Logging.LogError("StickyBar.SaveToCache",t,!0)}},Add:function(t){var i,r;try{for(discountninja.Logging.LogInformation("StickyBar.Add for token "+t),t||discountninja.Logging.LogError("StickyBar.Add","Expected token",!1),i=n.GetFromCache(),r=0;r<i.length;r++)if(i[r]&&i[r].Token===t)return;i.push({Token:t});n.MessageCount=n.MessageCount+1;n.SaveToCache(i)}catch(u){discountninja.Logging.LogError("StickyBar.Add",u,!0)}},CurrentMessageIndex:0,MessageCount:0,CycleMessage:function(t){try{discountninja.Logging.LogVerbose("StickyBar.CycleMessage");n.ShowMessage(t);var i=discountninja.Settings.Settings.StickyBarSettings;if(n.MessageCount<=1)return;n.CycleIntervalHandle=setTimeout(function(){n.CurrentMessageIndex=n.CurrentMessageIndex+1;n.CycleMessage(!0)},i.CycleSettings.DurationMilliseconds)}catch(r){discountninja.Logging.LogError("StickyBar.CycleMessage",r,!0)}},ApplyAnimation:function(n,t){var i=discountninja.Settings.Settings.StickyBarSettings;jQuery(n).removeClass(i.AnimationEnter);jQuery(n).removeClass(i.AnimationOnGoal);jQuery(n).removeClass(i.AnimationOnReminder);jQuery(n).removeClass(i.AnimationExit);jQuery(n).removeClass(i.CycleSettings.AnimationOnCyle);jQuery(n).addClass(t)},ShowMessage:function(t){function w(n){try{var t=discountninja.DiscountLevel.GetCurrentDiscountLevel(n),i=discountninja.DiscountLevel.GetPercentageAmountFromDiscountLevel(t);return discountninja.ShortCode.ReplaceAllPlaceHolders(n,discountninja.TextSettings.GetText(n.StickyBarSettings.Body,n),i)}catch(r){return discountninja.Logging.LogError("StickyBar.GetBodyMessage",r,!0),""}}function b(n){try{var t=discountninja.DiscountLevel.GetCurrentDiscountLevel(n),i=discountninja.DiscountLevel.GetPercentageAmountFromDiscountLevel(t);return discountninja.Timer.IsTimerStarted()?discountninja.ShortCode.ReplaceAllPlaceHolders(n,discountninja.TextSettings.GetText(n.StickyBarSettings.TimerFooter,n),i):""}catch(r){return discountninja.Logging.LogError("StickyBar.GetTimerFooterMessage",r,!0),""}}function k(n){var t=n.split(" ");return t[0]+" "+t[1]}function d(n){var t=n.split(" ");return t.length===3?t[0]+" "+t[2]:t[0]+" "+t[1]}function g(t){var i=jQuery(".limoniapps-sticky-topbar .limoniapps-content");n.ApplyAnimation(i,t)}function y(){if(i.StickyBarSettings.AnimationOnGoal){var r=!1,t=discountninja.DiscountLevel.GetCurrentDiscountLevel(i),u=n.CurrentLevelForPromotion[i.Token];r=u!==undefined?u<t:t>0;r&&(n.CurrentLevelForPromotion[i.Token]=t,g(discountninja.Settings.Settings.StickyBarSettings.AnimationOnGoal))}}var f,p,r,i,e,v;try{if(n.CurrentMessageIndex>=n.MessageCount&&(n.CurrentMessageIndex=0),f=n.CurrentMessageIndex,discountninja.Logging.LogVerbose("StickyBar.ShowMessage - Index: "+f),p=n.GetFromCache(),r=p[f],!r){discountninja.Logging.LogError("StickyBar.ShowMessage","Notification "+f+" not found",!0);return}i=discountninja.Promotion.GetPromotionByToken(r.Token);discountninja.Logging.LogVerbose("StickyBar.ShowMessage - Token: "+i.Token);var nt=discountninja.Settings.Settings.StickyBarSettings,tt=n.GetId(),o=jQuery("#"+tt),s=w(i),h=b(i),u=jQuery(o).find(".limoniapps-info"),c=jQuery(o).find(".limoniapps-message.limoniapps-message-body"),l=jQuery(o).find(".limoniapps-message.limoniapps-message-timerfooter"),a=nt.CycleSettings.AnimationOnCyle;return t&&a&&n.MessageCount>0?(e=d(a),v=k(a),v!==e?(n.ApplyAnimation(u,v),setTimeout(function(){jQuery(c).html(s);jQuery(l).html(h);jQuery(u).hide();setTimeout(function(){jQuery(u).show();n.ApplyAnimation(u,e)},50);y()},500)):(jQuery(c).html(s),jQuery(l).html(h),n.ApplyAnimation(u,e))):(jQuery(c).html(s),jQuery(l).html(h)),y(),n.SetShownInSession(r.Token,!0),n.SetShownOnDevice(r.Token,!0),!0}catch(it){return discountninja.Logging.LogError("StickyBar.ShowMessage",it,!0),!1}},Show:function(){function u(t,i){setTimeout(function(){n.ApplyAnimation(jQuery(".limoniapps-sticky-topbar .limoniapps-col-info"),t);u(t,i)},i)}function e(){try{var n=discountninja.Settings.Settings.StickyBarSettings,t=n.Html;return t=t.replace("{{BODY}}",""),t.replace("{{HEIGHT}}",discountninja.Utilities.IsMobilePhone()?n.MobileHeight:n.Height)}catch(i){return discountninja.Logging.LogError("StickyBar.GetEmptyHtml",i,!0),""}}var f,t;try{if(n.MessageCount<=0){n.Hide();return}var t=discountninja.Settings.Settings.StickyBarSettings,i=n.GetId(),o=jQuery("#"+i),r=jQuery(o).length===1;if(!r){var s="limoniapps-stick-to-"+t.PlacementVertical,h=r?"":t.AnimationEnter,c=e(),l='<div id="'+i+'" class="'+s+" "+h+'">'+c+"<\/div>";jQuery("body").prepend(l);jQuery("#"+i).find('.limoniapps-close[data-notify="dismiss"]').click(function(){try{n.SetDismissedInSession(!0);n.Hide()}catch(t){return discountninja.Logging.LogError("StickyBar.Show.Dismiss",t,!0),!1}});t.Delay&&t.Delay>0&&setTimeout(function(){n.Hide()},t.Delay);t.PlacementVertical==="top"?(f=jQuery("#"+i).outerHeight(),n.AddTopMarginToElements(f)):discountninja.Logging.LogVerbose("No margin applied to sticky bar since it is positioned on the bottom");discountninja.Settings.Settings.GeneralSettings.ShowPoweredBy?jQuery(".limoniapps-poweredby").removeClass("limoniapps-poweredby-hidden"):jQuery(".limoniapps-poweredby").addClass("limoniapps-poweredby-hidden")}t=discountninja.Settings.Settings.StickyBarSettings;t.CycleSettings.Mode==="cycle"&&n.MessageCount>1?(clearInterval(n.CycleIntervalHandle),n.CycleMessage(!r)):(n.CurrentMessageIndex=0,n.ShowMessage(!r));discountninja.Settings.Settings.StickyBarSettings.AnimationOnReminder&&(clearInterval(n.AnimateOnReminderIntervalHandle),u(discountninja.Settings.Settings.StickyBarSettings.AnimationOnReminder,discountninja.Settings.Settings.StickyBarSettings.ReminderDuration))}catch(a){return discountninja.Logging.LogError("StickyBar.Show",a,!0),!1}},GetShownInSession:function(n){return discountninja.Cache.SessionGet("stickybar-displayed-insession-"+n)},SetShownInSession:function(n,t){discountninja.Cache.SessionSet("stickybar-displayed-insession-"+n,t)},GetShownOnDevice:function(n){return discountninja.Cache.LocalGet("stickybar-displayed-ondevice-"+n)},SetShownOnDevice:function(n,t){discountninja.Cache.LocalSet("stickybar-displayed-ondevice-"+n,t)},GetDismissedInSession:function(n){return discountninja.Cache.SessionGet("stickybar-dismissed-insession-"+n)},SetDismissedInSession:function(n,t){discountninja.Cache.SessionSet("stickybar-dismissed-insession-"+n,t)}};discountninja.StickyBar=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja.TabReminder=discountninja.TabReminder||{},function(){var n={Set:function(){function n(){try{if(!discountninja.DynamicPricing.HasActiveDiscountCode())return;var t=discountninja.Cache.SessionGet("tabtitle");t===null&&(t=document.title,discountninja.Cache.SessionSet("tabtitle",t));document.visibilityState==="visible"&&discountninja.Cache.SessionSet("toggletabtitle","off");discountninja.Cache.SessionGet("toggletabtitle")==="on-state1"?(document.title=" Promotion active! "+t,discountninja.Cache.SessionSet("toggletabtitle","on-state2"),setTimeout(function(){n()},2500)):discountninja.Cache.SessionGet("toggletabtitle")==="on-state2"?(document.title=" Don't forget! "+t,discountninja.Cache.SessionSet("toggletabtitle","on-state3"),setTimeout(function(){n()},2500)):discountninja.Cache.SessionGet("toggletabtitle")==="on-state3"?(document.title=" Collect discount! "+t,discountninja.Cache.SessionSet("toggletabtitle","on-state4"),setTimeout(function(){n()},2500)):discountninja.Cache.SessionGet("toggletabtitle")==="on-state4"&&(document.title=t,discountninja.Cache.SessionSet("toggletabtitle","on-state1"),setTimeout(function(){n()},5e3))}catch(i){discountninja.Logging.LogError("TabReminder.ToggleTabReminder",i,!0)}}try{var t=discountninja.Cache.SessionGet("toggletabtitle");(t===null||t==="off")&&(discountninja.Cache.SessionSet("toggletabtitle","on-state1"),n())}catch(i){discountninja.Logging.LogError("TabReminder.Set",i,!0)}},Remove:function(){try{discountninja.Cache.SessionSet("toggletabtitle","off");var n=discountninja.Cache.SessionGet("tabtitle");n!==null&&(document.title=n)}catch(t){discountninja.Logging.LogError("TabReminder.Remove",t,!0)}}};discountninja.TabReminder=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja.TestMode=discountninja.TestMode||{},function(){var n={TestModeDynamicStylesAdded:!1,TestMode:!1,TestModeOutput:[],TestModeOutputIssue:!1,ShowTestModeOutput:function(){function n(n){try{LimoniAppsLoadJQueryNotify(function(){jQuery(".alert-limoniapps-notification-testmodeoutput").remove();var t=jQuery.notify({icon:"fa fa-info-circle",title:"Discount Ninja<br>Test mode output",message:n},{type:"limoniapps-notification-testmodeoutput",placement:{from:"top",align:"left"},delay:0,animate:{enter:"animate fadeInBottom",exit:"animate fadeOutBottom"}}),i=jQuery(t)[0].$ele;i!==undefined||discountninja.Logging.LogVerbose("Cannot show test output, Bootstrap Notify may not be registered correctly")})}catch(t){discountninja.Logging.LogError("TestMode.ShowTestModeNotificationMessage",t,!0)}}function t(n,t){var i="",r;if(n===null||t===!1)i=i+"<br/><span style='color:green;'><i class='fa fa-thumbs-o-up' aria-hidden='true'><\/i> No issues found<\/span>";else for(i="<br/><strong>Remarks:<\/strong><br>",r=0;r<n.length;r++)i=i+n[r];return i+"<br/><span style='font-size:14px;'><strong>Note<\/strong> This message is not visible for your visitors. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/test-mode-output' target='_blank'>here<\/a>.<\/span>"}try{if(discountninja.TestMode.TestMode===!1)return;var i=t(discountninja.TestMode.TestModeOutput,discountninja.TestMode.TestModeOutputIssue);discountninja.TestMode.TestModeOutput=[];n(i)}catch(r){discountninja.Logging.LogError("TestMode.ShowTestModeOutput",r,!0)}},HandleQueryParameter:function(){discountninja.QueryParameter.Get("discountninjatestmode")?(n.TestMode=!0,discountninja.Cache.Clear(),discountninja.Cache.SessionSet("discountninjatestmode",!0),discountninja.QueryParameter.Remove("discountninjatestmode")):n.TestMode=discountninja.Cache.SessionGet("discountninjatestmode")?!0:!1}};discountninja.TestMode=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja.TextSettings=discountninja.TextSettings||{},function(){var n={GetText:function(n,t){function s(n,t){return t=t.replace(/display(\s)*:(\s)*block/g,""),n.replace("<\/span>","&nbsp;"+t+"<\/span>")}if(!n)return"";var o=discountninja.Environment.Shopify.IsCartPage(),h=discountninja.Utilities.IsMobilePhone(),c=t===null?!1:t.OfferType==="spendx_gety",u="-";if(c){var l=discountninja.LiquidData.CartValue(),e=t===null?0:discountninja.DiscountLevel.GetCurrentDiscountLevelNumber(t,l),a=t===null?0:discountninja.DiscountLevel.GetMaxDiscountLevelNumber(t.PriceRuleInfo);e===a?u="after":e>0?u="duringandafter":e>-1&&(u="during")}var r="",i="",f="";return h?o?(r=n.MobileTextOnCartDuringGoal||n.MobileTextDuringGoal||n.MobileTextOnCart||n.MobileText||n.Text||"",i=n.MobileTextOnCartAfterGoal||n.MobileTextAfterGoal||n.MobileTextOnCart||n.MobileText||n.Text||"",f=n.MobileTextOnCart||n.MobileText||n.Text||""):(r=n.MobileTextDuringGoal||n.TextDuringGoal||n.MobileText||n.Text||"",i=n.MobileTextAfterGoal||n.TextAfterGoal||n.MobileText||n.Text||"",f=n.MobileText||n.Text||""):o?(r=n.TextOnCartDuringGoal||n.TextDuringGoal||n.TextOnCart||n.Text||"",i=n.TextOnCartAfterGoal||n.TextAfterGoal||n.TextOnCart||n.Text||"",f=n.TextOnCart||n.Text||""):(r=n.TextDuringGoal||n.Text||"",i=n.TextAfterGoal||n.Text||"",f=n.Text||""),u==="duringandafter"?i===r?i:s(i,r):u==="during"?r:u==="after"?i:f}};discountninja.TextSettings=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja.Timer=discountninja.Timer||{},function(){var n={TimeZone:null,Start:function(){function h(n){try{var t=n.match(/\{.*?\}/);return t!==null&&t.length>0?t[0]:null}catch(i){return discountninja.Logging.LogError("Timer.GetJSONFromTimeString",i,!0),null}}function t(t,i){try{return n.TimerLabels[t][i]}catch(r){return discountninja.Logging.LogError("Timer.GetTimeLabel",r,!0),""}}function u(n,t,i,r,u,f,e,o,s,h,c){var l,a,y;try{function v(n){return n<10?"0"+n:n}return l="",a=!1,n>0&&(l=l+n+e,a=!0),t>0&&(c&&a&&(t=v(t)),l=l!=""?l+u+t+o:l+t+o,a=!0),i>0&&(c&&a&&(i=v(i)),l=l!=""?l+u+i+s:l+i+s,a=!0),r>0&&(c&&a&&(r=v(r)),l=l!=""?l+u+r+h:l+r+h),y=l.lastIndexOf(u),l=l.slice(0,y)+l.slice(y).replace(u,f)}catch(p){return discountninja.Logging.LogError("Timer.TimeFormattingAsDuration",p,!0),""}}function c(n,i){try{var e=i.asSeconds(),f=n.TimerSettings.FormattingTemplateIn,o=h(moment.duration(i,"seconds").format('s [{"Days":]d[,"Hours":]h[,"Minutes":]m[,"Seconds":]s[}]')),r=JSON.parse(o);return f==="in_seconds"?moment.duration(e,"seconds").format("s ["+t(3,0)+"]"):f==="in_minutes"?moment.duration(e,"seconds").format("m ["+t(2,0)+"]"):f==="in_hours_minutes_and_seconds"?moment.duration(e,"seconds").format("h ["+t(1,0)+"][,] m ["+t(2,0)+"] ["+t(4,0)+"] s ["+t(3,0)+"]"):f==="in_hours_minutes_and_seconds_short"?moment.duration(e,"seconds").format("h ["+t(1,1)+"][,] m ["+t(2,1)+"] ["+t(4,0)+"] s ["+t(3,1)+"]"):f==="in_minutes_and_seconds"?moment.duration(e,"seconds").format("m ["+t(2,0)+"] ["+t(4,0)+"] s ["+t(3,0)+"]"):f==="in_minutes_and_seconds_short"?moment.duration(e,"seconds").format("m ["+t(2,1)+"] ["+t(4,0)+"] s ["+t(3,1)+"]"):f==="in_hours"?moment.duration(e,"seconds").format("h ["+t(1,0)+"]"):f==="in_days"?moment.duration(e,"seconds").format("d ["+t(0,0)+"]"):f==="in_duration"?moment.duration(i,"days").format(t(0,2)+" [days] "+t(1,2)+" [hours] "+t(2,2)+" [minutes] "+t(3,2)+" [seconds]"):f==="in_duration_short"?moment.duration(i,"days").format(t(0,2)+" [days] "+t(1,2)+" [hrs] "+t(2,2)+" [min] "+t(3,2)+" [sec]"):f==="in_durationcommaand"?u(r.Days,r.Hours,r.Minutes,r.Seconds,", "," "+t(4,0)+" "," "+t(0,0)," "+t(1,0)," "+t(2,0)," "+t(3,0)):f==="in_durationcommaand_short"?u(r.Days,r.Hours,r.Minutes,r.Seconds,", "," "+t(4,0)+" "," "+t(0,1)," "+t(1,1)," "+t(2,1)," "+t(3,1)):f==="in_durationwithcolon"?u(r.Days,r.Hours,r.Minutes,r.Seconds,":",":"," "+t(0,2)," "+t(1,2)," "+t(2,2)," "+t(3,2)):f==="in_durationwithspace"?u(r.Days,r.Hours,r.Minutes,r.Seconds," "," "," "+t(0,2)," "+t(1,2)," "+t(2,2)," "+t(3,2)):f==="in_durationwithcomma"?u(r.Days,r.Hours,r.Minutes,r.Seconds,", ",", "," "+t(0,2)," "+t(1,2)," "+t(2,2)," "+t(3,2)):f==="in_durationwithcolon_short"?u(r.Days,r.Hours,r.Minutes,r.Seconds,":",":","","","","",!0):""}catch(s){return discountninja.Logging.LogError("Timer.TimeFormatting",s,!0),""}}function l(){try{discountninja.Logging.LogVerbose("Expiring timer");n.IsTimerStarted()?(n.SetTimerStarted(!1),r!==null&&r!==0&&clearInterval(r),discountninja.Logging.LogVerbose("Timer stopped, restarting flow"),discountninja.PromotionFlow.StartFlow()):discountninja.Logging.LogVerbose("Timer was not started")}catch(t){discountninja.Logging.LogError("Timer.Expire",t,!0)}}function e(n){var t=moment(n);return moment.duration(t.diff(moment().utc()))}function o(n,t){var i,r,u;try{i=e(t);i.asSeconds()>1?(r=c(n,i),u=".limoniapps-discountninja-timer",jQuery(u).text(r)):l()}catch(f){discountninja.Logging.LogError("Timer.UpdateTimer",f,!0)}}function a(t){function i(n){try{return n&&n!==""?[n,n,n]:null}catch(t){return discountninja.Logging.LogError("Timer.ProcessCustomTimeLabels",t,!0),null}}try{var r=i(t.CustomDaysLabel)||["days","days","d"],u=i(t.CustomHoursLabel)||["hours","hrs","h"],f=i(t.CustomMinutesLabel)||["minutes","min","m"],e=i(t.CustomSecondsLabel)||["seconds","sec","s"],o=i(t.CustomAndLabel)||["and","&","&"];n.TimerLabels=[r,u,f,e,o]}catch(s){discountninja.Logging.LogError("Timer.ProcessTimerSettings",s,!0)}}var f,s,i,r;try{if(f=discountninja.Settings.Settings.TimerSettings.EndsAt,!f)return;if(s=e(f),s<=0)return;if(i=discountninja.Settings.Settings,!i||!i.TimerSettings||!i.TimerSettings.Enabled)return;a(i.TimerSettings);r!==null&&r!==0&&clearInterval(r);r=window.setInterval(function(){o(i,f)},1e3);o(i,f);n.SetTimerStarted(!0);discountninja.Logging.LogVerbose("Started timer")}catch(v){discountninja.Logging.LogError("Timer.Start",v,!0)}},FormatDate:function(t,i){var r,u;try{function f(t){var u,i;try{function f(n){return n?n.startOf("minute"):n}function e(){try{return LimoniAppsLoadMoment(function(){return LimoniAppsLoadMomentFormat(function(){LimoniAppsLoadMomentTimezone(function(){return n.TimeZone===null&&(n.TimeZone=moment.tz.guess(),discountninja.Logging.LogVerbose("Assuming timezone is: "+n.TimeZone)),n.TimeZone})})})}catch(t){return discountninja.Logging.LogError("Timer.GetTimeZone",t,!0),"America/Los_Angeles"}}return r=moment(t).utc(),discountninja.Logging.LogVerbose("Moment to consider: "+r),u=e(),discountninja.Logging.LogVerbose("Time zone: "+n.TimeZone),i=moment(r).tz(u),discountninja.Logging.LogVerbose("Moment to consider in timezone: "+i),r=typeof i=="undefined"||i===null?r:i,discountninja.Logging.LogVerbose("Final moment to consider: "+r),f(r)}catch(o){return discountninja.Logging.LogError("Timer.GetMoment",o,!1),null}}return r=f(t),discountninja.Logging.LogVerbose("Formatting moment: "+r+" with format "+i),u=i===null||i===""?"":r?r.format(i):"",discountninja.Logging.LogVerbose("Formated moment: "+u),u}catch(e){return discountninja.Logging.LogError("Timer.FormatDate",e,!0),null}},Stop:function(){n.SetTimerStarted(!1)},ShouldStartOn:function(n,t){return n?discountninja.Settings.Settings.TimerSettings.Enabled?n.TimerMode===t:!1:!1},ShouldStartOnDisplay:function(t){return n.ShouldStartOn(t,"displayed")},ShouldStartOnAccept:function(t){return n.ShouldStartOn(t,"accepted")},ShouldStartOnGoalAchieved:function(t){return n.ShouldStartOn(t,"goalachieved")},ShouldNotStart:function(t){return n.ShouldStartOn(t,undefined)},IsTimerStarted:function(){return discountninja.Cache.SessionGet("timer-started")==="true"},SetTimerStarted:function(n){discountninja.Cache.SessionSet("timer-started",n)}};discountninja.Timer=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja.Token=discountninja.Token||{},function(){var n={GetTokenFromQueryParameter:function(){try{var n=discountninja.QueryParameter.Get("token");return n?n.toUpperCase():""}catch(t){return discountninja.Logging.LogError("Token.GetTokenFromQueryParameter",t,!0),""}},GetTokenFromPromotionOrQueryParameter:function(t){try{var i=null,t=discountninja.Promotion.PrimaryPromotion;return t&&(i=t?t.Token:null),i===null&&(i=n.GetTokenFromQueryParameter()),i?i.toUpperCase():""}catch(r){return discountninja.Logging.LogError("Token.GetTokenFromPromotionOrQueryParameter ",r,!1),""}},GetCartToken:function(t){try{var i=n.GetTokenFromPromotionOrQueryParameter(t);return(i===null||i==="")&&(i=n.GetCartTokenFromLocalStorage()),i?i.toUpperCase():""}catch(r){return discountninja.Logging.LogError("Token.GetCartToken ",r,!1),""}},GetNonAutomaticToken:function(t){try{var i=n.GetTokenFromPromotionOrQueryParameter(t);return(i===null||i==="")&&(i=n.GetNonAutomaticTokenFromSession()),i?i.toUpperCase():""}catch(r){return discountninja.Logging.LogError("Token.GetNonAutomaticToken ",r,!1),""}},GetToken:function(t){try{var i=n.GetTokenFromPromotionOrQueryParameter(t);return(i===null||i==="")&&(i=n.GetTokenFromLocalStorage()),i?i.toUpperCase():""}catch(r){return discountninja.Logging.LogError("Token.GetToken ",r,!1),""}},GetTokenFromLocalStorage:function(){return discountninja.Cache.LocalGet("token-device")},SetTokenInLocalStorage:function(n){discountninja.Cache.LocalSet("token-device",n)},RemoveCartTokenFromLocalStorage:function(){discountninja.Cache.LocalRemove("token-cart-device")},GetCartTokenFromLocalStorage:function(){return discountninja.Cache.LocalGet("token-cart-device")},SetCartTokenInLocalStorage:function(n){discountninja.Cache.LocalSet("token-cart-device",n)},GetNonAutomaticTokenFromSession:function(){return discountninja.Cache.SessionGet("token-non-automatic-session")},SetNonAutomaticTokenInSession:function(n){discountninja.Cache.SessionSet("token-non-automatic-session",n)}};discountninja.Token=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja.Trigger=discountninja.Trigger||{},function(){var n={IntializeTimeOnPageCounter:function(){try{discountninja.Cache.SessionSet("trigger-time-on-page",0);n.TimeOnPageCounterIntervalId!==null&&n.TimeOnPageCounterIntervalId!==0&&clearInterval(n.TimeOnPageCounterIntervalId);n.TimeOnPageCounterIntervalId=window.setInterval(function(){var n=discountninja.Cache.SessionGet("trigger-time-on-page");n=!n||isNaN(n)?0:parseInt(n);discountninja.Cache.SessionSet("trigger-time-on-page",n+1)},1e3)}catch(t){discountninja.Logging.LogError("Trigger.IntializeTimeOnPageCounter",t,!0)}},TrackExitIntent:function(){var n,t;try{discountninja.Cache.SessionSet("trigger-exit-intent","false");n=discountninja.Settings.Settings.GeneralSettings.ExitIntentMode;n||(n="default");t=ouibounce(!1,{aggressive:!0,timer:n==="aggressive"?0:1e3,delay:n==="aggressive"?150:0,sensitivity:n==="aggressive"?80:20,callback:function(){discountninja.Logging.LogVerbose("Exit intent detected");discountninja.Cache.SessionSet("trigger-exit-intent","true")}})}catch(i){discountninja.Logging.LogError("Trigger.TrackExitIntent",i,!0)}},TrackScrollPercentage:function(){try{function n(){var n;try{if(n=discountninja.Cache.SessionGet("trigger-scroll-percentage"),n===100)return;var i=jQuery(window).height(),r=jQuery(document).height(),u=jQuery(window).scrollTop(),f=r-i,t=Math.floor(u/f*100);t>n&&discountninja.Cache.SessionSet("trigger-scroll-percentage",t)}catch(e){return 0}}discountninja.Cache.SessionSet("trigger-scroll-percentage",0);jQuery(window).on("scroll",function(){n()});n()}catch(t){discountninja.Logging.LogError("Trigger.TrackScrollPercentage",t,!0)}},MarkPageAsVisited:function(){var n,t;try{n=discountninja.Cache.SessionGet("trigger-pages-visited-list");n=n==null?[]:n.split(",");jQuery.inArray(window.location.pathname,n)===-1&&n.push(window.location.pathname);t=n.length;discountninja.Cache.SessionSet("trigger-pages-visited",t);discountninja.Logging.LogVerbose("Pages visited: "+t)}catch(i){discountninja.Logging.LogError("Trigger.MarkPageAsVisited",i,!0)}},PromotionTriggersOnPage:function(n){try{if(!n.PopUpSettings.Enabled)return!0;var t=discountninja.PromotionFlow.IsBuildingBlockEnabledForPage(n.PopUpSettings,"","Pop-up"),i=discountninja.PromotionFlow.HandleFlowErrorMessage(t);if(!i)return!1;if(discountninja.Environment.Shopify.IsCustomPage()&&n.PopUpSettings.Enabled)return n.PopUpSettings.ShowOn.ShowOnCustomPages?n.TriggerSettings.CustomPagesIncluded==="custom"&&!discountninja.Utilities.StringIsIn(n.TriggerSettings.CustomPageContains,discountninja.Environment.Shopify.CustomPageHandle())?(discountninja.Logging.LogTestMode("Promotion will not be displayed because the current custom page is not in the set of pages to include",null,!0,!0,!1),!1):!0:!1;if(discountninja.Environment.Shopify.IsBlogPost()&&n.PopUpSettings.Enabled){if(!n.PopUpSettings.ShowOn.ShowOnBlogPosts)return!1;if(n.TriggerSettings.BlogPostsIncluded!=="blogequals"||discountninja.Utilities.StringIsIn(n.TriggerSettings.BlogEquals,discountninja.Environment.Shopify.BlogHandle()))if(n.TriggerSettings.BlogPostsIncluded!=="postcontains"||discountninja.Utilities.StringIsIn(n.TriggerSettings.BlogPostHandleContains,discountninja.Environment.Shopify.BlogPostHandle())){if(n.TriggerSettings.BlogPostsIncluded==="blogandpostcontains"&&!discountninja.Utilities.StringIsIn(n.TriggerSettings.BlogPostHandleContains,discountninja.Environment.Shopify.BlogPostHandle())&&!discountninja.Utilities.StringIsIn(n.TriggerSettings.BlogEquals,discountninja.Environment.Shopify.BlogHandle()))return discountninja.Logging.LogTestMode("Promotion will not be displayed because the current blog post is not in the set of blog posts to include",null,!0,!0,!1),!1}else return discountninja.Logging.LogTestMode("Promotion will not be displayed because the current blog post is not in the set of blog posts to include",null,!0,!0,!1),!1;else return discountninja.Logging.LogTestMode("Promotion will not be displayed because the current blog is not in the set of blogs to include",null,!0,!0,!1),!1;return!0}if(discountninja.Environment.Shopify.IsCollectionPage()&&n.PopUpSettings.Enabled){if(!n.PopUpSettings.ShowOn.ShowOnCollectionPages)return!1;if(n.TriggerSettings.TargetCollectionHandleMode!=="overrideinclude"||discountninja.Utilities.StringIsIn(n.TriggerSettings.OverrideCollectionHandles,discountninja.Environment.Shopify.CollectionHandle())){if(n.TriggerSettings.TargetCollectionHandleMode==="overrideexclude"&&discountninja.Utilities.StringIsIn(n.TriggerSettings.OverrideCollectionHandles,discountninja.Environment.Shopify.CollectionHandle()))return discountninja.Logging.LogTestMode("Promotion will not be displayed because the current collection page is in the set of overriden collections to exclude",null,!0,!0,!1),!1}else return discountninja.Logging.LogTestMode("Promotion will not be displayed because the current collection page is not in the set of overriden collections to include",null,!0,!0,!1),!1;return!0}return!0}catch(r){discountninja.Logging.LogError("Promotion.PromotionTriggersOnPage",r,!0)}},PromotionTriggerConditionsMet:function(n){var r,t,i;try{function s(n){var i=n.TriggerSettings.TimeOnPageInSeconds,t=discountninja.Cache.SessionGet("trigger-time-on-page");if(t&&!isNaN(t))return t>=i}function h(n){var i=n.TriggerSettings.ScrollPercentage,t=discountninja.Cache.SessionGet("trigger-scroll-percentage");if(t&&!isNaN(t))return t>=i}function c(n){var i=n.TriggerSettings.PagesVisited,t=discountninja.Cache.SessionGet("trigger-pages-visited");if(t&&!isNaN(t))return t>=i}function l(){if(discountninja.Utilities.IsMobilePhone())return!0;var n=discountninja.Cache.SessionGet("trigger-exit-intent");return n==="true"}if((r=discountninja.Cache.SessionGet("trigger-conditions-met-"+n.Token),r==="true")||discountninja.PromotionFlow.HasPopUpBeenShownForLevel(n)||(t=n.TriggerSettings,!t))return!0;var u=t.ScrollPercentage!==null&&t.ScrollPercentage!==undefined&&t.ScrollPercentage!==!1,f=t.PagesVisited!==null&&t.PagesVisited!==undefined&&t.PagesVisited!==!1,e=t.OnExitIntent!==null&&t.OnExitIntent!==undefined&&t.OnExitIntent!==!1,o=t.TimeOnPageInSeconds!==null&&t.TimeOnPageInSeconds!==undefined&&t.TimeOnPageInSeconds!==!1;return!u&&!f&&!e&&!o?!0:(i=!1,o&&s(n)&&(i=!0),!i&&u&&h(n)&&(i=!0),!i&&f&&c(n)&&(i=!0),!i&&e&&l(n)&&(i=!0),discountninja.Cache.SessionSet("trigger-conditions-met-"+n.Token,i),i)}catch(a){discountninja.Logging.LogError("Trigger.PromotionTriggerConditionsMet",a,!0)}}};discountninja.Trigger=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja.VariantChange=discountninja.VariantChange||{},function(){var n={UnRegisterEventHandlerForVariantChange:function(){try{jQuery("body").find("form").find("select").each(function(){jQuery(this).off("change.discountninja")})}catch(n){discountninja.Logging.LogError("VariantChange.UnRegisterEventHandlerForVariantChange",n,!0)}},RegisterEventHandlerForVariantChange:function(){try{discountninja.Logging.LogVerbose("Registering event handler for variant change");n.UnRegisterEventHandlerForVariantChange();jQuery("body").find("form").find("select").each(function(){jQuery(this).on("change.discountninja",function(){n.VariantChangeDetected()})});jQuery(document).on("variantChanged",function(t,i){discountninja.Logging.LogVerbose("Received variantChanged event for variant: "+i?i.variant?i.variant.id:"":"");n.VariantChangeDetected()})}catch(t){discountninja.Logging.LogError("VariantChange.RegisterEventHandlerForVariantChange",t,!0)}},VariantChangeDetected:function(){try{function n(){var t=discountninja.Cache.SessionGet("last-known-variant"),n=discountninja.Environment.Shopify.VariantId();t!=n&&(discountninja.Cache.SessionSet("last-known-variant",n),discountninja.PromotionFlow.StartFlow())}setTimeout(function(){n()},500)}catch(t){discountninja.Logging.LogError("VariantChange.VariantChangeDetected",t,!0)}}};discountninja.VariantChange=n}();typeof discountninja=="undefined"&&(discountninja={});discountninja.Cart=discountninja.Cart||{};discountninja.Cart.Shopify=discountninja.Cart.Shopify||{},function(){var n={IsCartUpdated:!1,UpdateCart:function(t){try{var i="https://"+location.hostname;n.IsCartUpdated=!1;discountninja.Logging.LogVerbose("Updating cart");discountninja.XmlHttpRequest.Send(i+"/cart.js?m="+moment().format("x"),null,null,"get",!0,!0,function(i){typeof limoniapps_discountninja_liquid=="object"&&(window.limoniapps_discountninja_liquid.Cart=i,discountninja.Logging.LogVerbose("Updating cart - DONE"));discountninja.DiscountedCart.BuildDiscountedCart(t);n.IsCartUpdated=!0})}catch(r){discountninja.Logging.LogError("Cart.Shopify.UpdateCart",r,!0)}},OnAddToCart:function(n,t){var i,u,f,r;try{return(discountninja.Logging.LogVerbose("Handling add to cart"),i=discountninja.Environment.Shopify.IsProductPage()?discountninja.Environment.Shopify.ProductHandle():discountninja.LiquidData.ProductHandleFromCart(t),i===null&&typeof n!="undefined"&&n!==null&&(u=jQuery(n.target).closest("[data-limoniapps-discountninja-product-handle]").attr("data-limoniapps-discountninja-product-handle")||jQuery(n.target).find("[data-limoniapps-discountninja-product-handle]").attr("data-limoniapps-discountninja-product-handle"),typeof u=="undefined"?(f=jQuery(n.target).find('input[name="variantid"]').val()||jQuery(n.target).find('input[name="id"]').val()||jQuery(n.target).find("button[data-variant-id]").attr("data-variant-id")||jQuery(n.target).find("button[data-variantid]").attr("data-variantid")||jQuery(n.target).find("button[data-id]").attr("data-id")||jQuery(n.target).find("a[data-variant-id]").attr("data-variant-id")||jQuery(n.target).find("a[data-variantid]").attr("data-variantid")||jQuery(n.target).find("a[data-id]").attr("data-id"),typeof f!="undefined"&&(discountninja.Logging.LogVerbose("OnAddToCart found variant: "+f+" in the form"),i=discountninja.LiquidData.ProductHandleFromCart(f))):(discountninja.Logging.LogVerbose("OnAddToCart found product handle from data attribute: "+u),i=u)),i===null)?(discountninja.Logging.LogVerbose("OnAddToCart could not find a product handle"),!0):(discountninja.Logging.LogVerbose("OnAddToCart found product handle "+i),r=discountninja.Promotion.GetPromotionForProduct(i,null,null,null),discountninja.ProductData.SaveOnAddToCart(i),r?(discountninja.PromotionEvent.LogPromotionEvent(r,2),discountninja.Promotion.SetTokenForProductInCache(i,r.Token),discountninja.Logging.LogVerbose("OnAddToCart tracked product with handle "+i+" is in promotion with token "+r.Token)):discountninja.Logging.LogVerbose("OnAddToCart could not find a promotion for product with handle "+i),discountninja.DynamicPricing.ReplacePricesInCart(),discountninja.PromotionFlow.StartFlow(),!0)}catch(e){return discountninja.Logging.LogError("Cart.Shopify.OnAddToCart",e,!0),!0}},OnUpdateCart:function(){try{discountninja.Logging.LogVerbose("Handling update to cart");discountninja.DynamicPricing.ReplacePricesInCart();discountninja.PromotionFlow.StartFlow()}catch(n){discountninja.Logging.LogError("Cart.Shopify.OnUpdateCart",n,!0)}},UnRegisterEventHandlerForAddToCart:function(){try{jQuery("body").find("a, button").each(function(){jQuery(this).off("click.discountninja.cart");jQuery(this).off("touch.discountninja.cart")});jQuery("body").find("form").each(function(){jQuery(this).off("submit.discountninja.cart")})}catch(n){discountninja.Logging.LogError("Cart.Shopify.UnRegisterEventHandlerForAddToCart",n,!0)}},RegisterEventHandlerForAddToCart:function(){try{discountninja.Logging.LogVerbose("Registering event handler for atc");n.UnRegisterEventHandlerForAddToCart();jQuery('form[action^="/cart/add"]').each(function(){var t=this;jQuery(this).on("submit.discountninja.cart",function(t){n.OnAddToCart(t)})});jQuery('a[href^="/cart/"]').each(function(){jQuery(this).on("click.discountninja.cart touch.discountninja.cart",function(t){n.OnAddToCart(t)})});jQuery('button[onclick*="/cart/"]').each(function(){jQuery(this).on("click.discountninja.cart touch.discountninja.cart",function(t){n.OnAddToCart(t)})})}catch(t){discountninja.Logging.LogError("Cart.Shopify.RegisterEventHandlerForAddToCart",t,!0)}}};discountninja.Cart.Shopify=n}();discountninja.DOMHasLoaded=!1;discountninja.Start(!0);jQuery(document).ready(function(){discountninja.DOMHasLoaded=!0;discountninja.Logging.LogVerbose("JQuery Document Ready")});